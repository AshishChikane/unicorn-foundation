const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ShfHlhEp.js","assets/index-DgnzOXt0.js","assets/index-BELq8H0i.css"])))=>i.map(i=>d[i]);
import{e as Ff,f as uu,h as G,i as Qt,j as hu,w as ii,V as Nb,M as qb,N as M,k as Db,m as Kc,o as zb,K as jb,A as Lb,q as $l,x as Ub,H as Mb,F as Bb,p as Al,$ as Hb,t as kb,r as Vb,J as Kb,u as Xn,s as Rl,X as Fb,v as Gb,E as lu,_ as Gf,y as sr,I as Wb,z as Cl,B as un,C as Ke,U as at,D as ri,G as Et,L as Jb,O as hn,P as Wf,Q as Qb,R as Yb,S as Zb,T as Jf,W as Xb,Y as Qf,Z as Yf,a0 as fn,a1 as Fc,a2 as $o,a3 as pn,a4 as e_,a5 as Ao,a6 as t_,a7 as r_,a8 as i_,a9 as n_,aa as mo,ab as s_,ac as o_,ad as _c,ae as Tl,af as a_,ag as c_,ah as u_,ai as Nl,aj as h_,ak as l_,al as f_,am as p_,an as d_,ao as g_,ap as y_,aq as Qn,ar as Zf,as as Ec,at as v_,au as m_,av as w_}from"./index-DgnzOXt0.js";import{s as is,a as zo,r as Xf,f as xi,g as fu,i as or,b as ns,c as ql,d as b_,e as __,h as pu,p as E_,j as du,k as jo,l as ti,m as I_,n as oi}from"./index.es-DJ5xbuTO.js";const P_=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,x_=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,S_=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function O_(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){$_(s);return}return t}function $_(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function wo(s,t={}){if(typeof s!="string")return s;if(s[0]==='"'&&s[s.length-1]==='"'&&s.indexOf("\\")===-1)return s.slice(1,-1);const r=s.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!S_.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(P_.test(s)||x_.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,O_)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function A_(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function Ye(s,...t){try{return A_(s(...t))}catch(r){return Promise.reject(r)}}function R_(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function C_(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function Ro(s){if(R_(s))return String(s);if(C_(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return Ro(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Gc="base64:";function T_(s){return typeof s=="string"?s:Gc+D_(s)}function N_(s){return typeof s!="string"||!s.startsWith(Gc)?s:q_(s.slice(Gc.length))}function q_(s){return globalThis.Buffer?Ff.Buffer.from(s,"base64"):Uint8Array.from(globalThis.atob(s),t=>t.codePointAt(0))}function D_(s){return globalThis.Buffer?Ff.Buffer.from(s).toString("base64"):globalThis.btoa(String.fromCodePoint(...s))}function _t(s){var t;return s&&((t=s.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function z_(...s){return _t(s.join(":"))}function bo(s){return s=_t(s),s?s+":":""}function j_(s,t){if(t===void 0)return!0;let r=0,n=s.indexOf(":");for(;n>-1;)r++,n=s.indexOf(":",n+1);return r<=t}function L_(s,t){return t?s.startsWith(t)&&s[s.length-1]!=="$":s[s.length-1]!=="$"}const U_="memory",M_=()=>{const s=new Map;return{name:U_,getInstance:()=>s,hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return[...s.keys()]},clear(){s.clear()},dispose(){s.clear()}}};function B_(s={}){const t={mounts:{"":s.driver||M_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=g=>{for(const v of t.mountpoints)if(g.startsWith(v))return{base:v,relativeKey:g.slice(v.length),driver:t.mounts[v]};return{base:"",relativeKey:g,driver:t.mounts[""]}},n=(g,v)=>t.mountpoints.filter(b=>b.startsWith(g)||v&&g.startsWith(b)).map(b=>({relativeBase:g.length>b.length?g.slice(b.length):void 0,mountpoint:b,driver:t.mounts[b]})),o=(g,v)=>{if(t.watching){v=_t(v);for(const b of t.watchListeners)b(g,v)}},c=async()=>{if(!t.watching){t.watching=!0;for(const g in t.mounts)t.unwatch[g]=await Dl(t.mounts[g],o,g)}},h=async()=>{if(t.watching){for(const g in t.unwatch)await t.unwatch[g]();t.unwatch={},t.watching=!1}},p=(g,v,b)=>{const E=new Map,O=S=>{let D=E.get(S.base);return D||(D={driver:S.driver,base:S.base,items:[]},E.set(S.base,D)),D};for(const S of g){const D=typeof S=="string",k=_t(D?S:S.key),H=D?void 0:S.value,Q=D||!S.options?v:{...v,...S.options},N=r(k);O(N).items.push({key:k,value:H,relativeKey:N.relativeKey,options:Q})}return Promise.all([...E.values()].map(S=>b(S))).then(S=>S.flat())},f={hasItem(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return Ye(E.hasItem,b,v)},getItem(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return Ye(E.getItem,b,v).then(O=>wo(O))},getItems(g,v={}){return p(g,v,b=>b.driver.getItems?Ye(b.driver.getItems,b.items.map(E=>({key:E.relativeKey,options:E.options})),v).then(E=>E.map(O=>({key:z_(b.base,O.key),value:wo(O.value)}))):Promise.all(b.items.map(E=>Ye(b.driver.getItem,E.relativeKey,E.options).then(O=>({key:E.key,value:wo(O)})))))},getItemRaw(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return E.getItemRaw?Ye(E.getItemRaw,b,v):Ye(E.getItem,b,v).then(O=>N_(O))},async setItem(g,v,b={}){if(v===void 0)return f.removeItem(g);g=_t(g);const{relativeKey:E,driver:O}=r(g);O.setItem&&(await Ye(O.setItem,E,Ro(v),b),O.watch||o("update",g))},async setItems(g,v){await p(g,v,async b=>{if(b.driver.setItems)return Ye(b.driver.setItems,b.items.map(E=>({key:E.relativeKey,value:Ro(E.value),options:E.options})),v);b.driver.setItem&&await Promise.all(b.items.map(E=>Ye(b.driver.setItem,E.relativeKey,Ro(E.value),E.options)))})},async setItemRaw(g,v,b={}){if(v===void 0)return f.removeItem(g,b);g=_t(g);const{relativeKey:E,driver:O}=r(g);if(O.setItemRaw)await Ye(O.setItemRaw,E,v,b);else if(O.setItem)await Ye(O.setItem,E,T_(v),b);else return;O.watch||o("update",g)},async removeItem(g,v={}){typeof v=="boolean"&&(v={removeMeta:v}),g=_t(g);const{relativeKey:b,driver:E}=r(g);E.removeItem&&(await Ye(E.removeItem,b,v),(v.removeMeta||v.removeMata)&&await Ye(E.removeItem,b+"$",v),E.watch||o("remove",g))},async getMeta(g,v={}){typeof v=="boolean"&&(v={nativeOnly:v}),g=_t(g);const{relativeKey:b,driver:E}=r(g),O=Object.create(null);if(E.getMeta&&Object.assign(O,await Ye(E.getMeta,b,v)),!v.nativeOnly){const S=await Ye(E.getItem,b+"$",v).then(D=>wo(D));S&&typeof S=="object"&&(typeof S.atime=="string"&&(S.atime=new Date(S.atime)),typeof S.mtime=="string"&&(S.mtime=new Date(S.mtime)),Object.assign(O,S))}return O},setMeta(g,v,b={}){return this.setItem(g+"$",v,b)},removeMeta(g,v={}){return this.removeItem(g+"$",v)},async getKeys(g,v={}){var k;g=bo(g);const b=n(g,!0);let E=[];const O=[];let S=!0;for(const H of b){(k=H.driver.flags)!=null&&k.maxDepth||(S=!1);const Q=await Ye(H.driver.getKeys,H.relativeBase,v);for(const N of Q){const L=H.mountpoint+_t(N);E.some(W=>L.startsWith(W))||O.push(L)}E=[H.mountpoint,...E.filter(N=>!N.startsWith(H.mountpoint))]}const D=v.maxDepth!==void 0&&!S;return O.filter(H=>(!D||j_(H,v.maxDepth))&&L_(H,g))},async clear(g,v={}){g=bo(g),await Promise.all(n(g,!1).map(async b=>{if(b.driver.clear)return Ye(b.driver.clear,b.relativeBase,v);if(b.driver.removeItem){const E=await b.driver.getKeys(b.relativeBase||"",v);return Promise.all(E.map(O=>b.driver.removeItem(O,v)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(g=>zl(g)))},async watch(g){return await c(),t.watchListeners.push(g),async()=>{t.watchListeners=t.watchListeners.filter(v=>v!==g),t.watchListeners.length===0&&await h()}},async unwatch(){t.watchListeners=[],await h()},mount(g,v){if(g=bo(g),g&&t.mounts[g])throw new Error(`already mounted at ${g}`);return g&&(t.mountpoints.push(g),t.mountpoints.sort((b,E)=>E.length-b.length)),t.mounts[g]=v,t.watching&&Promise.resolve(Dl(v,o,g)).then(b=>{t.unwatch[g]=b}).catch(console.error),f},async unmount(g,v=!0){var b,E;g=bo(g),!(!g||!t.mounts[g])&&(t.watching&&g in t.unwatch&&((E=(b=t.unwatch)[g])==null||E.call(b),delete t.unwatch[g]),v&&await zl(t.mounts[g]),t.mountpoints=t.mountpoints.filter(O=>O!==g),delete t.mounts[g])},getMount(g=""){g=_t(g)+":";const v=r(g);return{driver:v.driver,base:v.base}},getMounts(g="",v={}){return g=_t(g),n(g,v.parents).map(E=>({driver:E.driver,base:E.mountpoint}))},keys:(g,v={})=>f.getKeys(g,v),get:(g,v={})=>f.getItem(g,v),set:(g,v,b={})=>f.setItem(g,v,b),has:(g,v={})=>f.hasItem(g,v),del:(g,v={})=>f.removeItem(g,v),remove:(g,v={})=>f.removeItem(g,v)};return f}function Dl(s,t,r){return s.watch?s.watch((n,o)=>t(n,r+o)):()=>{}}async function zl(s){typeof s.dispose=="function"&&await Ye(s.dispose)}function Si(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function ep(s,t){let r;const n=()=>{if(r)return r;const o=indexedDB.open(s);return o.onupgradeneeded=()=>o.result.createObjectStore(t),r=Si(o),r.then(c=>{c.onclose=()=>r=void 0},()=>{}),r};return(o,c)=>n().then(h=>c(h.transaction(t,o).objectStore(t)))}let Ic;function ss(){return Ic||(Ic=ep("keyval-store","keyval")),Ic}function jl(s,t=ss()){return t("readonly",r=>Si(r.get(s)))}function H_(s,t,r=ss()){return r("readwrite",n=>(n.put(t,s),Si(n.transaction)))}function k_(s,t=ss()){return t("readwrite",r=>(r.delete(s),Si(r.transaction)))}function V_(s=ss()){return s("readwrite",t=>(t.clear(),Si(t.transaction)))}function K_(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Si(s.transaction)}function F_(s=ss()){return s("readonly",t=>{if(t.getAllKeys)return Si(t.getAllKeys());const r=[];return K_(t,n=>r.push(n.key)).then(()=>r)})}const G_="idb-keyval";var W_=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=o=>t+o;let n;return s.dbName&&s.storeName&&(n=ep(s.dbName,s.storeName)),{name:G_,options:s,async hasItem(o){return!(typeof await jl(r(o),n)>"u")},async getItem(o){return await jl(r(o),n)??null},setItem(o,c){return H_(r(o),c,n)},removeItem(o){return k_(r(o),n)},getKeys(){return F_(n)},clear(){return V_(n)}}};const J_="WALLET_CONNECT_V2_INDEXED_DB",Q_="keyvaluestorage";let Y_=class{constructor(){this.indexedDb=B_({driver:W_({dbName:J_,storeName:Q_})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,is(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var Pc=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{},Co={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Pc<"u"&&Pc.localStorage?Co.exports=Pc.localStorage:typeof window<"u"&&window.localStorage?Co.exports=window.localStorage:Co.exports=new t})();function Z_(s){var t;return[s[0],zo((t=s[1])!=null?t:"")]}let X_=class{constructor(){this.localStorage=Co.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Z_)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return zo(r)}async setItem(t,r){this.localStorage.setItem(t,is(r))}async removeItem(t){this.localStorage.removeItem(t)}};const e0="wc_storage_version",Ll=1,t0=async(s,t,r)=>{const n=e0,o=await t.getItem(n);if(o&&o>=Ll){r(t);return}const c=await s.getKeys();if(!c.length){r(t);return}const h=[];for(;c.length;){const p=c.shift();if(!p)continue;const f=p.toLowerCase();if(f.includes("wc@")||f.includes("walletconnect")||f.includes("wc_")||f.includes("wallet_connect")){const g=await s.getItem(p);await t.setItem(p,g),h.push(p)}}await t.setItem(n,Ll),r(t),r0(s,h)},r0=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let i0=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new X_;this.storage=t;try{const r=new Y_;t0(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var dn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Wc=function(s,t){return Wc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},Wc(s,t)};function n0(s,t){Wc(s,t);function r(){this.constructor=s}s.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Jc=function(){return Jc=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Jc.apply(this,arguments)};function s0(s,t){var r={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(r[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(s);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(s,n[o])&&(r[n[o]]=s[n[o]]);return r}function o0(s,t,r,n){var o=arguments.length,c=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,t,r,n);else for(var p=s.length-1;p>=0;p--)(h=s[p])&&(c=(o<3?h(c):o>3?h(t,r,c):h(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c}function a0(s,t){return function(r,n){t(r,n,s)}}function c0(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)}function u0(s,t,r,n){function o(c){return c instanceof r?c:new r(function(h){h(c)})}return new(r||(r=Promise))(function(c,h){function p(v){try{g(n.next(v))}catch(b){h(b)}}function f(v){try{g(n.throw(v))}catch(b){h(b)}}function g(v){v.done?c(v.value):o(v.value).then(p,f)}g((n=n.apply(s,t||[])).next())})}function h0(s,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,o,c,h;return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(g){return function(v){return f([g,v])}}function f(g){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(c=g[0]&2?o.return:g[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,g[1])).done)return c;switch(o=0,c&&(g=[g[0]&2,c.value]),g[0]){case 0:case 1:c=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,o=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(g[0]===6||g[0]===2)){r=0;continue}if(g[0]===3&&(!c||g[1]>c[0]&&g[1]<c[3])){r.label=g[1];break}if(g[0]===6&&r.label<c[1]){r.label=c[1],c=g;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(g);break}c[2]&&r.ops.pop(),r.trys.pop();continue}g=t.call(s,r)}catch(v){g=[6,v],o=0}finally{n=c=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function l0(s,t,r,n){n===void 0&&(n=r),s[n]=t[r]}function f0(s,t){for(var r in s)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=s[r])}function Qc(s){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&s[t],n=0;if(r)return r.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function tp(s,t){var r=typeof Symbol=="function"&&s[Symbol.iterator];if(!r)return s;var n=r.call(s),o,c=[],h;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)c.push(o.value)}catch(p){h={error:p}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(h)throw h.error}}return c}function p0(){for(var s=[],t=0;t<arguments.length;t++)s=s.concat(tp(arguments[t]));return s}function d0(){for(var s=0,t=0,r=arguments.length;t<r;t++)s+=arguments[t].length;for(var n=Array(s),o=0,t=0;t<r;t++)for(var c=arguments[t],h=0,p=c.length;h<p;h++,o++)n[o]=c[h];return n}function es(s){return this instanceof es?(this.v=s,this):new es(s)}function g0(s,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(s,t||[]),o,c=[];return o={},h("next"),h("throw"),h("return"),o[Symbol.asyncIterator]=function(){return this},o;function h(E){n[E]&&(o[E]=function(O){return new Promise(function(S,D){c.push([E,O,S,D])>1||p(E,O)})})}function p(E,O){try{f(n[E](O))}catch(S){b(c[0][3],S)}}function f(E){E.value instanceof es?Promise.resolve(E.value.v).then(g,v):b(c[0][2],E)}function g(E){p("next",E)}function v(E){p("throw",E)}function b(E,O){E(O),c.shift(),c.length&&p(c[0][0],c[0][1])}}function y0(s){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,c){t[o]=s[o]?function(h){return(r=!r)?{value:es(s[o](h)),done:o==="return"}:c?c(h):h}:c}}function v0(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],r;return t?t.call(s):(s=typeof Qc=="function"?Qc(s):s[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=s[c]&&function(h){return new Promise(function(p,f){h=s[c](h),o(p,f,h.done,h.value)})}}function o(c,h,p,f){Promise.resolve(f).then(function(g){c({value:g,done:p})},h)}}function m0(s,t){return Object.defineProperty?Object.defineProperty(s,"raw",{value:t}):s.raw=t,s}function w0(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var r in s)Object.hasOwnProperty.call(s,r)&&(t[r]=s[r]);return t.default=s,t}function b0(s){return s&&s.__esModule?s:{default:s}}function _0(s,t){if(!t.has(s))throw new TypeError("attempted to get private field on non-instance");return t.get(s)}function E0(s,t,r){if(!t.has(s))throw new TypeError("attempted to set private field on non-instance");return t.set(s,r),r}const I0=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Jc},__asyncDelegator:y0,__asyncGenerator:g0,__asyncValues:v0,__await:es,__awaiter:u0,__classPrivateFieldGet:_0,__classPrivateFieldSet:E0,__createBinding:l0,__decorate:o0,__exportStar:f0,__extends:n0,__generator:h0,__importDefault:b0,__importStar:w0,__makeTemplateObject:m0,__metadata:c0,__param:a0,__read:tp,__rest:s0,__spread:p0,__spreadArrays:d0,__values:Qc},Symbol.toStringTag,{value:"Module"})),Lo=uu(I0);var Hn={},xc={},kn={};class Oi{}const P0=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Oi},Symbol.toStringTag,{value:"Module"})),x0=uu(P0);var Ul;function S0(){if(Ul)return kn;Ul=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.IHeartBeat=void 0;const s=x0;class t extends s.IEvents{constructor(n){super()}}return kn.IHeartBeat=t,kn}var Ml;function rp(){return Ml||(Ml=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Lo.__exportStar(S0(),s)}(xc)),xc}var Sc={},Ii={},Bl;function O0(){if(Bl)return Ii;Bl=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.HEARTBEAT_EVENTS=Ii.HEARTBEAT_INTERVAL=void 0;const s=G;return Ii.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Ii.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ii}var Hl;function ip(){return Hl||(Hl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Lo.__exportStar(O0(),s)}(Sc)),Sc}var kl;function $0(){if(kl)return Hn;kl=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.HeartBeat=void 0;const s=Lo,t=Qt,r=G,n=rp(),o=ip();class c extends n.IHeartBeat{constructor(p){super(p),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(p==null?void 0:p.interval)||o.HEARTBEAT_INTERVAL}static init(p){return s.__awaiter(this,void 0,void 0,function*(){const f=new c(p);return yield f.init(),f})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(p,f){this.events.on(p,f)}once(p,f){this.events.once(p,f)}off(p,f){this.events.off(p,f)}removeListener(p,f){this.events.removeListener(p,f)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Hn.HeartBeat=c,Hn}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=Lo;t.__exportStar($0(),s),t.__exportStar(rp(),s),t.__exportStar(ip(),s)})(dn);function A0(s){try{return JSON.stringify(s)}catch{return'"[Circular]"'}}var R0=C0;function C0(s,t,r){var n=r&&r.stringify||A0,o=1;if(typeof s=="object"&&s!==null){var c=t.length+o;if(c===1)return s;var h=new Array(c);h[0]=n(s);for(var p=1;p<c;p++)h[p]=n(t[p]);return h.join(" ")}if(typeof s!="string")return s;var f=t.length;if(f===0)return s;for(var g="",v=1-o,b=-1,E=s&&s.length||0,O=0;O<E;){if(s.charCodeAt(O)===37&&O+1<E){switch(b=b>-1?b:0,s.charCodeAt(O+1)){case 100:case 102:if(v>=f||t[v]==null)break;b<O&&(g+=s.slice(b,O)),g+=Number(t[v]),b=O+2,O++;break;case 105:if(v>=f||t[v]==null)break;b<O&&(g+=s.slice(b,O)),g+=Math.floor(Number(t[v])),b=O+2,O++;break;case 79:case 111:case 106:if(v>=f||t[v]===void 0)break;b<O&&(g+=s.slice(b,O));var S=typeof t[v];if(S==="string"){g+="'"+t[v]+"'",b=O+2,O++;break}if(S==="function"){g+=t[v].name||"<anonymous>",b=O+2,O++;break}g+=n(t[v]),b=O+2,O++;break;case 115:if(v>=f)break;b<O&&(g+=s.slice(b,O)),g+=String(t[v]),b=O+2,O++;break;case 37:b<O&&(g+=s.slice(b,O)),g+="%",b=O+2,O++,v--;break}++v}++O}return b===-1?s:(b<E&&(g+=s.slice(b)),g)}const Vl=R0;var T0=vr;const ts=H0().console||{},N0={mapHttpRequest:_o,mapHttpResponse:_o,wrapRequestSerializer:Oc,wrapResponseSerializer:Oc,wrapErrorSerializer:Oc,req:_o,res:_o,err:L0};function q0(s,t){return Array.isArray(s)?s.filter(function(n){return n!=="!stdSerializers.err"}):s===!0?Object.keys(t):!1}function vr(s){s=s||{},s.browser=s.browser||{};const t=s.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=s.browser.write||ts;s.browser.write&&(s.browser.asObject=!0);const n=s.serializers||{},o=q0(s.browser.serialize,n);let c=s.browser.serialize;Array.isArray(s.browser.serialize)&&s.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const h=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),s.enabled===!1&&(s.level="silent");const p=s.level||"info",f=Object.create(r);f.log||(f.log=rs),Object.defineProperty(f,"levelVal",{get:v}),Object.defineProperty(f,"level",{get:b,set:E});const g={transmit:t,serialize:o,asObject:s.browser.asObject,levels:h,timestamp:U0(s)};f.levels=vr.levels,f.level=p,f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=rs,f.serializers=n,f._serialize=o,f._stdErrSerialize=c,f.child=O,t&&(f._logEvent=Yc());function v(){return this.level==="silent"?1/0:this.levels.values[this.level]}function b(){return this._level}function E(S){if(S!=="silent"&&!this.levels.values[S])throw Error("unknown level "+S);this._level=S,on(g,f,"error","log"),on(g,f,"fatal","error"),on(g,f,"warn","error"),on(g,f,"info","log"),on(g,f,"debug","log"),on(g,f,"trace","log")}function O(S,D){if(!S)throw new Error("missing bindings for child Pino");D=D||{},o&&S.serializers&&(D.serializers=S.serializers);const k=D.serializers;if(o&&k){var H=Object.assign({},n,k),Q=s.browser.serialize===!0?Object.keys(H):o;delete S.serializers,Uo([S],Q,H,this._stdErrSerialize)}function N(L){this._childLevel=(L._childLevel|0)+1,this.error=an(L,S,"error"),this.fatal=an(L,S,"fatal"),this.warn=an(L,S,"warn"),this.info=an(L,S,"info"),this.debug=an(L,S,"debug"),this.trace=an(L,S,"trace"),H&&(this.serializers=H,this._serialize=Q),t&&(this._logEvent=Yc([].concat(L._logEvent.bindings,S)))}return N.prototype=this,new N(this)}return f}vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};vr.stdSerializers=N0;vr.stdTimeFunctions=Object.assign({},{nullTime:np,epochTime:sp,unixTime:M0,isoTime:B0});function on(s,t,r,n){const o=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?rs:o[r]?o[r]:ts[r]||ts[n]||rs,D0(s,t,r)}function D0(s,t,r){!s.transmit&&t[r]===rs||(t[r]=function(n){return function(){const c=s.timestamp(),h=new Array(arguments.length),p=Object.getPrototypeOf&&Object.getPrototypeOf(this)===ts?ts:this;for(var f=0;f<h.length;f++)h[f]=arguments[f];if(s.serialize&&!s.asObject&&Uo(h,this._serialize,this.serializers,this._stdErrSerialize),s.asObject?n.call(p,z0(this,r,h,c)):n.apply(p,h),s.transmit){const g=s.transmit.level||t.level,v=vr.levels.values[g],b=vr.levels.values[r];if(b<v)return;j0(this,{ts:c,methodLevel:r,methodValue:b,transmitLevel:g,transmitValue:vr.levels.values[s.transmit.level||t.level],send:s.transmit.send,val:t.levelVal},h)}}}(t[r]))}function z0(s,t,r,n){s._serialize&&Uo(r,s._serialize,s.serializers,s._stdErrSerialize);const o=r.slice();let c=o[0];const h={};n&&(h.time=n),h.level=vr.levels.values[t];let p=(s._childLevel|0)+1;if(p<1&&(p=1),c!==null&&typeof c=="object"){for(;p--&&typeof o[0]=="object";)Object.assign(h,o.shift());c=o.length?Vl(o.shift(),o):void 0}else typeof c=="string"&&(c=Vl(o.shift(),o));return c!==void 0&&(h.msg=c),h}function Uo(s,t,r,n){for(const o in s)if(n&&s[o]instanceof Error)s[o]=vr.stdSerializers.err(s[o]);else if(typeof s[o]=="object"&&!Array.isArray(s[o]))for(const c in s[o])t&&t.indexOf(c)>-1&&c in r&&(s[o][c]=r[c](s[o][c]))}function an(s,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var o=1;o<n.length;o++)n[o]=arguments[o-1];return s[r].apply(this,n)}}function j0(s,t,r){const n=t.send,o=t.ts,c=t.methodLevel,h=t.methodValue,p=t.val,f=s._logEvent.bindings;Uo(r,s._serialize||Object.keys(s.serializers),s.serializers,s._stdErrSerialize===void 0?!0:s._stdErrSerialize),s._logEvent.ts=o,s._logEvent.messages=r.filter(function(g){return f.indexOf(g)===-1}),s._logEvent.level.label=c,s._logEvent.level.value=h,n(c,s._logEvent,p),s._logEvent=Yc(f)}function Yc(s){return{ts:0,messages:[],bindings:s||[],level:{label:"",value:0}}}function L0(s){const t={type:s.constructor.name,msg:s.message,stack:s.stack};for(const r in s)t[r]===void 0&&(t[r]=s[r]);return t}function U0(s){return typeof s.timestamp=="function"?s.timestamp:s.timestamp===!1?np:sp}function _o(){return{}}function Oc(s){return s}function rs(){}function np(){return!1}function sp(){return Date.now()}function M0(){return Math.round(Date.now()/1e3)}function B0(){return new Date(Date.now()).toISOString()}function H0(){function s(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return s(self)||s(window)||s(this)||{}}}const Mo=hu(T0),k0={level:"info"},os="custom_context";var V0=Object.defineProperty,K0=Object.defineProperties,F0=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,G0=Object.prototype.hasOwnProperty,W0=Object.prototype.propertyIsEnumerable,Fl=(s,t,r)=>t in s?V0(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,J0=(s,t)=>{for(var r in t||(t={}))G0.call(t,r)&&Fl(s,r,t[r]);if(Kl)for(var r of Kl(t))W0.call(t,r)&&Fl(s,r,t[r]);return s},Q0=(s,t)=>K0(s,F0(t));function Bo(s){return Q0(J0({},s),{level:(s==null?void 0:s.level)||k0.level})}function Y0(s,t=os){return s[t]||""}function Z0(s,t,r=os){return s[r]=t,s}function It(s,t=os){let r="";return typeof s.bindings>"u"?r=Y0(s,t):r=s.bindings().context||"",r}function X0(s,t,r=os){const n=It(s,r);return n.trim()?`${n}/${t}`:t}function Pt(s,t,r=os){const n=X0(s,t,r),o=s.child({context:n});return Z0(o,n,r)}class e1 extends Oi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let t1=class extends Oi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},r1=class{constructor(t,r){this.logger=t,this.core=r}},i1=class extends Oi{constructor(t,r){super(),this.relayer=t,this.logger=r}},n1=class extends Oi{constructor(t){super()}},s1=class{constructor(t,r,n,o){this.core=t,this.logger=r,this.name=n}};class o1 extends Oi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let a1=class extends Oi{constructor(t,r){super(),this.core=t,this.logger=r}},c1=class{constructor(t,r){this.projectId=t,this.logger=r}},u1=class{constructor(t,r){this.projectId=t,this.logger=r}},h1=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},l1=class{constructor(t){this.client=t}};function f1(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function op(s,...t){if(!f1(s))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(s.length))throw new Error("Uint8Array expected of length "+t+", got length="+s.length)}function Gl(s,t=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(t&&s.finished)throw new Error("Hash#digest() has already been called")}function p1(s,t){op(s);const r=t.outputLen;if(s.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const cn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $c=s=>new DataView(s.buffer,s.byteOffset,s.byteLength);function d1(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function ap(s){return typeof s=="string"&&(s=d1(s)),op(s),s}class g1{clone(){return this._cloneInto()}}function y1(s){const t=n=>s().update(ap(n)).digest(),r=s();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>s(),t}function cp(s=32){if(cn&&typeof cn.getRandomValues=="function")return cn.getRandomValues(new Uint8Array(s));if(cn&&typeof cn.randomBytes=="function")return cn.randomBytes(s);throw new Error("crypto.getRandomValues must be defined")}function v1(s,t,r,n){if(typeof s.setBigUint64=="function")return s.setBigUint64(t,r,n);const o=BigInt(32),c=BigInt(4294967295),h=Number(r>>o&c),p=Number(r&c),f=n?4:0,g=n?0:4;s.setUint32(t+f,h,n),s.setUint32(t+g,p,n)}class m1 extends g1{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=$c(this.buffer)}update(t){Gl(this);const{view:r,buffer:n,blockLen:o}=this;t=ap(t);const c=t.length;for(let h=0;h<c;){const p=Math.min(o-this.pos,c-h);if(p===o){const f=$c(t);for(;o<=c-h;h+=o)this.process(f,h);continue}n.set(t.subarray(h,h+p),this.pos),this.pos+=p,h+=p,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Gl(this),p1(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:c}=this;let{pos:h}=this;r[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>o-h&&(this.process(n,0),h=0);for(let b=h;b<o;b++)r[b]=0;v1(n,o-8,BigInt(this.length*8),c),this.process(n,0);const p=$c(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=f/4,v=this.get();if(g>v.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<g;b++)p.setUint32(4*b,v[b],c)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:c,destroyed:h,pos:p}=this;return t.length=o,t.pos=p,t.finished=c,t.destroyed=h,o%r&&t.buffer.set(n),t}}const Eo=BigInt(2**32-1),Zc=BigInt(32);function up(s,t=!1){return t?{h:Number(s&Eo),l:Number(s>>Zc&Eo)}:{h:Number(s>>Zc&Eo)|0,l:Number(s&Eo)|0}}function w1(s,t=!1){let r=new Uint32Array(s.length),n=new Uint32Array(s.length);for(let o=0;o<s.length;o++){const{h:c,l:h}=up(s[o],t);[r[o],n[o]]=[c,h]}return[r,n]}const b1=(s,t)=>BigInt(s>>>0)<<Zc|BigInt(t>>>0),_1=(s,t,r)=>s>>>r,E1=(s,t,r)=>s<<32-r|t>>>r,I1=(s,t,r)=>s>>>r|t<<32-r,P1=(s,t,r)=>s<<32-r|t>>>r,x1=(s,t,r)=>s<<64-r|t>>>r-32,S1=(s,t,r)=>s>>>r-32|t<<64-r,O1=(s,t)=>t,$1=(s,t)=>s,A1=(s,t,r)=>s<<r|t>>>32-r,R1=(s,t,r)=>t<<r|s>>>32-r,C1=(s,t,r)=>t<<r-32|s>>>64-r,T1=(s,t,r)=>s<<r-32|t>>>64-r;function N1(s,t,r,n){const o=(t>>>0)+(n>>>0);return{h:s+r+(o/2**32|0)|0,l:o|0}}const q1=(s,t,r)=>(s>>>0)+(t>>>0)+(r>>>0),D1=(s,t,r,n)=>t+r+n+(s/2**32|0)|0,z1=(s,t,r,n)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0),j1=(s,t,r,n,o)=>t+r+n+o+(s/2**32|0)|0,L1=(s,t,r,n,o)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),U1=(s,t,r,n,o,c)=>t+r+n+o+c+(s/2**32|0)|0,ue={fromBig:up,split:w1,toBig:b1,shrSH:_1,shrSL:E1,rotrSH:I1,rotrSL:P1,rotrBH:x1,rotrBL:S1,rotr32H:O1,rotr32L:$1,rotlSH:A1,rotlSL:R1,rotlBH:C1,rotlBL:T1,add:N1,add3L:q1,add3H:D1,add4L:z1,add4H:j1,add5H:U1,add5L:L1},[M1,B1]=ue.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))),Xr=new Uint32Array(80),ei=new Uint32Array(80);class H1 extends m1{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:r,Bh:n,Bl:o,Ch:c,Cl:h,Dh:p,Dl:f,Eh:g,El:v,Fh:b,Fl:E,Gh:O,Gl:S,Hh:D,Hl:k}=this;return[t,r,n,o,c,h,p,f,g,v,b,E,O,S,D,k]}set(t,r,n,o,c,h,p,f,g,v,b,E,O,S,D,k){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=c|0,this.Cl=h|0,this.Dh=p|0,this.Dl=f|0,this.Eh=g|0,this.El=v|0,this.Fh=b|0,this.Fl=E|0,this.Gh=O|0,this.Gl=S|0,this.Hh=D|0,this.Hl=k|0}process(t,r){for(let N=0;N<16;N++,r+=4)Xr[N]=t.getUint32(r),ei[N]=t.getUint32(r+=4);for(let N=16;N<80;N++){const L=Xr[N-15]|0,W=ei[N-15]|0,le=ue.rotrSH(L,W,1)^ue.rotrSH(L,W,8)^ue.shrSH(L,W,7),re=ue.rotrSL(L,W,1)^ue.rotrSL(L,W,8)^ue.shrSL(L,W,7),oe=Xr[N-2]|0,we=ei[N-2]|0,zt=ue.rotrSH(oe,we,19)^ue.rotrBH(oe,we,61)^ue.shrSH(oe,we,6),jt=ue.rotrSL(oe,we,19)^ue.rotrBL(oe,we,61)^ue.shrSL(oe,we,6),xt=ue.add4L(re,jt,ei[N-7],ei[N-16]),mr=ue.add4H(xt,le,zt,Xr[N-7],Xr[N-16]);Xr[N]=mr|0,ei[N]=xt|0}let{Ah:n,Al:o,Bh:c,Bl:h,Ch:p,Cl:f,Dh:g,Dl:v,Eh:b,El:E,Fh:O,Fl:S,Gh:D,Gl:k,Hh:H,Hl:Q}=this;for(let N=0;N<80;N++){const L=ue.rotrSH(b,E,14)^ue.rotrSH(b,E,18)^ue.rotrBH(b,E,41),W=ue.rotrSL(b,E,14)^ue.rotrSL(b,E,18)^ue.rotrBL(b,E,41),le=b&O^~b&D,re=E&S^~E&k,oe=ue.add5L(Q,W,re,B1[N],ei[N]),we=ue.add5H(oe,H,L,le,M1[N],Xr[N]),zt=oe|0,jt=ue.rotrSH(n,o,28)^ue.rotrBH(n,o,34)^ue.rotrBH(n,o,39),xt=ue.rotrSL(n,o,28)^ue.rotrBL(n,o,34)^ue.rotrBL(n,o,39),mr=n&c^n&p^c&p,Ur=o&h^o&f^h&f;H=D|0,Q=k|0,D=O|0,k=S|0,O=b|0,S=E|0,{h:b,l:E}=ue.add(g|0,v|0,we|0,zt|0),g=p|0,v=f|0,p=c|0,f=h|0,c=n|0,h=o|0;const ee=ue.add3L(zt,xt,Ur);n=ue.add3H(ee,we,jt,mr),o=ee|0}({h:n,l:o}=ue.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:c,l:h}=ue.add(this.Bh|0,this.Bl|0,c|0,h|0),{h:p,l:f}=ue.add(this.Ch|0,this.Cl|0,p|0,f|0),{h:g,l:v}=ue.add(this.Dh|0,this.Dl|0,g|0,v|0),{h:b,l:E}=ue.add(this.Eh|0,this.El|0,b|0,E|0),{h:O,l:S}=ue.add(this.Fh|0,this.Fl|0,O|0,S|0),{h:D,l:k}=ue.add(this.Gh|0,this.Gl|0,D|0,k|0),{h:H,l:Q}=ue.add(this.Hh|0,this.Hl|0,H|0,Q|0),this.set(n,o,c,h,p,f,g,v,b,E,O,S,D,k,H,Q)}roundClean(){Xr.fill(0),ei.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const k1=y1(()=>new H1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gu=BigInt(0),hp=BigInt(1),V1=BigInt(2);function yu(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function vu(s){if(!yu(s))throw new Error("Uint8Array expected")}function Ac(s,t){if(typeof t!="boolean")throw new Error(s+" boolean expected, got "+t)}const K1=Array.from({length:256},(s,t)=>t.toString(16).padStart(2,"0"));function mu(s){vu(s);let t="";for(let r=0;r<s.length;r++)t+=K1[s[r]];return t}function lp(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?gu:BigInt("0x"+s)}const qr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Wl(s){if(s>=qr._0&&s<=qr._9)return s-qr._0;if(s>=qr.A&&s<=qr.F)return s-(qr.A-10);if(s>=qr.a&&s<=qr.f)return s-(qr.a-10)}function fp(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);const t=s.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,c=0;o<r;o++,c+=2){const h=Wl(s.charCodeAt(c)),p=Wl(s.charCodeAt(c+1));if(h===void 0||p===void 0){const f=s[c]+s[c+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+c)}n[o]=h*16+p}return n}function F1(s){return lp(mu(s))}function To(s){return vu(s),lp(mu(Uint8Array.from(s).reverse()))}function pp(s,t){return fp(s.toString(16).padStart(t*2,"0"))}function Xc(s,t){return pp(s,t).reverse()}function Dr(s,t,r){let n;if(typeof t=="string")try{n=fp(t)}catch(c){throw new Error(s+" must be hex string or Uint8Array, cause: "+c)}else if(yu(t))n=Uint8Array.from(t);else throw new Error(s+" must be hex string or Uint8Array");const o=n.length;if(typeof r=="number"&&o!==r)throw new Error(s+" of length "+r+" expected, got "+o);return n}function Jl(...s){let t=0;for(let n=0;n<s.length;n++){const o=s[n];vu(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<s.length;n++){const c=s[n];r.set(c,o),o+=c.length}return r}const Rc=s=>typeof s=="bigint"&&gu<=s;function G1(s,t,r){return Rc(s)&&Rc(t)&&Rc(r)&&t<=s&&s<r}function Vn(s,t,r,n){if(!G1(t,r,n))throw new Error("expected valid "+s+": "+r+" <= n < "+n+", got "+t)}function W1(s){let t;for(t=0;s>gu;s>>=hp,t+=1);return t}const J1=s=>(V1<<BigInt(s-1))-hp,Q1={bigint:s=>typeof s=="bigint",function:s=>typeof s=="function",boolean:s=>typeof s=="boolean",string:s=>typeof s=="string",stringOrUint8Array:s=>typeof s=="string"||yu(s),isSafeInteger:s=>Number.isSafeInteger(s),array:s=>Array.isArray(s),field:(s,t)=>t.Fp.isValid(s),hash:s=>typeof s=="function"&&Number.isSafeInteger(s.outputLen)};function wu(s,t,r={}){const n=(o,c,h)=>{const p=Q1[c];if(typeof p!="function")throw new Error("invalid validator function");const f=s[o];if(!(h&&f===void 0)&&!p(f,s))throw new Error("param "+String(o)+" is invalid. Expected "+c+", got "+f)};for(const[o,c]of Object.entries(t))n(o,c,!1);for(const[o,c]of Object.entries(r))n(o,c,!0);return s}function Ql(s){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(o!==void 0)return o;const c=s(r,...n);return t.set(r,c),c}}const Ze=BigInt(0),He=BigInt(1),Pi=BigInt(2),Y1=BigInt(3),eu=BigInt(4),Yl=BigInt(5),Zl=BigInt(8);function We(s,t){const r=s%t;return r>=Ze?r:t+r}function Z1(s,t,r){if(t<Ze)throw new Error("invalid exponent, negatives unsupported");if(r<=Ze)throw new Error("invalid modulus");if(r===He)return Ze;let n=He;for(;t>Ze;)t&He&&(n=n*s%r),s=s*s%r,t>>=He;return n}function gr(s,t,r){let n=s;for(;t-- >Ze;)n*=n,n%=r;return n}function Xl(s,t){if(s===Ze)throw new Error("invert: expected non-zero number");if(t<=Ze)throw new Error("invert: expected positive modulus, got "+t);let r=We(s,t),n=t,o=Ze,c=He;for(;r!==Ze;){const h=n/r,p=n%r,f=o-c*h;n=r,r=p,o=c,c=f}if(n!==He)throw new Error("invert: does not exist");return We(o,t)}function X1(s){const t=(s-He)/Pi;let r,n,o;for(r=s-He,n=0;r%Pi===Ze;r/=Pi,n++);for(o=Pi;o<s&&Z1(o,t,s)!==s-He;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const h=(s+He)/eu;return function(p,f){const g=p.pow(f,h);if(!p.eql(p.sqr(g),f))throw new Error("Cannot find square root");return g}}const c=(r+He)/Pi;return function(h,p){if(h.pow(p,t)===h.neg(h.ONE))throw new Error("Cannot find square root");let f=n,g=h.pow(h.mul(h.ONE,o),r),v=h.pow(p,c),b=h.pow(p,r);for(;!h.eql(b,h.ONE);){if(h.eql(b,h.ZERO))return h.ZERO;let E=1;for(let S=h.sqr(b);E<f&&!h.eql(S,h.ONE);E++)S=h.sqr(S);const O=h.pow(g,He<<BigInt(f-E-1));g=h.sqr(O),v=h.mul(v,O),b=h.mul(b,g),f=E}return v}}function eE(s){if(s%eu===Y1){const t=(s+He)/eu;return function(r,n){const o=r.pow(n,t);if(!r.eql(r.sqr(o),n))throw new Error("Cannot find square root");return o}}if(s%Zl===Yl){const t=(s-Yl)/Zl;return function(r,n){const o=r.mul(n,Pi),c=r.pow(o,t),h=r.mul(n,c),p=r.mul(r.mul(h,Pi),c),f=r.mul(h,r.sub(p,r.ONE));if(!r.eql(r.sqr(f),n))throw new Error("Cannot find square root");return f}}return X1(s)}const tE=(s,t)=>(We(s,t)&He)===He,rE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function iE(s){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=rE.reduce((n,o)=>(n[o]="function",n),t);return wu(s,r)}function nE(s,t,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return s.ONE;if(r===He)return t;let n=s.ONE,o=t;for(;r>Ze;)r&He&&(n=s.mul(n,o)),o=s.sqr(o),r>>=He;return n}function sE(s,t){const r=new Array(t.length),n=t.reduce((c,h,p)=>s.is0(h)?c:(r[p]=c,s.mul(c,h)),s.ONE),o=s.inv(n);return t.reduceRight((c,h,p)=>s.is0(h)?c:(r[p]=s.mul(c,r[p]),s.mul(c,h)),o),r}function dp(s,t){const r=t!==void 0?t:s.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function gp(s,t,r=!1,n={}){if(s<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+s);const{nBitLength:o,nByteLength:c}=dp(s,t);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const p=Object.freeze({ORDER:s,isLE:r,BITS:o,BYTES:c,MASK:J1(o),ZERO:Ze,ONE:He,create:f=>We(f,s),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ze<=f&&f<s},is0:f=>f===Ze,isOdd:f=>(f&He)===He,neg:f=>We(-f,s),eql:(f,g)=>f===g,sqr:f=>We(f*f,s),add:(f,g)=>We(f+g,s),sub:(f,g)=>We(f-g,s),mul:(f,g)=>We(f*g,s),pow:(f,g)=>nE(p,f,g),div:(f,g)=>We(f*Xl(g,s),s),sqrN:f=>f*f,addN:(f,g)=>f+g,subN:(f,g)=>f-g,mulN:(f,g)=>f*g,inv:f=>Xl(f,s),sqrt:n.sqrt||(f=>(h||(h=eE(s)),h(p,f))),invertBatch:f=>sE(p,f),cmov:(f,g,v)=>v?g:f,toBytes:f=>r?Xc(f,c):pp(f,c),fromBytes:f=>{if(f.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);return r?To(f):F1(f)}});return Object.freeze(p)}const ef=BigInt(0),Io=BigInt(1);function Cc(s,t){const r=t.negate();return s?r:t}function yp(s,t){if(!Number.isSafeInteger(s)||s<=0||s>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+s)}function Tc(s,t){yp(s,t);const r=Math.ceil(t/s)+1,n=2**(s-1);return{windows:r,windowSize:n}}function oE(s,t){if(!Array.isArray(s))throw new Error("array expected");s.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function aE(s,t){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}const Nc=new WeakMap,vp=new WeakMap;function qc(s){return vp.get(s)||1}function cE(s,t){return{constTimeNegate:Cc,hasPrecomputes(r){return qc(r)!==1},unsafeLadder(r,n,o=s.ZERO){let c=r;for(;n>ef;)n&Io&&(o=o.add(c)),c=c.double(),n>>=Io;return o},precomputeWindow(r,n){const{windows:o,windowSize:c}=Tc(n,t),h=[];let p=r,f=p;for(let g=0;g<o;g++){f=p,h.push(f);for(let v=1;v<c;v++)f=f.add(p),h.push(f);p=f.double()}return h},wNAF(r,n,o){const{windows:c,windowSize:h}=Tc(r,t);let p=s.ZERO,f=s.BASE;const g=BigInt(2**r-1),v=2**r,b=BigInt(r);for(let E=0;E<c;E++){const O=E*h;let S=Number(o&g);o>>=b,S>h&&(S-=v,o+=Io);const D=O,k=O+Math.abs(S)-1,H=E%2!==0,Q=S<0;S===0?f=f.add(Cc(H,n[D])):p=p.add(Cc(Q,n[k]))}return{p,f}},wNAFUnsafe(r,n,o,c=s.ZERO){const{windows:h,windowSize:p}=Tc(r,t),f=BigInt(2**r-1),g=2**r,v=BigInt(r);for(let b=0;b<h;b++){const E=b*p;if(o===ef)break;let O=Number(o&f);if(o>>=v,O>p&&(O-=g,o+=Io),O===0)continue;let S=n[E+Math.abs(O)-1];O<0&&(S=S.negate()),c=c.add(S)}return c},getPrecomputes(r,n,o){let c=Nc.get(n);return c||(c=this.precomputeWindow(n,r),r!==1&&Nc.set(n,o(c))),c},wNAFCached(r,n,o){const c=qc(r);return this.wNAF(c,this.getPrecomputes(c,r,o),n)},wNAFCachedUnsafe(r,n,o,c){const h=qc(r);return h===1?this.unsafeLadder(r,n,c):this.wNAFUnsafe(h,this.getPrecomputes(h,r,o),n,c)},setWindowSize(r,n){yp(n,t),vp.set(r,n),Nc.delete(r)}}}function uE(s,t,r,n){if(oE(r,s),aE(n,t),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const o=s.ZERO,c=W1(BigInt(r.length)),h=c>12?c-3:c>4?c-2:c?2:1,p=(1<<h)-1,f=new Array(p+1).fill(o),g=Math.floor((t.BITS-1)/h)*h;let v=o;for(let b=g;b>=0;b-=h){f.fill(o);for(let O=0;O<n.length;O++){const S=n[O],D=Number(S>>BigInt(b)&BigInt(p));f[D]=f[D].add(r[O])}let E=o;for(let O=f.length-1,S=o;O>0;O--)S=S.add(f[O]),E=E.add(S);if(v=v.add(E),b!==0)for(let O=0;O<h;O++)v=v.double()}return v}function hE(s){return iE(s.Fp),wu(s,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...dp(s.n,s.nBitLength),...s,p:s.Fp.ORDER})}const ir=BigInt(0),wt=BigInt(1),Po=BigInt(2),lE=BigInt(8),fE={zip215:!0};function pE(s){const t=hE(s);return wu(s,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function dE(s){const t=pE(s),{Fp:r,n,prehash:o,hash:c,randomBytes:h,nByteLength:p,h:f}=t,g=Po<<BigInt(p*8)-wt,v=r.create,b=gp(t.n,t.nBitLength),E=t.uvRatio||((ee,z)=>{try{return{isValid:!0,value:r.sqrt(ee*r.inv(z))}}catch{return{isValid:!1,value:ir}}}),O=t.adjustScalarBytes||(ee=>ee),S=t.domain||((ee,z,K)=>{if(Ac("phflag",K),z.length||K)throw new Error("Contexts/pre-hash are not supported");return ee});function D(ee,z){Vn("coordinate "+ee,z,ir,g)}function k(ee){if(!(ee instanceof N))throw new Error("ExtendedPoint expected")}const H=Ql((ee,z)=>{const{ex:K,ey:F,ez:de}=ee,fe=ee.is0();z==null&&(z=fe?lE:r.inv(de));const ae=v(K*z),$e=v(F*z),be=v(de*z);if(fe)return{x:ir,y:wt};if(be!==wt)throw new Error("invZ was invalid");return{x:ae,y:$e}}),Q=Ql(ee=>{const{a:z,d:K}=t;if(ee.is0())throw new Error("bad point: ZERO");const{ex:F,ey:de,ez:fe,et:ae}=ee,$e=v(F*F),be=v(de*de),Ae=v(fe*fe),Y=v(Ae*Ae),ze=v($e*z),St=v(Ae*v(ze+be)),Re=v(Y+v(K*v($e*be)));if(St!==Re)throw new Error("bad point: equation left != right (1)");const Le=v(F*de),Ot=v(fe*ae);if(Le!==Ot)throw new Error("bad point: equation left != right (2)");return!0});class N{constructor(z,K,F,de){this.ex=z,this.ey=K,this.ez=F,this.et=de,D("x",z),D("y",K),D("z",F),D("t",de),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(z){if(z instanceof N)throw new Error("extended point not allowed");const{x:K,y:F}=z||{};return D("x",K),D("y",F),new N(K,F,wt,v(K*F))}static normalizeZ(z){const K=r.invertBatch(z.map(F=>F.ez));return z.map((F,de)=>F.toAffine(K[de])).map(N.fromAffine)}static msm(z,K){return uE(N,b,z,K)}_setWindowSize(z){le.setWindowSize(this,z)}assertValidity(){Q(this)}equals(z){k(z);const{ex:K,ey:F,ez:de}=this,{ex:fe,ey:ae,ez:$e}=z,be=v(K*$e),Ae=v(fe*de),Y=v(F*$e),ze=v(ae*de);return be===Ae&&Y===ze}is0(){return this.equals(N.ZERO)}negate(){return new N(v(-this.ex),this.ey,this.ez,v(-this.et))}double(){const{a:z}=t,{ex:K,ey:F,ez:de}=this,fe=v(K*K),ae=v(F*F),$e=v(Po*v(de*de)),be=v(z*fe),Ae=K+F,Y=v(v(Ae*Ae)-fe-ae),ze=be+ae,St=ze-$e,Re=be-ae,Le=v(Y*St),Ot=v(ze*Re),ut=v(Y*Re),$t=v(St*ze);return new N(Le,Ot,$t,ut)}add(z){k(z);const{a:K,d:F}=t,{ex:de,ey:fe,ez:ae,et:$e}=this,{ex:be,ey:Ae,ez:Y,et:ze}=z;if(K===BigInt(-1)){const Ri=v((fe-de)*(Ae+be)),ar=v((fe+de)*(Ae-be)),et=v(ar-Ri);if(et===ir)return this.double();const cr=v(ae*Po*ze),br=v($e*Po*Y),Ci=br+cr,ur=ar+Ri,Ti=br-cr,Lt=v(Ci*et),Ut=v(ur*Ti),Br=v(Ci*Ti),nt=v(et*ur);return new N(Lt,Ut,nt,Br)}const St=v(de*be),Re=v(fe*Ae),Le=v($e*F*ze),Ot=v(ae*Y),ut=v((de+fe)*(be+Ae)-St-Re),$t=Ot-Le,Mr=Ot+Le,Xe=v(Re-K*St),wr=v(ut*$t),gn=v(Mr*Xe),At=v(ut*Xe),Ai=v($t*Mr);return new N(wr,gn,Ai,At)}subtract(z){return this.add(z.negate())}wNAF(z){return le.wNAFCached(this,z,N.normalizeZ)}multiply(z){const K=z;Vn("scalar",K,wt,n);const{p:F,f:de}=this.wNAF(K);return N.normalizeZ([F,de])[0]}multiplyUnsafe(z,K=N.ZERO){const F=z;return Vn("scalar",F,ir,n),F===ir?W:this.is0()||F===wt?this:le.wNAFCachedUnsafe(this,F,N.normalizeZ,K)}isSmallOrder(){return this.multiplyUnsafe(f).is0()}isTorsionFree(){return le.unsafeLadder(this,n).is0()}toAffine(z){return H(this,z)}clearCofactor(){const{h:z}=t;return z===wt?this:this.multiplyUnsafe(z)}static fromHex(z,K=!1){const{d:F,a:de}=t,fe=r.BYTES;z=Dr("pointHex",z,fe),Ac("zip215",K);const ae=z.slice(),$e=z[fe-1];ae[fe-1]=$e&-129;const be=To(ae),Ae=K?g:r.ORDER;Vn("pointHex.y",be,ir,Ae);const Y=v(be*be),ze=v(Y-wt),St=v(F*Y-de);let{isValid:Re,value:Le}=E(ze,St);if(!Re)throw new Error("Point.fromHex: invalid y coordinate");const Ot=(Le&wt)===wt,ut=($e&128)!==0;if(!K&&Le===ir&&ut)throw new Error("Point.fromHex: x=0 and x_0=1");return ut!==Ot&&(Le=v(-Le)),N.fromAffine({x:Le,y:be})}static fromPrivateKey(z){return we(z).point}toRawBytes(){const{x:z,y:K}=this.toAffine(),F=Xc(K,r.BYTES);return F[F.length-1]|=z&wt?128:0,F}toHex(){return mu(this.toRawBytes())}}N.BASE=new N(t.Gx,t.Gy,wt,v(t.Gx*t.Gy)),N.ZERO=new N(ir,wt,wt,ir);const{BASE:L,ZERO:W}=N,le=cE(N,p*8);function re(ee){return We(ee,n)}function oe(ee){return re(To(ee))}function we(ee){const z=r.BYTES;ee=Dr("private key",ee,z);const K=Dr("hashed private key",c(ee),2*z),F=O(K.slice(0,z)),de=K.slice(z,2*z),fe=oe(F),ae=L.multiply(fe),$e=ae.toRawBytes();return{head:F,prefix:de,scalar:fe,point:ae,pointBytes:$e}}function zt(ee){return we(ee).pointBytes}function jt(ee=new Uint8Array,...z){const K=Jl(...z);return oe(c(S(K,Dr("context",ee),!!o)))}function xt(ee,z,K={}){ee=Dr("message",ee),o&&(ee=o(ee));const{prefix:F,scalar:de,pointBytes:fe}=we(z),ae=jt(K.context,F,ee),$e=L.multiply(ae).toRawBytes(),be=jt(K.context,$e,fe,ee),Ae=re(ae+be*de);Vn("signature.s",Ae,ir,n);const Y=Jl($e,Xc(Ae,r.BYTES));return Dr("result",Y,r.BYTES*2)}const mr=fE;function Ur(ee,z,K,F=mr){const{context:de,zip215:fe}=F,ae=r.BYTES;ee=Dr("signature",ee,2*ae),z=Dr("message",z),K=Dr("publicKey",K,ae),fe!==void 0&&Ac("zip215",fe),o&&(z=o(z));const $e=To(ee.slice(ae,2*ae));let be,Ae,Y;try{be=N.fromHex(K,fe),Ae=N.fromHex(ee.slice(0,ae),fe),Y=L.multiplyUnsafe($e)}catch{return!1}if(!fe&&be.isSmallOrder())return!1;const ze=jt(de,Ae.toRawBytes(),be.toRawBytes(),z);return Ae.add(be.multiplyUnsafe(ze)).subtract(Y).clearCofactor().equals(N.ZERO)}return L._setWindowSize(8),{CURVE:t,getPublicKey:zt,sign:xt,verify:Ur,ExtendedPoint:N,utils:{getExtendedPublicKey:we,randomPrivateKey:()=>h(r.BYTES),precompute(ee=8,z=N.BASE){return z._setWindowSize(ee),z.multiply(BigInt(3)),z}}}}BigInt(0),BigInt(1);const bu=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),tf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const gE=BigInt(1),rf=BigInt(2);BigInt(3);const yE=BigInt(5),vE=BigInt(8);function mE(s){const t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),c=bu,h=s*s%c*s%c,p=gr(h,rf,c)*h%c,f=gr(p,gE,c)*s%c,g=gr(f,yE,c)*f%c,v=gr(g,t,c)*g%c,b=gr(v,r,c)*v%c,E=gr(b,n,c)*b%c,O=gr(E,o,c)*E%c,S=gr(O,o,c)*E%c,D=gr(S,t,c)*g%c;return{pow_p_5_8:gr(D,rf,c)*s%c,b2:h}}function wE(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}function bE(s,t){const r=bu,n=We(t*t*t,r),o=We(n*n*t,r),c=mE(s*o).pow_p_5_8;let h=We(s*n*c,r);const p=We(t*h*h,r),f=h,g=We(h*tf,r),v=p===s,b=p===We(-s,r),E=p===We(-s*tf,r);return v&&(h=f),(b||E)&&(h=g),tE(h,r)&&(h=We(-h,r)),{isValid:v||b,value:h}}const _E=gp(bu,void 0,!0),EE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:_E,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:vE,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:k1,randomBytes:cp,adjustScalarBytes:wE,uvRatio:bE},mp=dE(EE),IE="EdDSA",PE="JWT",wp=".",bp="base64url",xE="utf8",SE="utf8",OE=":",$E="did",AE="key",nf="base58btc",RE="z",CE="K36",TE=32;function _u(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function _p(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?_u(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Ep(s,t){t||(t=s.reduce((o,c)=>o+c.length,0));const r=_p(t);let n=0;for(const o of s)r.set(o,n),n+=o.length;return _u(r)}function NE(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var c=s.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=s.length,f=s.charAt(0),g=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,k=0,H=0,Q=S.length;H!==Q&&S[H]===0;)H++,D++;for(var N=(Q-H)*v+1>>>0,L=new Uint8Array(N);H!==Q;){for(var W=S[H],le=0,re=N-1;(W!==0||le<k)&&re!==-1;re--,le++)W+=256*L[re]>>>0,L[re]=W%p>>>0,W=W/p>>>0;if(W!==0)throw new Error("Non-zero carry");k=le,H++}for(var oe=N-k;oe!==N&&L[oe]===0;)oe++;for(var we=f.repeat(D);oe<N;++oe)we+=s.charAt(L[oe]);return we}function E(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var k=0,H=0;S[D]===f;)k++,D++;for(var Q=(S.length-D)*g+1>>>0,N=new Uint8Array(Q);S[D];){var L=r[S.charCodeAt(D)];if(L===255)return;for(var W=0,le=Q-1;(L!==0||W<H)&&le!==-1;le--,W++)L+=p*N[le]>>>0,N[le]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");H=W,D++}if(S[D]!==" "){for(var re=Q-H;re!==Q&&N[re]===0;)re++;for(var oe=new Uint8Array(k+(Q-re)),we=k;re!==Q;)oe[we++]=N[re++];return oe}}}function O(S){var D=E(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:E,decode:O}}var qE=NE,DE=qE;const Ip=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},zE=s=>new TextEncoder().encode(s),jE=s=>new TextDecoder().decode(s);let LE=class{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},UE=class{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Pp(this,t)}};class ME{constructor(t){this.decoders=t}or(t){return Pp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Pp=(s,t)=>new ME({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});let BE=class{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new LE(t,r,n),this.decoder=new UE(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const Ho=({name:s,prefix:t,encode:r,decode:n})=>new BE(s,t,r,n),as=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=DE(r,t);return Ho({prefix:s,name:t,encode:n,decode:c=>Ip(o(c))})},HE=(s,t,r,n)=>{const o={};for(let v=0;v<t.length;++v)o[t[v]]=v;let c=s.length;for(;s[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,g=0;for(let v=0;v<c;++v){const b=o[s[v]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[g++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},kE=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<s.length;++f)for(p=p<<8|s[f],h+=8;h>r;)h-=r,c+=t[o&p>>h];if(h&&(c+=t[o&p<<r-h]),n)for(;c.length*r&7;)c+="=";return c},rt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Ho({prefix:t,name:s,encode(o){return kE(o,n,r)},decode(o){return HE(o,n,r,s)}}),VE=Ho({prefix:"\0",name:"identity",encode:s=>jE(s),decode:s=>zE(s)});var KE=Object.freeze({__proto__:null,identity:VE});const FE=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var GE=Object.freeze({__proto__:null,base2:FE});const WE=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var JE=Object.freeze({__proto__:null,base8:WE});const QE=as({prefix:"9",name:"base10",alphabet:"0123456789"});var YE=Object.freeze({__proto__:null,base10:QE});const ZE=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),XE=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var eI=Object.freeze({__proto__:null,base16:ZE,base16upper:XE});const tI=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rI=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),iI=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),nI=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),sI=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oI=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aI=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cI=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uI=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var hI=Object.freeze({__proto__:null,base32:tI,base32upper:rI,base32pad:iI,base32padupper:nI,base32hex:sI,base32hexupper:oI,base32hexpad:aI,base32hexpadupper:cI,base32z:uI});const lI=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fI=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pI=Object.freeze({__proto__:null,base36:lI,base36upper:fI});const dI=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gI=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yI=Object.freeze({__proto__:null,base58btc:dI,base58flickr:gI});const vI=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),mI=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wI=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),bI=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _I=Object.freeze({__proto__:null,base64:vI,base64pad:mI,base64url:wI,base64urlpad:bI});const xp=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),EI=xp.reduce((s,t,r)=>(s[r]=t,s),[]),II=xp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function PI(s){return s.reduce((t,r)=>(t+=EI[r],t),"")}function xI(s){const t=[];for(const r of s){const n=II[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const SI=Ho({prefix:"🚀",name:"base256emoji",encode:PI,decode:xI});var OI=Object.freeze({__proto__:null,base256emoji:SI}),$I=Sp,sf=128,AI=127,RI=~AI,CI=Math.pow(2,31);function Sp(s,t,r){t=t||[],r=r||0;for(var n=r;s>=CI;)t[r++]=s&255|sf,s/=128;for(;s&RI;)t[r++]=s&255|sf,s>>>=7;return t[r]=s|0,Sp.bytes=r-n+1,t}var TI=tu,NI=128,of=127;function tu(s,n){var r=0,n=n||0,o=0,c=n,h,p=s.length;do{if(c>=p)throw tu.bytes=0,new RangeError("Could not decode varint");h=s[c++],r+=o<28?(h&of)<<o:(h&of)*Math.pow(2,o),o+=7}while(h>=NI);return tu.bytes=c-n,r}var qI=Math.pow(2,7),DI=Math.pow(2,14),zI=Math.pow(2,21),jI=Math.pow(2,28),LI=Math.pow(2,35),UI=Math.pow(2,42),MI=Math.pow(2,49),BI=Math.pow(2,56),HI=Math.pow(2,63),kI=function(s){return s<qI?1:s<DI?2:s<zI?3:s<jI?4:s<LI?5:s<UI?6:s<MI?7:s<BI?8:s<HI?9:10},VI={encode:$I,decode:TI,encodingLength:kI},Op=VI;const af=(s,t,r=0)=>(Op.encode(s,t,r),t),cf=s=>Op.encodingLength(s),ru=(s,t)=>{const r=t.byteLength,n=cf(s),o=n+cf(r),c=new Uint8Array(o+r);return af(s,c,0),af(r,c,n),c.set(t,o),new KI(s,r,t,c)};class KI{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const $p=({name:s,code:t,encode:r})=>new FI(s,t,r);class FI{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?ru(this.code,r):r.then(n=>ru(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Ap=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),GI=$p({name:"sha2-256",code:18,encode:Ap("SHA-256")}),WI=$p({name:"sha2-512",code:19,encode:Ap("SHA-512")});var JI=Object.freeze({__proto__:null,sha256:GI,sha512:WI});const Rp=0,QI="identity",Cp=Ip,YI=s=>ru(Rp,Cp(s)),ZI={code:Rp,name:QI,encode:Cp,digest:YI};var XI=Object.freeze({__proto__:null,identity:ZI});new TextEncoder,new TextDecoder;const uf={...KE,...GE,...JE,...YE,...eI,...hI,...pI,...yI,..._I,...OI};({...JI,...XI});function Tp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const hf=Tp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),Dc=Tp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=_p(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Np={utf8:hf,"utf-8":hf,hex:uf.base16,latin1:Dc,ascii:Dc,binary:Dc,...uf};function Eu(s,t="utf8"){const r=Np[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("utf8"):r.encoder.encode(s).substring(1)}function Iu(s,t="utf8"){const r=Np[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?_u(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}function No(s){return Eu(Iu(is(s),xE),bp)}function qp(s){const t=Iu(CE,nf),r=RE+Eu(Ep([t,s]),nf);return[$E,AE,r].join(OE)}function eP(s){return Eu(s,bp)}function tP(s){return Iu([No(s.header),No(s.payload)].join(wp),SE)}function rP(s){return[No(s.header),No(s.payload),eP(s.signature)].join(wp)}function lf(s=cp(TE)){const t=mp.getPublicKey(s);return{secretKey:Ep([s,t]),publicKey:t}}async function iP(s,t,r,n,o=G.fromMiliseconds(Date.now())){const c={alg:IE,typ:PE},h=qp(n.publicKey),p=o+r,f={iss:h,sub:s,aud:t,iat:o,exp:p},g=tP({header:c,payload:f}),v=mp.sign(g,n.secretKey.slice(0,32));return rP({header:c,payload:f,signature:v})}let nP=class extends Xf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||fu().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{or(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ns(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const sP=()=>typeof WebSocket<"u"?WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),oP=()=>typeof WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ff=s=>s.split("?")[0],pf=10,aP=sP();let cP=class{constructor(t){if(this.url=t,this.events=new Qt.EventEmitter,this.registering=!1,!ql(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(is(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!ql(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const o=new URLSearchParams(t).get("origin"),c=b_.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!__(t)},h=new aP(t,[],c);oP()?h.onerror=p=>{const f=p;n(this.emitError(f.error))}:h.on("error",p=>{n(this.emitError(p))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?zo(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),c=pu(t,o);this.events.emit("payload",c)}parseError(t,r=this.url){return E_(t,ff(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>pf&&this.events.setMaxListeners(pf)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${ff(this.url)}`));return this.events.emit("register_error",r),r}};var qo={exports:{}};qo.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",o=1,c=2,h=9007199254740991,p="[object Arguments]",f="[object Array]",g="[object AsyncFunction]",v="[object Boolean]",b="[object Date]",E="[object Error]",O="[object Function]",S="[object GeneratorFunction]",D="[object Map]",k="[object Number]",H="[object Null]",Q="[object Object]",N="[object Promise]",L="[object Proxy]",W="[object RegExp]",le="[object Set]",re="[object String]",oe="[object Symbol]",we="[object Undefined]",zt="[object WeakMap]",jt="[object ArrayBuffer]",xt="[object DataView]",mr="[object Float32Array]",Ur="[object Float64Array]",ee="[object Int8Array]",z="[object Int16Array]",K="[object Int32Array]",F="[object Uint8Array]",de="[object Uint8ClampedArray]",fe="[object Uint16Array]",ae="[object Uint32Array]",$e=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,Ae=/^(?:0|[1-9]\d*)$/,Y={};Y[mr]=Y[Ur]=Y[ee]=Y[z]=Y[K]=Y[F]=Y[de]=Y[fe]=Y[ae]=!0,Y[p]=Y[f]=Y[jt]=Y[v]=Y[xt]=Y[b]=Y[E]=Y[O]=Y[D]=Y[k]=Y[Q]=Y[W]=Y[le]=Y[re]=Y[zt]=!1;var ze=typeof window=="object"&&window&&window.Object===Object&&window,St=typeof self=="object"&&self&&self.Object===Object&&self,Re=ze||St||Function("return this")(),Le=t&&!t.nodeType&&t,Ot=Le&&!0&&s&&!s.nodeType&&s,ut=Ot&&Ot.exports===Le,$t=ut&&ze.process,Mr=function(){try{return $t&&$t.binding&&$t.binding("util")}catch{}}(),Xe=Mr&&Mr.isTypedArray;function wr(m,I){for(var T=-1,U=m==null?0:m.length,xe=0,ie=[];++T<U;){var Ce=m[T];I(Ce,T,m)&&(ie[xe++]=Ce)}return ie}function gn(m,I){for(var T=-1,U=I.length,xe=m.length;++T<U;)m[xe+T]=I[T];return m}function At(m,I){for(var T=-1,U=m==null?0:m.length;++T<U;)if(I(m[T],T,m))return!0;return!1}function Ai(m,I){for(var T=-1,U=Array(m);++T<m;)U[T]=I(T);return U}function Ri(m){return function(I){return m(I)}}function ar(m,I){return m.has(I)}function et(m,I){return m==null?void 0:m[I]}function cr(m){var I=-1,T=Array(m.size);return m.forEach(function(U,xe){T[++I]=[xe,U]}),T}function br(m,I){return function(T){return m(I(T))}}function Ci(m){var I=-1,T=Array(m.size);return m.forEach(function(U){T[++I]=U}),T}var ur=Array.prototype,Ti=Function.prototype,Lt=Object.prototype,Ut=Re["__core-js_shared__"],Br=Ti.toString,nt=Lt.hasOwnProperty,Ni=function(){var m=/[^.]+$/.exec(Ut&&Ut.keys&&Ut.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),qi=Lt.toString,yn=RegExp("^"+Br.call(nt).replace($e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Di=ut?Re.Buffer:void 0,Hr=Re.Symbol,zi=Re.Uint8Array,ji=Lt.propertyIsEnumerable,Ko=ur.splice,_r=Hr?Hr.toStringTag:void 0,us=Object.getOwnPropertySymbols,hs=Di?Di.isBuffer:void 0,ls=br(Object.keys,Object),vn=Rt(Re,"DataView"),ci=Rt(Re,"Map"),mn=Rt(Re,"Promise"),wn=Rt(Re,"Set"),Li=Rt(Re,"WeakMap"),ui=Rt(Object,"create"),Fo=Pr(vn),Go=Pr(ci),bn=Pr(mn),Wo=Pr(wn),_n=Pr(Li),fs=Hr?Hr.prototype:void 0,En=fs?fs.valueOf:void 0;function Er(m){var I=-1,T=m==null?0:m.length;for(this.clear();++I<T;){var U=m[I];this.set(U[0],U[1])}}function Jo(){this.__data__=ui?ui(null):{},this.size=0}function Qo(m){var I=this.has(m)&&delete this.__data__[m];return this.size-=I?1:0,I}function Yo(m){var I=this.__data__;if(ui){var T=I[m];return T===n?void 0:T}return nt.call(I,m)?I[m]:void 0}function Zo(m){var I=this.__data__;return ui?I[m]!==void 0:nt.call(I,m)}function Xo(m,I){var T=this.__data__;return this.size+=this.has(m)?0:1,T[m]=ui&&I===void 0?n:I,this}Er.prototype.clear=Jo,Er.prototype.delete=Qo,Er.prototype.get=Yo,Er.prototype.has=Zo,Er.prototype.set=Xo;function Mt(m){var I=-1,T=m==null?0:m.length;for(this.clear();++I<T;){var U=m[I];this.set(U[0],U[1])}}function ea(){this.__data__=[],this.size=0}function ta(m){var I=this.__data__,T=hi(I,m);if(T<0)return!1;var U=I.length-1;return T==U?I.pop():Ko.call(I,T,1),--this.size,!0}function ra(m){var I=this.__data__,T=hi(I,m);return T<0?void 0:I[T][1]}function ia(m){return hi(this.__data__,m)>-1}function na(m,I){var T=this.__data__,U=hi(T,m);return U<0?(++this.size,T.push([m,I])):T[U][1]=I,this}Mt.prototype.clear=ea,Mt.prototype.delete=ta,Mt.prototype.get=ra,Mt.prototype.has=ia,Mt.prototype.set=na;function Ir(m){var I=-1,T=m==null?0:m.length;for(this.clear();++I<T;){var U=m[I];this.set(U[0],U[1])}}function Ui(){this.size=0,this.__data__={hash:new Er,map:new(ci||Mt),string:new Er}}function sa(m){var I=kr(this,m).delete(m);return this.size-=I?1:0,I}function Mi(m){return kr(this,m).get(m)}function oa(m){return kr(this,m).has(m)}function aa(m,I){var T=kr(this,m),U=T.size;return T.set(m,I),this.size+=T.size==U?0:1,this}Ir.prototype.clear=Ui,Ir.prototype.delete=sa,Ir.prototype.get=Mi,Ir.prototype.has=oa,Ir.prototype.set=aa;function Bi(m){var I=-1,T=m==null?0:m.length;for(this.__data__=new Ir;++I<T;)this.add(m[I])}function ps(m){return this.__data__.set(m,n),this}function ds(m){return this.__data__.has(m)}Bi.prototype.add=Bi.prototype.push=ps,Bi.prototype.has=ds;function Yt(m){var I=this.__data__=new Mt(m);this.size=I.size}function ca(){this.__data__=new Mt,this.size=0}function ua(m){var I=this.__data__,T=I.delete(m);return this.size=I.size,T}function ha(m){return this.__data__.get(m)}function la(m){return this.__data__.has(m)}function gs(m,I){var T=this.__data__;if(T instanceof Mt){var U=T.__data__;if(!ci||U.length<r-1)return U.push([m,I]),this.size=++T.size,this;T=this.__data__=new Ir(U)}return T.set(m,I),this.size=T.size,this}Yt.prototype.clear=ca,Yt.prototype.delete=ua,Yt.prototype.get=ha,Yt.prototype.has=la,Yt.prototype.set=gs;function ys(m,I){var T=Vi(m),U=!T&&$s(m),xe=!T&&!U&&xn(m),ie=!T&&!U&&!xe&&Cs(m),Ce=T||U||xe||ie,ke=Ce?Ai(m.length,String):[],ye=ke.length;for(var Se in m)nt.call(m,Se)&&!(Ce&&(Se=="length"||xe&&(Se=="offset"||Se=="parent")||ie&&(Se=="buffer"||Se=="byteLength"||Se=="byteOffset")||Is(Se,ye)))&&ke.push(Se);return ke}function hi(m,I){for(var T=m.length;T--;)if(Os(m[T][0],I))return T;return-1}function In(m,I,T){var U=I(m);return Vi(m)?U:gn(U,T(m))}function li(m){return m==null?m===void 0?we:H:_r&&_r in Object(m)?_s(m):da(m)}function Pn(m){return pi(m)&&li(m)==p}function fi(m,I,T,U,xe){return m===I?!0:m==null||I==null||!pi(m)&&!pi(I)?m!==m&&I!==I:vs(m,I,T,U,fi,xe)}function vs(m,I,T,U,xe,ie){var Ce=Vi(m),ke=Vi(I),ye=Ce?f:hr(m),Se=ke?f:hr(I);ye=ye==p?Q:ye,Se=Se==p?Q:Se;var Ue=ye==Q,dt=Se==Q,Ve=ye==Se;if(Ve&&xn(m)){if(!xn(I))return!1;Ce=!0,Ue=!1}if(Ve&&!Ue)return ie||(ie=new Yt),Ce||Cs(m)?Hi(m,I,T,U,xe,ie):pa(m,I,ye,T,U,xe,ie);if(!(T&o)){var Te=Ue&&nt.call(m,"__wrapped__"),ht=dt&&nt.call(I,"__wrapped__");if(Te||ht){var Zt=Te?m.value():m,Bt=ht?I.value():I;return ie||(ie=new Yt),xe(Zt,Bt,T,U,ie)}}return Ve?(ie||(ie=new Yt),bs(m,I,T,U,xe,ie)):!1}function fa(m){if(!Rs(m)||xs(m))return!1;var I=Ki(m)?yn:be;return I.test(Pr(m))}function ms(m){return pi(m)&&As(m.length)&&!!Y[li(m)]}function ws(m){if(!Ss(m))return ls(m);var I=[];for(var T in Object(m))nt.call(m,T)&&T!="constructor"&&I.push(T);return I}function Hi(m,I,T,U,xe,ie){var Ce=T&o,ke=m.length,ye=I.length;if(ke!=ye&&!(Ce&&ye>ke))return!1;var Se=ie.get(m);if(Se&&ie.get(I))return Se==I;var Ue=-1,dt=!0,Ve=T&c?new Bi:void 0;for(ie.set(m,I),ie.set(I,m);++Ue<ke;){var Te=m[Ue],ht=I[Ue];if(U)var Zt=Ce?U(ht,Te,Ue,I,m,ie):U(Te,ht,Ue,m,I,ie);if(Zt!==void 0){if(Zt)continue;dt=!1;break}if(Ve){if(!At(I,function(Bt,lr){if(!ar(Ve,lr)&&(Te===Bt||xe(Te,Bt,T,U,ie)))return Ve.push(lr)})){dt=!1;break}}else if(!(Te===ht||xe(Te,ht,T,U,ie))){dt=!1;break}}return ie.delete(m),ie.delete(I),dt}function pa(m,I,T,U,xe,ie,Ce){switch(T){case xt:if(m.byteLength!=I.byteLength||m.byteOffset!=I.byteOffset)return!1;m=m.buffer,I=I.buffer;case jt:return!(m.byteLength!=I.byteLength||!ie(new zi(m),new zi(I)));case v:case b:case k:return Os(+m,+I);case E:return m.name==I.name&&m.message==I.message;case W:case re:return m==I+"";case D:var ke=cr;case le:var ye=U&o;if(ke||(ke=Ci),m.size!=I.size&&!ye)return!1;var Se=Ce.get(m);if(Se)return Se==I;U|=c,Ce.set(m,I);var Ue=Hi(ke(m),ke(I),U,xe,ie,Ce);return Ce.delete(m),Ue;case oe:if(En)return En.call(m)==En.call(I)}return!1}function bs(m,I,T,U,xe,ie){var Ce=T&o,ke=ki(m),ye=ke.length,Se=ki(I),Ue=Se.length;if(ye!=Ue&&!Ce)return!1;for(var dt=ye;dt--;){var Ve=ke[dt];if(!(Ce?Ve in I:nt.call(I,Ve)))return!1}var Te=ie.get(m);if(Te&&ie.get(I))return Te==I;var ht=!0;ie.set(m,I),ie.set(I,m);for(var Zt=Ce;++dt<ye;){Ve=ke[dt];var Bt=m[Ve],lr=I[Ve];if(U)var Sn=Ce?U(lr,Bt,Ve,I,m,ie):U(Bt,lr,Ve,m,I,ie);if(!(Sn===void 0?Bt===lr||xe(Bt,lr,T,U,ie):Sn)){ht=!1;break}Zt||(Zt=Ve=="constructor")}if(ht&&!Zt){var di=m.constructor,Je=I.constructor;di!=Je&&"constructor"in m&&"constructor"in I&&!(typeof di=="function"&&di instanceof di&&typeof Je=="function"&&Je instanceof Je)&&(ht=!1)}return ie.delete(m),ie.delete(I),ht}function ki(m){return In(m,va,Es)}function kr(m,I){var T=m.__data__;return Ps(I)?T[typeof I=="string"?"string":"hash"]:T.map}function Rt(m,I){var T=et(m,I);return fa(T)?T:void 0}function _s(m){var I=nt.call(m,_r),T=m[_r];try{m[_r]=void 0;var U=!0}catch{}var xe=qi.call(m);return U&&(I?m[_r]=T:delete m[_r]),xe}var Es=us?function(m){return m==null?[]:(m=Object(m),wr(us(m),function(I){return ji.call(m,I)}))}:Pe,hr=li;(vn&&hr(new vn(new ArrayBuffer(1)))!=xt||ci&&hr(new ci)!=D||mn&&hr(mn.resolve())!=N||wn&&hr(new wn)!=le||Li&&hr(new Li)!=zt)&&(hr=function(m){var I=li(m),T=I==Q?m.constructor:void 0,U=T?Pr(T):"";if(U)switch(U){case Fo:return xt;case Go:return D;case bn:return N;case Wo:return le;case _n:return zt}return I});function Is(m,I){return I=I??h,!!I&&(typeof m=="number"||Ae.test(m))&&m>-1&&m%1==0&&m<I}function Ps(m){var I=typeof m;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?m!=="__proto__":m===null}function xs(m){return!!Ni&&Ni in m}function Ss(m){var I=m&&m.constructor,T=typeof I=="function"&&I.prototype||Lt;return m===T}function da(m){return qi.call(m)}function Pr(m){if(m!=null){try{return Br.call(m)}catch{}try{return m+""}catch{}}return""}function Os(m,I){return m===I||m!==m&&I!==I}var $s=Pn(function(){return arguments}())?Pn:function(m){return pi(m)&&nt.call(m,"callee")&&!ji.call(m,"callee")},Vi=Array.isArray;function ga(m){return m!=null&&As(m.length)&&!Ki(m)}var xn=hs||Ie;function ya(m,I){return fi(m,I)}function Ki(m){if(!Rs(m))return!1;var I=li(m);return I==O||I==S||I==g||I==L}function As(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=h}function Rs(m){var I=typeof m;return m!=null&&(I=="object"||I=="function")}function pi(m){return m!=null&&typeof m=="object"}var Cs=Xe?Ri(Xe):ms;function va(m){return ga(m)?ys(m):ws(m)}function Pe(){return[]}function Ie(){return!1}s.exports=ya})(qo,qo.exports);var uP=qo.exports;const hP=hu(uP);function lP(s,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest,c=[],h=[],p={},f=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:f,headers:{keys:function(){return c},entries:function(){return h},get:function(v){return p[v.toLowerCase()]},has:function(v){return v.toLowerCase()in p}}}};for(var g in o.open(t.method||"get",s,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(v,b,E){c.push(b=b.toLowerCase()),h.push([b,E]),p[b]=p[b]?p[b]+","+E:E}),r(f())},o.onerror=n,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(g,t.headers[g]);o.send(t.body||null)})}const fP=Object.freeze(Object.defineProperty({__proto__:null,default:lP},Symbol.toStringTag,{value:"Module"})),df=uu(fP);var pP=self.fetch||(self.fetch=df.default||df);const dP=hu(pP);var gP={};function yP(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var c=s.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=s.length,f=s.charAt(0),g=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,k=0,H=0,Q=S.length;H!==Q&&S[H]===0;)H++,D++;for(var N=(Q-H)*v+1>>>0,L=new Uint8Array(N);H!==Q;){for(var W=S[H],le=0,re=N-1;(W!==0||le<k)&&re!==-1;re--,le++)W+=256*L[re]>>>0,L[re]=W%p>>>0,W=W/p>>>0;if(W!==0)throw new Error("Non-zero carry");k=le,H++}for(var oe=N-k;oe!==N&&L[oe]===0;)oe++;for(var we=f.repeat(D);oe<N;++oe)we+=s.charAt(L[oe]);return we}function E(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var k=0,H=0;S[D]===f;)k++,D++;for(var Q=(S.length-D)*g+1>>>0,N=new Uint8Array(Q);S[D];){var L=r[S.charCodeAt(D)];if(L===255)return;for(var W=0,le=Q-1;(L!==0||W<H)&&le!==-1;le--,W++)L+=p*N[le]>>>0,N[le]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");H=W,D++}if(S[D]!==" "){for(var re=Q-H;re!==Q&&N[re]===0;)re++;for(var oe=new Uint8Array(k+(Q-re)),we=k;re!==Q;)oe[we++]=N[re++];return oe}}}function O(S){var D=E(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:E,decode:O}}var vP=yP,mP=vP;const Dp=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},wP=s=>new TextEncoder().encode(s),bP=s=>new TextDecoder().decode(s);class _P{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class EP{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return zp(this,t)}}class IP{constructor(t){this.decoders=t}or(t){return zp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const zp=(s,t)=>new IP({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class PP{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new _P(t,r,n),this.decoder=new EP(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ko=({name:s,prefix:t,encode:r,decode:n})=>new PP(s,t,r,n),cs=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=mP(r,t);return ko({prefix:s,name:t,encode:n,decode:c=>Dp(o(c))})},xP=(s,t,r,n)=>{const o={};for(let v=0;v<t.length;++v)o[t[v]]=v;let c=s.length;for(;s[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,g=0;for(let v=0;v<c;++v){const b=o[s[v]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[g++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},SP=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<s.length;++f)for(p=p<<8|s[f],h+=8;h>r;)h-=r,c+=t[o&p>>h];if(h&&(c+=t[o&p<<r-h]),n)for(;c.length*r&7;)c+="=";return c},it=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>ko({prefix:t,name:s,encode(o){return SP(o,n,r)},decode(o){return xP(o,n,r,s)}}),OP=ko({prefix:"\0",name:"identity",encode:s=>bP(s),decode:s=>wP(s)});var $P=Object.freeze({__proto__:null,identity:OP});const AP=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var RP=Object.freeze({__proto__:null,base2:AP});const CP=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var TP=Object.freeze({__proto__:null,base8:CP});const NP=cs({prefix:"9",name:"base10",alphabet:"0123456789"});var qP=Object.freeze({__proto__:null,base10:NP});const DP=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),zP=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var jP=Object.freeze({__proto__:null,base16:DP,base16upper:zP});const LP=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),UP=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),MP=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),BP=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),HP=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),kP=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),VP=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),KP=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),FP=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var GP=Object.freeze({__proto__:null,base32:LP,base32upper:UP,base32pad:MP,base32padupper:BP,base32hex:HP,base32hexupper:kP,base32hexpad:VP,base32hexpadupper:KP,base32z:FP});const WP=cs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),JP=cs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var QP=Object.freeze({__proto__:null,base36:WP,base36upper:JP});const YP=cs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ZP=cs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var XP=Object.freeze({__proto__:null,base58btc:YP,base58flickr:ZP});const ex=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tx=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rx=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ix=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var nx=Object.freeze({__proto__:null,base64:ex,base64pad:tx,base64url:rx,base64urlpad:ix});const jp=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),sx=jp.reduce((s,t,r)=>(s[r]=t,s),[]),ox=jp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function ax(s){return s.reduce((t,r)=>(t+=sx[r],t),"")}function cx(s){const t=[];for(const r of s){const n=ox[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const ux=ko({prefix:"🚀",name:"base256emoji",encode:ax,decode:cx});var hx=Object.freeze({__proto__:null,base256emoji:ux}),lx=Lp,gf=128,fx=127,px=~fx,dx=Math.pow(2,31);function Lp(s,t,r){t=t||[],r=r||0;for(var n=r;s>=dx;)t[r++]=s&255|gf,s/=128;for(;s&px;)t[r++]=s&255|gf,s>>>=7;return t[r]=s|0,Lp.bytes=r-n+1,t}var gx=iu,yx=128,yf=127;function iu(s,n){var r=0,n=n||0,o=0,c=n,h,p=s.length;do{if(c>=p)throw iu.bytes=0,new RangeError("Could not decode varint");h=s[c++],r+=o<28?(h&yf)<<o:(h&yf)*Math.pow(2,o),o+=7}while(h>=yx);return iu.bytes=c-n,r}var vx=Math.pow(2,7),mx=Math.pow(2,14),wx=Math.pow(2,21),bx=Math.pow(2,28),_x=Math.pow(2,35),Ex=Math.pow(2,42),Ix=Math.pow(2,49),Px=Math.pow(2,56),xx=Math.pow(2,63),Sx=function(s){return s<vx?1:s<mx?2:s<wx?3:s<bx?4:s<_x?5:s<Ex?6:s<Ix?7:s<Px?8:s<xx?9:10},Ox={encode:lx,decode:gx,encodingLength:Sx},Up=Ox;const vf=(s,t,r=0)=>(Up.encode(s,t,r),t),mf=s=>Up.encodingLength(s),nu=(s,t)=>{const r=t.byteLength,n=mf(s),o=n+mf(r),c=new Uint8Array(o+r);return vf(s,c,0),vf(r,c,n),c.set(t,o),new $x(s,r,t,c)};class $x{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const Mp=({name:s,code:t,encode:r})=>new Ax(s,t,r);class Ax{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?nu(this.code,r):r.then(n=>nu(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Bp=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),Rx=Mp({name:"sha2-256",code:18,encode:Bp("SHA-256")}),Cx=Mp({name:"sha2-512",code:19,encode:Bp("SHA-512")});var Tx=Object.freeze({__proto__:null,sha256:Rx,sha512:Cx});const Hp=0,Nx="identity",kp=Dp,qx=s=>nu(Hp,kp(s)),Dx={code:Hp,name:Nx,encode:kp,digest:qx};var zx=Object.freeze({__proto__:null,identity:Dx});new TextEncoder,new TextDecoder;const wf={...$P,...RP,...TP,...qP,...jP,...GP,...QP,...XP,...nx,...hx};({...Tx,...zx});function Vp(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function jx(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Vp(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Kp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const bf=Kp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),zc=Kp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=jx(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Lx={utf8:bf,"utf-8":bf,hex:wf.base16,latin1:zc,ascii:zc,binary:zc,...wf};function Ux(s,t="utf8"){const r=Lx[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Vp(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const Fp="wc",Mx=2,Pu="core",ni=`${Fp}@2:${Pu}:`,Bx={name:Pu,logger:"error"},Hx={database:":memory:"},kx="crypto",_f="client_ed25519_seed",Vx=G.ONE_DAY,Kx="keychain",Fx="0.3",Gx="messages",Wx="0.3",Jx=G.SIX_HOURS,Qx="publisher",Gp="irn",Yx="error",Wp="wss://relay.walletconnect.com",Ef="wss://relay.walletconnect.org",Zx="relayer",ct={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Xx="_subscription",zr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},eS=G.ONE_SECOND,tS="2.11.0",rS=1e4,iS="0.3",nS="WALLETCONNECT_CLIENT_ID",nr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},sS="subscription",oS="0.3",aS=G.FIVE_SECONDS*1e3,cS="pairing",uS="0.3",Kn={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},Yn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},hS="history",lS="0.3",fS="expirer",Jt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},pS="0.3",jc="verify-api",ln="https://verify.walletconnect.com",su="https://verify.walletconnect.org",dS=[ln,su],gS="echo",yS="https://echo.walletconnect.com";class vS{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=Kx,this.version=Fx,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:c}=M("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Qf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Yf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}}class mS{constructor(t,r,n){this.core=t,this.logger=r,this.name=kx,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=lf(o);return qp(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=Db();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),h=lf(c),p=Kc();return await iP(p,o,Vx,h)},this.generateSharedKey=(o,c,h)=>{this.isInitialized();const p=this.getPrivateKey(o),f=zb(p,c);return this.setSymKey(f,h)},this.setSymKey=async(o,c)=>{this.isInitialized();const h=c||jb(o);return await this.keychain.set(h,o),h},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,h)=>{this.isInitialized();const p=Lb(h),f=is(c);if($l(p)){const E=p.senderPublicKey,O=p.receiverPublicKey;o=await this.generateSharedKey(E,O)}const g=this.getSymKey(o),{type:v,senderPublicKey:b}=p;return Ub({type:v,symKey:g,message:f,senderPublicKey:b})},this.decode=async(o,c,h)=>{this.isInitialized();const p=Mb(c,h);if($l(p)){const f=p.receiverPublicKey,g=p.senderPublicKey;o=await this.generateSharedKey(f,g)}try{const f=this.getSymKey(o),g=Bb({symKey:f,encoded:c});return zo(g)}catch(f){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(f)}},this.getPayloadType=o=>{const c=Al(o);return Hb(c.type)},this.getPayloadSenderPublicKey=o=>{const c=Al(o);return c.senderPublicKey?kb(c.senderPublicKey,Vb):void 0},this.core=t,this.logger=Pt(r,this.name),this.keychain=n||new vS(this.core,this.logger)}get context(){return It(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(_f)}catch{t=Kc(),await this.keychain.set(_f,t)}return Ux(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}}class wS extends r1{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=Gx,this.version=Wx,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const c=fn(o);let h=this.messages.get(n);return typeof h>"u"&&(h={}),typeof h[c]<"u"||(h[c]=o,this.messages.set(n,h),await this.persist()),c},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const c=this.get(n),h=fn(o);return typeof c[h]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Pt(t,this.name),this.core=r}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Qf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Yf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}}class bS extends i1{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qt.EventEmitter,this.name=Qx,this.queue=new Map,this.publishTimeout=G.toMiliseconds(G.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,c)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}});try{const p=(c==null?void 0:c.ttl)||Jx,f=Fc(c),g=(c==null?void 0:c.prompt)||!1,v=(c==null?void 0:c.tag)||0,b=(c==null?void 0:c.id)||fu().toString(),E={topic:n,message:o,opts:{ttl:p,relay:f,prompt:g,tag:v,id:b}},O=setTimeout(()=>this.queue.set(b,E),this.publishTimeout);try{await await Xn(this.rpcPublish(n,o,p,f,g,v,b),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(b),this.relayer.events.emit(ct.publish,E)}catch(S){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=c==null?void 0:c.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(b),S;return}finally{clearTimeout(O)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=t,this.logger=Pt(r,this.name),this.registerEventListeners()}get context(){return It(this.logger)}rpcPublish(t,r,n,o,c,h,p){var f,g,v,b;const E={method:$o(o.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:c,tag:h},id:p};return ii((f=E.params)==null?void 0:f.prompt)&&((g=E.params)==null||delete g.prompt),ii((v=E.params)==null?void 0:v.tag)&&((b=E.params)==null||delete b.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.request(E)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:o}=t;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ct.connection_stalled);return}this.checkQueue()}),this.relayer.on(ct.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class _S{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const o=n.filter(c=>c!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var ES=Object.defineProperty,IS=Object.defineProperties,PS=Object.getOwnPropertyDescriptors,If=Object.getOwnPropertySymbols,xS=Object.prototype.hasOwnProperty,SS=Object.prototype.propertyIsEnumerable,Pf=(s,t,r)=>t in s?ES(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Fn=(s,t)=>{for(var r in t||(t={}))xS.call(t,r)&&Pf(s,r,t[r]);if(If)for(var r of If(t))SS.call(t,r)&&Pf(s,r,t[r]);return s},Lc=(s,t)=>IS(s,PS(t));class OS extends o1{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new _S,this.events=new Qt.EventEmitter,this.name=sS,this.version=oS,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ni,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const c=Fc(o),h={topic:n,relay:c};this.pending.set(n,h);const p=await this.rpcSubscribe(n,c);return this.onSubscribe(p,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),p}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,c)=>{const h=new G.Watch;h.start(this.pendingSubscriptionWatchLabel);const p=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),o(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=aS&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Pt(r,this.name),this.clientId=""}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const o=Fc(n);await this.rpcUnsubscribe(t,r,o);const c=at("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const n={method:$o(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}return fn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:$o(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}}rpcUnsubscribe(t,r,n){const o={method:$o(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,Lc(Fn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Fn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Fn({},r)),this.topicMap.set(r.topic,t),this.events.emit(nr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=M("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(nr.deleted,Lc(Fn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(nr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(nr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);pn(r)&&this.onBatchSubscribe(r.map((n,o)=>Lc(Fn({},t[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ct.connect,async()=>{await this.onConnect()}),this.relayer.on(ct.disconnect,()=>{this.onDisconnect()}),this.events.on(nr.created,async t=>{const r=nr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(nr.deleted,async t=>{const r=nr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var $S=Object.defineProperty,xf=Object.getOwnPropertySymbols,AS=Object.prototype.hasOwnProperty,RS=Object.prototype.propertyIsEnumerable,Sf=(s,t,r)=>t in s?$S(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,CS=(s,t)=>{for(var r in t||(t={}))AS.call(t,r)&&Sf(s,r,t[r]);if(xf)for(var r of xf(t))RS.call(t,r)&&Sf(s,r,t[r]);return s};class TS extends n1{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qt.EventEmitter,this.name=Zx,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(ct.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(ct.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(zr.payload,this.onPayloadHandler),this.provider.on(zr.connect,this.onConnectHandler),this.provider.on(zr.disconnect,this.onDisconnectHandler),this.provider.on(zr.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Pt(t.logger,this.name):Mo(Bo({level:t.logger||Yx})),this.messages=new wS(this.logger,t.core),this.subscriber=new OS(this,this.logger),this.publisher=new bS(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Wp,this.projectId=t.projectId,this.bundleId=Kb(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ef}...`),await this.restartTransport(Ef)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},rS)}get context(){return It(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(o)return o;let c;const h=p=>{p.topic===t&&(this.subscriber.off(nr.created,h),c())};return await Promise.all([new Promise(p=>{c=p,this.subscriber.on(nr.created,h)}),new Promise(async p=>{o=await this.subscriber.subscribe(t,r),p()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Xn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(nr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await Xn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(zr.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Rl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new nP(new cP(Fb({sdkVersion:tS,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),du(t)){if(!t.method.endsWith(Xx))return;const r=t.params,{topic:n,message:o,publishedAt:c}=r.data,h={topic:n,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(CS({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(t),await this.onMessageEvent(h)}else ns(t)&&this.events.emit(ct.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(ct.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=jo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(zr.payload,this.onPayloadHandler),this.provider.off(zr.connect,this.onConnectHandler),this.provider.off(zr.disconnect,this.onDisconnectHandler),this.provider.off(zr.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(ct.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Rl();Gb(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(ct.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},G.toMiliseconds(eS)))}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var NS=Object.defineProperty,Of=Object.getOwnPropertySymbols,qS=Object.prototype.hasOwnProperty,DS=Object.prototype.propertyIsEnumerable,$f=(s,t,r)=>t in s?NS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Af=(s,t)=>{for(var r in t||(t={}))qS.call(t,r)&&$f(s,r,t[r]);if(Of)for(var r of Of(t))DS.call(t,r)&&$f(s,r,t[r]);return s};class Vo extends s1{constructor(t,r,n,o=ni,c=void 0){super(t,r,n,o),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=iS,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!ii(h)?this.map.set(this.getKey(h),h):Nb(h)?this.map.set(h.id,h):qb(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,p)=>{this.isInitialized(),this.map.has(h)?await this.update(h,p):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:p}),this.map.set(h,p),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(p=>Object.keys(h).every(f=>hP(p[f],h[f]))):this.values),this.update=async(h,p)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:p});const f=Af(Af({},this.getData(h)),p);this.map.set(h,f),await this.persist()},this.delete=async(h,p)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:p}),this.map.delete(h),await this.persist())},this.logger=Pt(r,this.name),this.storagePrefix=o,this.getKey=c}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=M("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}}class zS{constructor(t,r){this.core=t,this.logger=r,this.name=cS,this.version=uS,this.events=new lu,this.initialized=!1,this.storagePrefix=ni,this.ignoredPayloadTypes=[Gf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Kc(),o=await this.core.crypto.setSymKey(n),c=sr(G.FIVE_MINUTES),h={protocol:Gp},p={topic:o,expiry:c,relay:h,active:!1},f=Wb({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:h});return await this.pairings.set(o,p),await this.core.relayer.subscribe(o),this.core.expirer.set(o,c),{topic:o,uri:f}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:c,relay:h}=Cl(n.uri);let p;if(this.pairings.keys.includes(o)&&(p=this.pairings.get(o),p.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const f=sr(G.FIVE_MINUTES),g={topic:o,relay:h,expiry:f,active:!1};return await this.pairings.set(o,g),this.core.expirer.set(o,f),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Yn.create,g),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:h})),g},this.activate=async({topic:n})=>{this.isInitialized();const o=sr(G.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:h,resolve:p,reject:f}=un();this.events.once(Ke("pairing_ping",c),({error:g})=>{g?f(g):p()}),await h()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",at("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,c)=>{const h=xi(o,c),p=await this.core.crypto.encode(n,h),f=Kn[o].req;return this.core.history.set(n,h),this.core.relayer.publish(n,p,f),h.id},this.sendResult=async(n,o,c)=>{const h=jo(n,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,n),g=Kn[f.request.method].res;await this.core.relayer.publish(o,p,g),await this.core.history.resolve(h)},this.sendError=async(n,o,c)=>{const h=pu(n,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,n),g=Kn[f.request.method]?Kn[f.request.method].res:Kn.unregistered_method.res;await this.core.relayer.publish(o,p,g),await this.core.history.resolve(h)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,at("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>ri(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:c}=n,h=(await this.core.history.get(o,c.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(n,o)=>{const{id:c}=o;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Yn.ping,{id:c,topic:n})}catch(h){await this.sendError(c,n,h),this.logger.error(h)}},this.onPairingPingResponse=(n,o)=>{const{id:c}=o;setTimeout(()=>{ti(o)?this.events.emit(Ke("pairing_ping",c),{}):or(o)&&this.events.emit(Ke("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Yn.delete,{id:c,topic:n})}catch(h){await this.sendError(c,n,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:c,method:h}=o;try{if(this.registeredMethods.includes(h))return;const p=at("WC_METHOD_UNSUPPORTED",h);await this.sendError(c,n,p),this.logger.error(p)}catch(p){await this.sendError(c,n,p),this.logger.error(p)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(at("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!Et(n)){const{message:h}=M("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(h)}if(!Jb(n.uri)){const{message:h}=M("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(h)}const c=Cl(n.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:h}=M("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(c!=null&&c.symKey)){const{message:h}=M("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async n=>{if(!Et(n)){const{message:c}=M("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Et(n)){const{message:c}=M("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!hn(n,!1)){const{message:o}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(ri(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=M("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=t,this.logger=Pt(r,this.name),this.pairings=new Vo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return It(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);try{du(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):ns(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Jt.expired,async t=>{const{topic:r}=Wf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Yn.expire,{topic:r}))})}}class jS extends t1{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qt.EventEmitter,this.name=hS,this.version=lS,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:c}),this.records.has(o.id))return;const h={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:c,expiry:sr(G.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(yr.created,h)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=or(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(yr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===n){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(yr.deleted,c)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:xi(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=M("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(yr.created,t=>{const r=yr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.updated,t=>{const r=yr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.deleted,t=>{const r=yr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{G.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}}class LS extends a1{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qt.EventEmitter,this.name=fS,this.version=pS,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const c=this.formatTarget(n),h={target:c,expiry:o};this.expirations.set(c,h),this.checkExpiry(c,h),this.events.emit(Jt.created,{target:c,expiration:h})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Jt.deleted,{target:o,expiration:c})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Qb(t);if(typeof t=="number")return Yb(t);const{message:r}=M("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Jt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=M("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;G.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Jt.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Jt.created,t=>{const r=Jt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.expired,t=>{const r=Jt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.deleted,t=>{const r=Jt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}}}class US extends c1{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=jc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||Zb()||!Jf())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=su;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let c;try{c=await this.fetchAttestation(n.attestationId,o)}catch(h){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(h),c=await this.fetchAttestation(n.attestationId,su)}return c},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const c=this.startAbortTimer(G.ONE_SECOND*2),h=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),h.status===200?await h.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(c=>{if(document.getElementById(jc))return c();window.addEventListener("message",o);const h=document.createElement("iframe");h.id=jc,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,n=c}),new Promise((c,h)=>setTimeout(()=>{window.removeEventListener("message",o),h("verify iframe load timeout")},G.toMiliseconds(G.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||ln;return dS.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${ln}`),o=ln),o},this.logger=Pt(r,this.name),this.verifyUrl=ln,this.abortController=new AbortController,this.isDevEnv=Xb()&&gP.IS_VITEST}get context(){return It(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),G.toMiliseconds(t))}}class MS extends u1{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=gS,this.registerDeviceToken=async n=>{const{clientId:o,token:c,notificationType:h,enableEncrypted:p=!1}=n,f=`${yS}/${this.projectId}/clients`;await dP(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:h,token:c,always_raw:p})})},this.logger=Pt(r,this.context)}}var BS=Object.defineProperty,Rf=Object.getOwnPropertySymbols,HS=Object.prototype.hasOwnProperty,kS=Object.prototype.propertyIsEnumerable,Cf=(s,t,r)=>t in s?BS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Tf=(s,t)=>{for(var r in t||(t={}))HS.call(t,r)&&Cf(s,r,t[r]);if(Rf)for(var r of Rf(t))kS.call(t,r)&&Cf(s,r,t[r]);return s};class xu extends e1{constructor(t){super(t),this.protocol=Fp,this.version=Mx,this.name=Pu,this.events=new Qt.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Wp,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Mo(Bo({level:(t==null?void 0:t.logger)||Bx.logger}));this.logger=Pt(r,this.name),this.heartbeat=new dn.HeartBeat,this.crypto=new mS(this,this.logger,t==null?void 0:t.keychain),this.history=new jS(this,this.logger),this.expirer=new LS(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new i0(Tf(Tf({},Hx),t==null?void 0:t.storageOptions)),this.relayer=new TS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new zS(this,this.logger),this.verify=new US(this.projectId||"",this.logger),this.echoClient=new MS(this.projectId||"",this.logger)}static async init(t){const r=new xu(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(nS,n),r}get context(){return It(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const VS=xu,Jp="wc",Qp=2,Yp="client",Su=`${Jp}@${Qp}:${Yp}:`,Uc={name:Yp,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Nf="WALLETCONNECT_DEEPLINK_CHOICE",KS="proposal",Zp="Proposal expired",FS="session",xo=G.SEVEN_DAYS,GS="engine",Gn={wc_sessionPropose:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1104},res:{ttl:G.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1106},res:{ttl:G.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1112},res:{ttl:G.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1115}}},Mc={min:G.FIVE_MINUTES,max:G.SEVEN_DAYS},jr={idle:"IDLE",active:"ACTIVE"},WS="request",JS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var QS=Object.defineProperty,YS=Object.defineProperties,ZS=Object.getOwnPropertyDescriptors,qf=Object.getOwnPropertySymbols,XS=Object.prototype.hasOwnProperty,e2=Object.prototype.propertyIsEnumerable,Df=(s,t,r)=>t in s?QS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,bt=(s,t)=>{for(var r in t||(t={}))XS.call(t,r)&&Df(s,r,t[r]);if(qf)for(var r of qf(t))e2.call(t,r)&&Df(s,r,t[r]);return s},Wn=(s,t)=>YS(s,ZS(t));class t2 extends l1{constructor(t){super(t),this.name=GS,this.events=new lu,this.initialized=!1,this.ignoredPayloadTypes=[Gf],this.requestQueue={state:jr.idle,queue:[]},this.sessionRequestQueue={state:jr.idle,queue:[]},this.requestQueueDelay=G.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Wn(bt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:h,sessionProperties:p,relays:f}=n;let g=o,v,b=!1;if(g&&(b=this.client.core.pairing.pairings.get(g).active),!g||!b){const{topic:N,uri:L}=await this.client.core.pairing.create();g=N,v=L}const E=await this.client.core.crypto.generateKeyPair(),O=bt({requiredNamespaces:c,optionalNamespaces:h,relays:f??[{protocol:Gp}],proposer:{publicKey:E,metadata:this.client.metadata}},p&&{sessionProperties:p}),{reject:S,resolve:D,done:k}=un(G.FIVE_MINUTES,Zp);if(this.events.once(Ke("session_connect"),async({error:N,session:L})=>{if(N)S(N);else if(L){L.self.publicKey=E;const W=Wn(bt({},L),{requiredNamespaces:L.requiredNamespaces,optionalNamespaces:L.optionalNamespaces});await this.client.session.set(L.topic,W),await this.setExpiry(L.topic,L.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:L.peer.metadata}),D(W)}}),!g){const{message:N}=M("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(N)}const H=await this.sendRequest({topic:g,method:"wc_sessionPropose",params:O}),Q=sr(G.FIVE_MINUTES);return await this.setProposal(H,bt({id:H,expiry:Q},O)),{uri:v,approval:k}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:c,sessionProperties:h}=r,p=this.client.proposal.get(n);let{pairingTopic:f,proposer:g,requiredNamespaces:v,optionalNamespaces:b}=p;f=f||"",Ao(v)||(v=t_(c,"approve()"));const E=await this.client.core.crypto.generateKeyPair(),O=g.publicKey,S=await this.client.core.crypto.generateSharedKey(E,O);f&&n&&(await this.client.core.pairing.updateMetadata({topic:f,metadata:g.metadata}),await this.sendResult({id:n,topic:f,result:{relay:{protocol:o??"irn"},responderPublicKey:E}}),await this.client.proposal.delete(n,at("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:f}));const D=bt({relay:{protocol:o??"irn"},namespaces:c,requiredNamespaces:v,optionalNamespaces:b,pairingTopic:f,controller:{publicKey:E,metadata:this.client.metadata},expiry:sr(xo)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(S),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:D,throwOnFailedPublish:!0});const k=Wn(bt({},D),{topic:S,pairingTopic:f,acknowledged:!1,self:D.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:E});return await this.client.session.set(S,k),await this.setExpiry(S,sr(xo)),{topic:S,acknowledged:()=>new Promise(H=>setTimeout(()=>H(this.client.session.get(S)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,o),await this.client.proposal.delete(n,at("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:h,resolve:p,reject:f}=un();return this.events.once(Ke("session_update",c),({error:g})=>{g?f(g):p()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:h,reject:p}=un();return this.events.once(Ke("session_extend",o),({error:f})=>{f?p(f):h()}),await this.setExpiry(n,sr(xo)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:c,expiry:h}=r,p=I_(),{done:f,resolve:g,reject:v}=un(h,"Request expired. Please try again.");return this.events.once(Ke("session_request",p),({error:b,result:E})=>{b?v(b):g(E)}),await Promise.all([new Promise(async b=>{await this.sendRequest({clientRpcId:p,topic:c,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:h,throwOnFailedPublish:!0}).catch(E=>v(E)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:n,id:p}),b()}),new Promise(async b=>{const E=await r_(this.client.core.storage,Nf);i_({id:p,topic:c,wcDeepLink:E}),b()}),f()]).then(b=>b[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:c}=o;ti(o)?await this.sendResult({id:c,topic:n,result:o.result,throwOnFailedPublish:!0}):or(o)&&await this.sendError(c,n,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:h,reject:p}=un();this.events.once(Ke("session_ping",o),({error:f})=>{f?p(f):h()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:c}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:at("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>n_(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var h,p;return((h=c.peerMetadata)==null?void 0:h.url)&&((p=c.peerMetadata)==null?void 0:p.url)===r.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,at("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Nf).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===r&&this.deletePendingSessionRequest(c.id,at("USER_DISCONNECTED"))})},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,at("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),o&&(this.sessionRequestQueue.state=jr.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Gn.wc_sessionRequest.req.ttl,{id:o,topic:c,params:h,verifyContext:p}=r;await this.client.pendingRequest.set(o,{id:o,topic:c,params:h,verifyContext:p}),n&&this.client.core.expirer.set(o,sr(n))},this.sendRequest=async r=>{const{topic:n,method:o,params:c,expiry:h,relayRpcId:p,clientRpcId:f,throwOnFailedPublish:g}=r,v=xi(o,c,f);if(Jf()&&JS.includes(o)){const O=fn(JSON.stringify(v));this.client.core.verify.register({attestationId:O})}const b=await this.client.core.crypto.encode(n,v),E=Gn[o].req;return h&&(E.ttl=h),p&&(E.id=p),this.client.core.history.set(n,v),g?(E.internal=Wn(bt({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,b,E)):this.client.core.relayer.publish(n,b,E).catch(O=>this.client.logger.error(O)),v.id},this.sendResult=async r=>{const{id:n,topic:o,result:c,throwOnFailedPublish:h}=r,p=jo(n,c),f=await this.client.core.crypto.encode(o,p),g=await this.client.core.history.get(o,n),v=Gn[g.request.method].res;h?(v.internal=Wn(bt({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,f,v)):this.client.core.relayer.publish(o,f,v).catch(b=>this.client.logger.error(b)),await this.client.core.history.resolve(p)},this.sendError=async(r,n,o)=>{const c=pu(r,o),h=await this.client.core.crypto.encode(n,c),p=await this.client.core.history.get(n,r),f=Gn[p.request.method].res;this.client.core.relayer.publish(n,h,f),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{ri(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{ri(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===jr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=jr.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=jr.idle},this.processRequest=r=>{const{topic:n,payload:o}=r,c=o.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,c=(await this.client.core.history.get(n,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=M("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:c}=n;try{this.isValidConnect(bt({},n.params));const h=sr(G.FIVE_MINUTES),p=bt({id:c,pairingTopic:r,expiry:h},o);await this.setProposal(c,p);const f=fn(JSON.stringify(n)),g=await this.getVerifyContext(f,p.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:p,verifyContext:g})}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(ti(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const h=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const p=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:p});const f=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const g=await this.client.core.crypto.generateSharedKey(p,f);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const v=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:v}),await this.client.core.pairing.activate({topic:r})}else or(n)&&(await this.client.proposal.delete(o,at("USER_DISCONNECTED")),this.events.emit(Ke("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:h,controller:p,expiry:f,namespaces:g,requiredNamespaces:v,optionalNamespaces:b,sessionProperties:E,pairingTopic:O}=n.params,S=bt({topic:r,relay:h,expiry:f,namespaces:g,acknowledged:!0,pairingTopic:O,requiredNamespaces:v,optionalNamespaces:b,controller:p.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:p.publicKey,metadata:p.metadata}},E&&{sessionProperties:E});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Ke("session_connect"),{session:S}),this.cleanupDuplicatePairings(S)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;ti(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ke("session_approve",o),{})):or(n)&&(await this.client.session.delete(r,at("USER_DISCONNECTED")),this.events.emit(Ke("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:c}=n;try{const h=`${r}_session_update`,p=mo.get(h);if(p&&this.isRequestOutOfSync(p,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(bt({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:o}),mo.set(h,c)}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ke("session_update",o),{}):or(n)&&this.events.emit(Ke("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,sr(xo)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ke("session_extend",o),{}):or(n)&&this.events.emit(Ke("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{ti(n)?this.events.emit(Ke("session_ping",o),{}):or(n)&&this.events.emit(Ke("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(ct.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidRequest(bt({topic:r},c));const h=fn(JSON.stringify(xi("wc_sessionRequest",c,o))),p=this.client.session.get(r),f=await this.getVerifyContext(h,p.peer.metadata),g={id:o,topic:r,params:c,verifyContext:f};await this.setPendingSessionRequest(g),this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue()}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ke("session_request",o),{result:n.result}):or(n)&&this.events.emit(Ke("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:c}=n;try{const h=`${r}_session_event_${c.event.name}`,p=mo.get(h);if(p&&this.isRequestOutOfSync(p,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(bt({topic:r},c)),this.client.events.emit("session_event",{id:o,topic:r,params:c}),mo.set(h,o)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=jr.idle,this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===jr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=jr.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,xi("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!Et(r)){const{message:f}=M("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(f)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:h,relays:p}=r;if(ii(n)||await this.isValidPairingTopic(n),!s_(p)){const{message:f}=M("MISSING_OR_INVALID",`connect() relays: ${p}`);throw new Error(f)}!ii(o)&&Ao(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!ii(c)&&Ao(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),ii(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=o_(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!Et(r))throw new Error(M("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:c,sessionProperties:h}=r;await this.isValidProposalId(n);const p=this.client.proposal.get(n),f=_c(o,"approve()");if(f)throw new Error(f.message);const g=Tl(p.requiredNamespaces,o,"approve()");if(g)throw new Error(g.message);if(!hn(c,!0)){const{message:v}=M("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(v)}ii(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!Et(r)){const{message:c}=M("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!a_(o)){const{message:c}=M("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!Et(r)){const{message:g}=M("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:n,controller:o,namespaces:c,expiry:h}=r;if(!c_(n)){const{message:g}=M("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const p=u_(o,"onSessionSettleRequest()");if(p)throw new Error(p.message);const f=_c(c,"onSessionSettleRequest()");if(f)throw new Error(f.message);if(ri(h)){const{message:g}=M("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!Et(r)){const{message:f}=M("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(f)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const c=this.client.session.get(n),h=_c(o,"update()");if(h)throw new Error(h.message);const p=Tl(c.requiredNamespaces,o,"update()");if(p)throw new Error(p.message)},this.isValidExtend=async r=>{if(!Et(r)){const{message:o}=M("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!Et(r)){const{message:f}=M("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(f)}const{topic:n,request:o,chainId:c,expiry:h}=r;await this.isValidSessionTopic(n);const{namespaces:p}=this.client.session.get(n);if(!Nl(p,c)){const{message:f}=M("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(f)}if(!h_(o)){const{message:f}=M("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(f)}if(!l_(p,c,o.method)){const{message:f}=M("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(f)}if(h&&!f_(h,Mc)){const{message:f}=M("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${Mc.min} and ${Mc.max}`);throw new Error(f)}},this.isValidRespond=async r=>{var n;if(!Et(r)){const{message:h}=M("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:o,response:c}=r;try{await this.isValidSessionTopic(o)}catch(h){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),h}if(!p_(c)){const{message:h}=M("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!Et(r)){const{message:o}=M("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!Et(r)){const{message:p}=M("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(p)}const{topic:n,event:o,chainId:c}=r;await this.isValidSessionTopic(n);const{namespaces:h}=this.client.session.get(n);if(!Nl(h,c)){const{message:p}=M("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(p)}if(!d_(o)){const{message:p}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}if(!g_(h,c,o.name)){const{message:p}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}},this.isValidDisconnect=async r=>{if(!Et(r)){const{message:o}=M("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||ln,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!hn(o,!1)){const{message:c}=M("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=M("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);try{du(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):ns(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Jt.expired,async t=>{const{topic:r,id:n}=Wf(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,M("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Yn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!hn(t,!1)){const{message:r}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=M("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!hn(t,!1)){const{message:r}=M("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=M("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=M("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(hn(t,!1)){const{message:r}=M("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=M("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!y_(t)){const{message:r}=M("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=M("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=M("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class r2 extends Vo{constructor(t,r){super(t,r,KS,Su),this.core=t,this.logger=r}}class i2 extends Vo{constructor(t,r){super(t,r,FS,Su),this.core=t,this.logger=r}}class n2 extends Vo{constructor(t,r){super(t,r,WS,Su,n=>n.id),this.core=t,this.logger=r}}let s2=class Xp extends h1{constructor(t){super(t),this.protocol=Jp,this.version=Qp,this.name=Uc.name,this.events=new Qt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||Uc.name,this.metadata=(t==null?void 0:t.metadata)||e_();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Mo(Bo({level:(t==null?void 0:t.logger)||Uc.logger}));this.core=(t==null?void 0:t.core)||new VS(t),this.logger=Pt(r,this.name),this.session=new i2(this.core,this.logger),this.proposal=new r2(this.core,this.logger),this.pendingRequest=new n2(this.core,this.logger),this.engine=new t2(this)}static async init(t){const r=new Xp(t);return await r.initialize(),r}get context(){return It(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};class ai extends Xf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||fu().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{or(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ns(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const zf="error",o2="wss://relay.walletconnect.com",a2="wc",c2="universal_provider",jf=`${a2}@2:${c2}:`,u2="https://rpc.walletconnect.com/v1/",Lr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Jn=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{},ou={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",p="Invalid `variable` option passed into `_.template`",f="__lodash_hash_undefined__",g=500,v="__lodash_placeholder__",b=1,E=2,O=4,S=1,D=2,k=1,H=2,Q=4,N=8,L=16,W=32,le=64,re=128,oe=256,we=512,zt=30,jt="...",xt=800,mr=16,Ur=1,ee=2,z=3,K=1/0,F=9007199254740991,de=17976931348623157e292,fe=NaN,ae=4294967295,$e=ae-1,be=ae>>>1,Ae=[["ary",re],["bind",k],["bindKey",H],["curry",N],["curryRight",L],["flip",we],["partial",W],["partialRight",le],["rearg",oe]],Y="[object Arguments]",ze="[object Array]",St="[object AsyncFunction]",Re="[object Boolean]",Le="[object Date]",Ot="[object DOMException]",ut="[object Error]",$t="[object Function]",Mr="[object GeneratorFunction]",Xe="[object Map]",wr="[object Number]",gn="[object Null]",At="[object Object]",Ai="[object Promise]",Ri="[object Proxy]",ar="[object RegExp]",et="[object Set]",cr="[object String]",br="[object Symbol]",Ci="[object Undefined]",ur="[object WeakMap]",Ti="[object WeakSet]",Lt="[object ArrayBuffer]",Ut="[object DataView]",Br="[object Float32Array]",nt="[object Float64Array]",Ni="[object Int8Array]",qi="[object Int16Array]",yn="[object Int32Array]",Di="[object Uint8Array]",Hr="[object Uint8ClampedArray]",zi="[object Uint16Array]",ji="[object Uint32Array]",Ko=/\b__p \+= '';/g,_r=/\b(__p \+=) '' \+/g,us=/(__e\(.*?\)|\b__t\)) \+\n'';/g,hs=/&(?:amp|lt|gt|quot|#39);/g,ls=/[&<>"']/g,vn=RegExp(hs.source),ci=RegExp(ls.source),mn=/<%-([\s\S]+?)%>/g,wn=/<%([\s\S]+?)%>/g,Li=/<%=([\s\S]+?)%>/g,ui=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Fo=/^\w*$/,Go=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bn=/[\\^$.*+?()[\]{}|]/g,Wo=RegExp(bn.source),_n=/^\s+/,fs=/\s/,En=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Er=/\{\n\/\* \[wrapped with (.+)\] \*/,Jo=/,? & /,Qo=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Yo=/[()=,{}\[\]\/\s]/,Zo=/\\(\\)?/g,Xo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Mt=/\w*$/,ea=/^[-+]0x[0-9a-f]+$/i,ta=/^0b[01]+$/i,ra=/^\[object .+?Constructor\]$/,ia=/^0o[0-7]+$/i,na=/^(?:0|[1-9]\d*)$/,Ir=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ui=/($^)/,sa=/['\n\r\u2028\u2029\\]/g,Mi="\\ud800-\\udfff",oa="\\u0300-\\u036f",aa="\\ufe20-\\ufe2f",Bi="\\u20d0-\\u20ff",ps=oa+aa+Bi,ds="\\u2700-\\u27bf",Yt="a-z\\xdf-\\xf6\\xf8-\\xff",ca="\\xac\\xb1\\xd7\\xf7",ua="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ha="\\u2000-\\u206f",la=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",gs="A-Z\\xc0-\\xd6\\xd8-\\xde",ys="\\ufe0e\\ufe0f",hi=ca+ua+ha+la,In="['’]",li="["+Mi+"]",Pn="["+hi+"]",fi="["+ps+"]",vs="\\d+",fa="["+ds+"]",ms="["+Yt+"]",ws="[^"+Mi+hi+vs+ds+Yt+gs+"]",Hi="\\ud83c[\\udffb-\\udfff]",pa="(?:"+fi+"|"+Hi+")",bs="[^"+Mi+"]",ki="(?:\\ud83c[\\udde6-\\uddff]){2}",kr="[\\ud800-\\udbff][\\udc00-\\udfff]",Rt="["+gs+"]",_s="\\u200d",Es="(?:"+ms+"|"+ws+")",hr="(?:"+Rt+"|"+ws+")",Is="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",Ps="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",xs=pa+"?",Ss="["+ys+"]?",da="(?:"+_s+"(?:"+[bs,ki,kr].join("|")+")"+Ss+xs+")*",Pr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Os="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",$s=Ss+xs+da,Vi="(?:"+[fa,ki,kr].join("|")+")"+$s,ga="(?:"+[bs+fi+"?",fi,ki,kr,li].join("|")+")",xn=RegExp(In,"g"),ya=RegExp(fi,"g"),Ki=RegExp(Hi+"(?="+Hi+")|"+ga+$s,"g"),As=RegExp([Rt+"?"+ms+"+"+Is+"(?="+[Pn,Rt,"$"].join("|")+")",hr+"+"+Ps+"(?="+[Pn,Rt+Es,"$"].join("|")+")",Rt+"?"+Es+"+"+Is,Rt+"+"+Ps,Os,Pr,vs,Vi].join("|"),"g"),Rs=RegExp("["+_s+Mi+ps+ys+"]"),pi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],va=-1,Pe={};Pe[Br]=Pe[nt]=Pe[Ni]=Pe[qi]=Pe[yn]=Pe[Di]=Pe[Hr]=Pe[zi]=Pe[ji]=!0,Pe[Y]=Pe[ze]=Pe[Lt]=Pe[Re]=Pe[Ut]=Pe[Le]=Pe[ut]=Pe[$t]=Pe[Xe]=Pe[wr]=Pe[At]=Pe[ar]=Pe[et]=Pe[cr]=Pe[ur]=!1;var Ie={};Ie[Y]=Ie[ze]=Ie[Lt]=Ie[Ut]=Ie[Re]=Ie[Le]=Ie[Br]=Ie[nt]=Ie[Ni]=Ie[qi]=Ie[yn]=Ie[Xe]=Ie[wr]=Ie[At]=Ie[ar]=Ie[et]=Ie[cr]=Ie[br]=Ie[Di]=Ie[Hr]=Ie[zi]=Ie[ji]=!0,Ie[ut]=Ie[$t]=Ie[ur]=!1;var m={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},T={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},U={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xe=parseFloat,ie=parseInt,Ce=typeof Jn=="object"&&Jn&&Jn.Object===Object&&Jn,ke=typeof self=="object"&&self&&self.Object===Object&&self,ye=Ce||ke||Function("return this")(),Se=t&&!t.nodeType&&t,Ue=Se&&!0&&s&&!s.nodeType&&s,dt=Ue&&Ue.exports===Se,Ve=dt&&Ce.process,Te=function(){try{var P=Ue&&Ue.require&&Ue.require("util").types;return P||Ve&&Ve.binding&&Ve.binding("util")}catch{}}(),ht=Te&&Te.isArrayBuffer,Zt=Te&&Te.isDate,Bt=Te&&Te.isMap,lr=Te&&Te.isRegExp,Sn=Te&&Te.isSet,di=Te&&Te.isTypedArray;function Je(P,A,$){switch($.length){case 0:return P.call(A);case 1:return P.call(A,$[0]);case 2:return P.call(A,$[0],$[1]);case 3:return P.call(A,$[0],$[1],$[2])}return P.apply(A,$)}function rd(P,A,$,B){for(var te=-1,me=P==null?0:P.length;++te<me;){var Fe=P[te];A(B,Fe,$(Fe),P)}return B}function Ht(P,A){for(var $=-1,B=P==null?0:P.length;++$<B&&A(P[$],$,P)!==!1;);return P}function id(P,A){for(var $=P==null?0:P.length;$--&&A(P[$],$,P)!==!1;);return P}function Au(P,A){for(var $=-1,B=P==null?0:P.length;++$<B;)if(!A(P[$],$,P))return!1;return!0}function Vr(P,A){for(var $=-1,B=P==null?0:P.length,te=0,me=[];++$<B;){var Fe=P[$];A(Fe,$,P)&&(me[te++]=Fe)}return me}function Ts(P,A){var $=P==null?0:P.length;return!!$&&Fi(P,A,0)>-1}function ma(P,A,$){for(var B=-1,te=P==null?0:P.length;++B<te;)if($(A,P[B]))return!0;return!1}function Ne(P,A){for(var $=-1,B=P==null?0:P.length,te=Array(B);++$<B;)te[$]=A(P[$],$,P);return te}function Kr(P,A){for(var $=-1,B=A.length,te=P.length;++$<B;)P[te+$]=A[$];return P}function wa(P,A,$,B){var te=-1,me=P==null?0:P.length;for(B&&me&&($=P[++te]);++te<me;)$=A($,P[te],te,P);return $}function nd(P,A,$,B){var te=P==null?0:P.length;for(B&&te&&($=P[--te]);te--;)$=A($,P[te],te,P);return $}function ba(P,A){for(var $=-1,B=P==null?0:P.length;++$<B;)if(A(P[$],$,P))return!0;return!1}var sd=_a("length");function od(P){return P.split("")}function ad(P){return P.match(Qo)||[]}function Ru(P,A,$){var B;return $(P,function(te,me,Fe){if(A(te,me,Fe))return B=me,!1}),B}function Ns(P,A,$,B){for(var te=P.length,me=$+(B?1:-1);B?me--:++me<te;)if(A(P[me],me,P))return me;return-1}function Fi(P,A,$){return A===A?wd(P,A,$):Ns(P,Cu,$)}function cd(P,A,$,B){for(var te=$-1,me=P.length;++te<me;)if(B(P[te],A))return te;return-1}function Cu(P){return P!==P}function Tu(P,A){var $=P==null?0:P.length;return $?Ia(P,A)/$:fe}function _a(P){return function(A){return A==null?r:A[P]}}function Ea(P){return function(A){return P==null?r:P[A]}}function Nu(P,A,$,B,te){return te(P,function(me,Fe,Oe){$=B?(B=!1,me):A($,me,Fe,Oe)}),$}function ud(P,A){var $=P.length;for(P.sort(A);$--;)P[$]=P[$].value;return P}function Ia(P,A){for(var $,B=-1,te=P.length;++B<te;){var me=A(P[B]);me!==r&&($=$===r?me:$+me)}return $}function Pa(P,A){for(var $=-1,B=Array(P);++$<P;)B[$]=A($);return B}function hd(P,A){return Ne(A,function($){return[$,P[$]]})}function qu(P){return P&&P.slice(0,Lu(P)+1).replace(_n,"")}function Ct(P){return function(A){return P(A)}}function xa(P,A){return Ne(A,function($){return P[$]})}function On(P,A){return P.has(A)}function Du(P,A){for(var $=-1,B=P.length;++$<B&&Fi(A,P[$],0)>-1;);return $}function zu(P,A){for(var $=P.length;$--&&Fi(A,P[$],0)>-1;);return $}function ld(P,A){for(var $=P.length,B=0;$--;)P[$]===A&&++B;return B}var fd=Ea(m),pd=Ea(I);function dd(P){return"\\"+U[P]}function gd(P,A){return P==null?r:P[A]}function Gi(P){return Rs.test(P)}function yd(P){return pi.test(P)}function vd(P){for(var A,$=[];!(A=P.next()).done;)$.push(A.value);return $}function Sa(P){var A=-1,$=Array(P.size);return P.forEach(function(B,te){$[++A]=[te,B]}),$}function ju(P,A){return function($){return P(A($))}}function Fr(P,A){for(var $=-1,B=P.length,te=0,me=[];++$<B;){var Fe=P[$];(Fe===A||Fe===v)&&(P[$]=v,me[te++]=$)}return me}function qs(P){var A=-1,$=Array(P.size);return P.forEach(function(B){$[++A]=B}),$}function md(P){var A=-1,$=Array(P.size);return P.forEach(function(B){$[++A]=[B,B]}),$}function wd(P,A,$){for(var B=$-1,te=P.length;++B<te;)if(P[B]===A)return B;return-1}function bd(P,A,$){for(var B=$+1;B--;)if(P[B]===A)return B;return B}function Wi(P){return Gi(P)?Ed(P):sd(P)}function Xt(P){return Gi(P)?Id(P):od(P)}function Lu(P){for(var A=P.length;A--&&fs.test(P.charAt(A)););return A}var _d=Ea(T);function Ed(P){for(var A=Ki.lastIndex=0;Ki.test(P);)++A;return A}function Id(P){return P.match(Ki)||[]}function Pd(P){return P.match(As)||[]}var xd=function P(A){A=A==null?ye:Ji.defaults(ye.Object(),A,Ji.pick(ye,Cs));var $=A.Array,B=A.Date,te=A.Error,me=A.Function,Fe=A.Math,Oe=A.Object,Oa=A.RegExp,Sd=A.String,kt=A.TypeError,Ds=$.prototype,Od=me.prototype,Qi=Oe.prototype,zs=A["__core-js_shared__"],js=Od.toString,Ee=Qi.hasOwnProperty,$d=0,Uu=function(){var e=/[^.]+$/.exec(zs&&zs.keys&&zs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ls=Qi.toString,Ad=js.call(Oe),Rd=ye._,Cd=Oa("^"+js.call(Ee).replace(bn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Us=dt?A.Buffer:r,Gr=A.Symbol,Ms=A.Uint8Array,Mu=Us?Us.allocUnsafe:r,Bs=ju(Oe.getPrototypeOf,Oe),Bu=Oe.create,Hu=Qi.propertyIsEnumerable,Hs=Ds.splice,ku=Gr?Gr.isConcatSpreadable:r,$n=Gr?Gr.iterator:r,gi=Gr?Gr.toStringTag:r,ks=function(){try{var e=bi(Oe,"defineProperty");return e({},"",{}),e}catch{}}(),Td=A.clearTimeout!==ye.clearTimeout&&A.clearTimeout,Nd=B&&B.now!==ye.Date.now&&B.now,qd=A.setTimeout!==ye.setTimeout&&A.setTimeout,Vs=Fe.ceil,Ks=Fe.floor,$a=Oe.getOwnPropertySymbols,Dd=Us?Us.isBuffer:r,Vu=A.isFinite,zd=Ds.join,jd=ju(Oe.keys,Oe),Ge=Fe.max,st=Fe.min,Ld=B.now,Ud=A.parseInt,Ku=Fe.random,Md=Ds.reverse,Aa=bi(A,"DataView"),An=bi(A,"Map"),Ra=bi(A,"Promise"),Yi=bi(A,"Set"),Rn=bi(A,"WeakMap"),Cn=bi(Oe,"create"),Fs=Rn&&new Rn,Zi={},Bd=_i(Aa),Hd=_i(An),kd=_i(Ra),Vd=_i(Yi),Kd=_i(Rn),Gs=Gr?Gr.prototype:r,Tn=Gs?Gs.valueOf:r,Fu=Gs?Gs.toString:r;function d(e){if(je(e)&&!ne(e)&&!(e instanceof ge)){if(e instanceof Vt)return e;if(Ee.call(e,"__wrapped__"))return Gh(e)}return new Vt(e)}var Xi=function(){function e(){}return function(i){if(!De(i))return{};if(Bu)return Bu(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Ws(){}function Vt(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:mn,evaluate:wn,interpolate:Li,variable:"",imports:{_:d}},d.prototype=Ws.prototype,d.prototype.constructor=d,Vt.prototype=Xi(Ws.prototype),Vt.prototype.constructor=Vt;function ge(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ae,this.__views__=[]}function Fd(){var e=new ge(this.__wrapped__);return e.__actions__=gt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=gt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=gt(this.__views__),e}function Gd(){if(this.__filtered__){var e=new ge(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wd(){var e=this.__wrapped__.value(),i=this.__dir__,a=ne(e),u=i<0,l=a?e.length:0,y=oy(0,l,this.__views__),w=y.start,_=y.end,x=_-w,R=u?_:w-1,C=this.__iteratees__,q=C.length,j=0,V=st(x,this.__takeCount__);if(!a||!u&&l==x&&V==x)return yh(e,this.__actions__);var Z=[];e:for(;x--&&j<V;){R+=i;for(var ce=-1,X=e[R];++ce<q;){var pe=C[ce],ve=pe.iteratee,qt=pe.type,pt=ve(X);if(qt==ee)X=pt;else if(!pt){if(qt==Ur)continue e;break e}}Z[j++]=X}return Z}ge.prototype=Xi(Ws.prototype),ge.prototype.constructor=ge;function yi(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function Jd(){this.__data__=Cn?Cn(null):{},this.size=0}function Qd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Yd(e){var i=this.__data__;if(Cn){var a=i[e];return a===f?r:a}return Ee.call(i,e)?i[e]:r}function Zd(e){var i=this.__data__;return Cn?i[e]!==r:Ee.call(i,e)}function Xd(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=Cn&&i===r?f:i,this}yi.prototype.clear=Jd,yi.prototype.delete=Qd,yi.prototype.get=Yd,yi.prototype.has=Zd,yi.prototype.set=Xd;function xr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function eg(){this.__data__=[],this.size=0}function tg(e){var i=this.__data__,a=Js(i,e);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Hs.call(i,a,1),--this.size,!0}function rg(e){var i=this.__data__,a=Js(i,e);return a<0?r:i[a][1]}function ig(e){return Js(this.__data__,e)>-1}function ng(e,i){var a=this.__data__,u=Js(a,e);return u<0?(++this.size,a.push([e,i])):a[u][1]=i,this}xr.prototype.clear=eg,xr.prototype.delete=tg,xr.prototype.get=rg,xr.prototype.has=ig,xr.prototype.set=ng;function Sr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function sg(){this.size=0,this.__data__={hash:new yi,map:new(An||xr),string:new yi}}function og(e){var i=ao(this,e).delete(e);return this.size-=i?1:0,i}function ag(e){return ao(this,e).get(e)}function cg(e){return ao(this,e).has(e)}function ug(e,i){var a=ao(this,e),u=a.size;return a.set(e,i),this.size+=a.size==u?0:1,this}Sr.prototype.clear=sg,Sr.prototype.delete=og,Sr.prototype.get=ag,Sr.prototype.has=cg,Sr.prototype.set=ug;function vi(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new Sr;++i<a;)this.add(e[i])}function hg(e){return this.__data__.set(e,f),this}function lg(e){return this.__data__.has(e)}vi.prototype.add=vi.prototype.push=hg,vi.prototype.has=lg;function er(e){var i=this.__data__=new xr(e);this.size=i.size}function fg(){this.__data__=new xr,this.size=0}function pg(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function dg(e){return this.__data__.get(e)}function gg(e){return this.__data__.has(e)}function yg(e,i){var a=this.__data__;if(a instanceof xr){var u=a.__data__;if(!An||u.length<o-1)return u.push([e,i]),this.size=++a.size,this;a=this.__data__=new Sr(u)}return a.set(e,i),this.size=a.size,this}er.prototype.clear=fg,er.prototype.delete=pg,er.prototype.get=dg,er.prototype.has=gg,er.prototype.set=yg;function Gu(e,i){var a=ne(e),u=!a&&Ei(e),l=!a&&!u&&Zr(e),y=!a&&!u&&!l&&nn(e),w=a||u||l||y,_=w?Pa(e.length,Sd):[],x=_.length;for(var R in e)(i||Ee.call(e,R))&&!(w&&(R=="length"||l&&(R=="offset"||R=="parent")||y&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||Rr(R,x)))&&_.push(R);return _}function Wu(e){var i=e.length;return i?e[Ba(0,i-1)]:r}function vg(e,i){return co(gt(e),mi(i,0,e.length))}function mg(e){return co(gt(e))}function Ca(e,i,a){(a!==r&&!tr(e[i],a)||a===r&&!(i in e))&&Or(e,i,a)}function Nn(e,i,a){var u=e[i];(!(Ee.call(e,i)&&tr(u,a))||a===r&&!(i in e))&&Or(e,i,a)}function Js(e,i){for(var a=e.length;a--;)if(tr(e[a][0],i))return a;return-1}function wg(e,i,a,u){return Wr(e,function(l,y,w){i(u,l,a(l),w)}),u}function Ju(e,i){return e&&pr(i,Qe(i),e)}function bg(e,i){return e&&pr(i,vt(i),e)}function Or(e,i,a){i=="__proto__"&&ks?ks(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function Ta(e,i){for(var a=-1,u=i.length,l=$(u),y=e==null;++a<u;)l[a]=y?r:fc(e,i[a]);return l}function mi(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function Kt(e,i,a,u,l,y){var w,_=i&b,x=i&E,R=i&O;if(a&&(w=l?a(e,u,l,y):a(e)),w!==r)return w;if(!De(e))return e;var C=ne(e);if(C){if(w=cy(e),!_)return gt(e,w)}else{var q=ot(e),j=q==$t||q==Mr;if(Zr(e))return wh(e,_);if(q==At||q==Y||j&&!l){if(w=x||j?{}:Lh(e),!_)return x?Yg(e,bg(w,e)):Qg(e,Ju(w,e))}else{if(!Ie[q])return l?e:{};w=uy(e,q,_)}}y||(y=new er);var V=y.get(e);if(V)return V;y.set(e,w),pl(e)?e.forEach(function(X){w.add(Kt(X,i,a,X,e,y))}):ll(e)&&e.forEach(function(X,pe){w.set(pe,Kt(X,i,a,pe,e,y))});var Z=R?x?Za:Ya:x?vt:Qe,ce=C?r:Z(e);return Ht(ce||e,function(X,pe){ce&&(pe=X,X=e[pe]),Nn(w,pe,Kt(X,i,a,pe,e,y))}),w}function _g(e){var i=Qe(e);return function(a){return Qu(a,e,i)}}function Qu(e,i,a){var u=a.length;if(e==null)return!u;for(e=Oe(e);u--;){var l=a[u],y=i[l],w=e[l];if(w===r&&!(l in e)||!y(w))return!1}return!0}function Yu(e,i,a){if(typeof e!="function")throw new kt(h);return Mn(function(){e.apply(r,a)},i)}function qn(e,i,a,u){var l=-1,y=Ts,w=!0,_=e.length,x=[],R=i.length;if(!_)return x;a&&(i=Ne(i,Ct(a))),u?(y=ma,w=!1):i.length>=o&&(y=On,w=!1,i=new vi(i));e:for(;++l<_;){var C=e[l],q=a==null?C:a(C);if(C=u||C!==0?C:0,w&&q===q){for(var j=R;j--;)if(i[j]===q)continue e;x.push(C)}else y(i,q,u)||x.push(C)}return x}var Wr=Ph(fr),Zu=Ph(qa,!0);function Eg(e,i){var a=!0;return Wr(e,function(u,l,y){return a=!!i(u,l,y),a}),a}function Qs(e,i,a){for(var u=-1,l=e.length;++u<l;){var y=e[u],w=i(y);if(w!=null&&(_===r?w===w&&!Nt(w):a(w,_)))var _=w,x=y}return x}function Ig(e,i,a,u){var l=e.length;for(a=se(a),a<0&&(a=-a>l?0:l+a),u=u===r||u>l?l:se(u),u<0&&(u+=l),u=a>u?0:gl(u);a<u;)e[a++]=i;return e}function Xu(e,i){var a=[];return Wr(e,function(u,l,y){i(u,l,y)&&a.push(u)}),a}function tt(e,i,a,u,l){var y=-1,w=e.length;for(a||(a=ly),l||(l=[]);++y<w;){var _=e[y];i>0&&a(_)?i>1?tt(_,i-1,a,u,l):Kr(l,_):u||(l[l.length]=_)}return l}var Na=xh(),eh=xh(!0);function fr(e,i){return e&&Na(e,i,Qe)}function qa(e,i){return e&&eh(e,i,Qe)}function Ys(e,i){return Vr(i,function(a){return Cr(e[a])})}function wi(e,i){i=Qr(i,e);for(var a=0,u=i.length;e!=null&&a<u;)e=e[dr(i[a++])];return a&&a==u?e:r}function th(e,i,a){var u=i(e);return ne(e)?u:Kr(u,a(e))}function lt(e){return e==null?e===r?Ci:gn:gi&&gi in Oe(e)?sy(e):my(e)}function Da(e,i){return e>i}function Pg(e,i){return e!=null&&Ee.call(e,i)}function xg(e,i){return e!=null&&i in Oe(e)}function Sg(e,i,a){return e>=st(i,a)&&e<Ge(i,a)}function za(e,i,a){for(var u=a?ma:Ts,l=e[0].length,y=e.length,w=y,_=$(y),x=1/0,R=[];w--;){var C=e[w];w&&i&&(C=Ne(C,Ct(i))),x=st(C.length,x),_[w]=!a&&(i||l>=120&&C.length>=120)?new vi(w&&C):r}C=e[0];var q=-1,j=_[0];e:for(;++q<l&&R.length<x;){var V=C[q],Z=i?i(V):V;if(V=a||V!==0?V:0,!(j?On(j,Z):u(R,Z,a))){for(w=y;--w;){var ce=_[w];if(!(ce?On(ce,Z):u(e[w],Z,a)))continue e}j&&j.push(Z),R.push(V)}}return R}function Og(e,i,a,u){return fr(e,function(l,y,w){i(u,a(l),y,w)}),u}function Dn(e,i,a){i=Qr(i,e),e=Hh(e,i);var u=e==null?e:e[dr(Gt(i))];return u==null?r:Je(u,e,a)}function rh(e){return je(e)&&lt(e)==Y}function $g(e){return je(e)&&lt(e)==Lt}function Ag(e){return je(e)&&lt(e)==Le}function zn(e,i,a,u,l){return e===i?!0:e==null||i==null||!je(e)&&!je(i)?e!==e&&i!==i:Rg(e,i,a,u,zn,l)}function Rg(e,i,a,u,l,y){var w=ne(e),_=ne(i),x=w?ze:ot(e),R=_?ze:ot(i);x=x==Y?At:x,R=R==Y?At:R;var C=x==At,q=R==At,j=x==R;if(j&&Zr(e)){if(!Zr(i))return!1;w=!0,C=!1}if(j&&!C)return y||(y=new er),w||nn(e)?Dh(e,i,a,u,l,y):iy(e,i,x,a,u,l,y);if(!(a&S)){var V=C&&Ee.call(e,"__wrapped__"),Z=q&&Ee.call(i,"__wrapped__");if(V||Z){var ce=V?e.value():e,X=Z?i.value():i;return y||(y=new er),l(ce,X,a,u,y)}}return j?(y||(y=new er),ny(e,i,a,u,l,y)):!1}function Cg(e){return je(e)&&ot(e)==Xe}function ja(e,i,a,u){var l=a.length,y=l,w=!u;if(e==null)return!y;for(e=Oe(e);l--;){var _=a[l];if(w&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<y;){_=a[l];var x=_[0],R=e[x],C=_[1];if(w&&_[2]){if(R===r&&!(x in e))return!1}else{var q=new er;if(u)var j=u(R,C,x,e,i,q);if(!(j===r?zn(C,R,S|D,u,q):j))return!1}}return!0}function ih(e){if(!De(e)||py(e))return!1;var i=Cr(e)?Cd:ra;return i.test(_i(e))}function Tg(e){return je(e)&&lt(e)==ar}function Ng(e){return je(e)&&ot(e)==et}function qg(e){return je(e)&&go(e.length)&&!!Pe[lt(e)]}function nh(e){return typeof e=="function"?e:e==null?mt:typeof e=="object"?ne(e)?ah(e[0],e[1]):oh(e):Sl(e)}function La(e){if(!Un(e))return jd(e);var i=[];for(var a in Oe(e))Ee.call(e,a)&&a!="constructor"&&i.push(a);return i}function Dg(e){if(!De(e))return vy(e);var i=Un(e),a=[];for(var u in e)u=="constructor"&&(i||!Ee.call(e,u))||a.push(u);return a}function Ua(e,i){return e<i}function sh(e,i){var a=-1,u=yt(e)?$(e.length):[];return Wr(e,function(l,y,w){u[++a]=i(l,y,w)}),u}function oh(e){var i=ec(e);return i.length==1&&i[0][2]?Mh(i[0][0],i[0][1]):function(a){return a===e||ja(a,e,i)}}function ah(e,i){return rc(e)&&Uh(i)?Mh(dr(e),i):function(a){var u=fc(a,e);return u===r&&u===i?pc(a,e):zn(i,u,S|D)}}function Zs(e,i,a,u,l){e!==i&&Na(i,function(y,w){if(l||(l=new er),De(y))zg(e,i,w,a,Zs,u,l);else{var _=u?u(nc(e,w),y,w+"",e,i,l):r;_===r&&(_=y),Ca(e,w,_)}},vt)}function zg(e,i,a,u,l,y,w){var _=nc(e,a),x=nc(i,a),R=w.get(x);if(R){Ca(e,a,R);return}var C=y?y(_,x,a+"",e,i,w):r,q=C===r;if(q){var j=ne(x),V=!j&&Zr(x),Z=!j&&!V&&nn(x);C=x,j||V||Z?ne(_)?C=_:Me(_)?C=gt(_):V?(q=!1,C=wh(x,!0)):Z?(q=!1,C=bh(x,!0)):C=[]:Bn(x)||Ei(x)?(C=_,Ei(_)?C=yl(_):(!De(_)||Cr(_))&&(C=Lh(x))):q=!1}q&&(w.set(x,C),l(C,x,u,y,w),w.delete(x)),Ca(e,a,C)}function ch(e,i){var a=e.length;if(a)return i+=i<0?a:0,Rr(i,a)?e[i]:r}function uh(e,i,a){i.length?i=Ne(i,function(y){return ne(y)?function(w){return wi(w,y.length===1?y[0]:y)}:y}):i=[mt];var u=-1;i=Ne(i,Ct(J()));var l=sh(e,function(y,w,_){var x=Ne(i,function(R){return R(y)});return{criteria:x,index:++u,value:y}});return ud(l,function(y,w){return Jg(y,w,a)})}function jg(e,i){return hh(e,i,function(a,u){return pc(e,u)})}function hh(e,i,a){for(var u=-1,l=i.length,y={};++u<l;){var w=i[u],_=wi(e,w);a(_,w)&&jn(y,Qr(w,e),_)}return y}function Lg(e){return function(i){return wi(i,e)}}function Ma(e,i,a,u){var l=u?cd:Fi,y=-1,w=i.length,_=e;for(e===i&&(i=gt(i)),a&&(_=Ne(e,Ct(a)));++y<w;)for(var x=0,R=i[y],C=a?a(R):R;(x=l(_,C,x,u))>-1;)_!==e&&Hs.call(_,x,1),Hs.call(e,x,1);return e}function lh(e,i){for(var a=e?i.length:0,u=a-1;a--;){var l=i[a];if(a==u||l!==y){var y=l;Rr(l)?Hs.call(e,l,1):Va(e,l)}}return e}function Ba(e,i){return e+Ks(Ku()*(i-e+1))}function Ug(e,i,a,u){for(var l=-1,y=Ge(Vs((i-e)/(a||1)),0),w=$(y);y--;)w[u?y:++l]=e,e+=a;return w}function Ha(e,i){var a="";if(!e||i<1||i>F)return a;do i%2&&(a+=e),i=Ks(i/2),i&&(e+=e);while(i);return a}function he(e,i){return sc(Bh(e,i,mt),e+"")}function Mg(e){return Wu(sn(e))}function Bg(e,i){var a=sn(e);return co(a,mi(i,0,a.length))}function jn(e,i,a,u){if(!De(e))return e;i=Qr(i,e);for(var l=-1,y=i.length,w=y-1,_=e;_!=null&&++l<y;){var x=dr(i[l]),R=a;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(l!=w){var C=_[x];R=u?u(C,x,_):r,R===r&&(R=De(C)?C:Rr(i[l+1])?[]:{})}Nn(_,x,R),_=_[x]}return e}var fh=Fs?function(e,i){return Fs.set(e,i),e}:mt,Hg=ks?function(e,i){return ks(e,"toString",{configurable:!0,enumerable:!1,value:gc(i),writable:!0})}:mt;function kg(e){return co(sn(e))}function Ft(e,i,a){var u=-1,l=e.length;i<0&&(i=-i>l?0:l+i),a=a>l?l:a,a<0&&(a+=l),l=i>a?0:a-i>>>0,i>>>=0;for(var y=$(l);++u<l;)y[u]=e[u+i];return y}function Vg(e,i){var a;return Wr(e,function(u,l,y){return a=i(u,l,y),!a}),!!a}function Xs(e,i,a){var u=0,l=e==null?u:e.length;if(typeof i=="number"&&i===i&&l<=be){for(;u<l;){var y=u+l>>>1,w=e[y];w!==null&&!Nt(w)&&(a?w<=i:w<i)?u=y+1:l=y}return l}return ka(e,i,mt,a)}function ka(e,i,a,u){var l=0,y=e==null?0:e.length;if(y===0)return 0;i=a(i);for(var w=i!==i,_=i===null,x=Nt(i),R=i===r;l<y;){var C=Ks((l+y)/2),q=a(e[C]),j=q!==r,V=q===null,Z=q===q,ce=Nt(q);if(w)var X=u||Z;else R?X=Z&&(u||j):_?X=Z&&j&&(u||!V):x?X=Z&&j&&!V&&(u||!ce):V||ce?X=!1:X=u?q<=i:q<i;X?l=C+1:y=C}return st(y,$e)}function ph(e,i){for(var a=-1,u=e.length,l=0,y=[];++a<u;){var w=e[a],_=i?i(w):w;if(!a||!tr(_,x)){var x=_;y[l++]=w===0?0:w}}return y}function dh(e){return typeof e=="number"?e:Nt(e)?fe:+e}function Tt(e){if(typeof e=="string")return e;if(ne(e))return Ne(e,Tt)+"";if(Nt(e))return Fu?Fu.call(e):"";var i=e+"";return i=="0"&&1/e==-K?"-0":i}function Jr(e,i,a){var u=-1,l=Ts,y=e.length,w=!0,_=[],x=_;if(a)w=!1,l=ma;else if(y>=o){var R=i?null:ty(e);if(R)return qs(R);w=!1,l=On,x=new vi}else x=i?[]:_;e:for(;++u<y;){var C=e[u],q=i?i(C):C;if(C=a||C!==0?C:0,w&&q===q){for(var j=x.length;j--;)if(x[j]===q)continue e;i&&x.push(q),_.push(C)}else l(x,q,a)||(x!==_&&x.push(q),_.push(C))}return _}function Va(e,i){return i=Qr(i,e),e=Hh(e,i),e==null||delete e[dr(Gt(i))]}function gh(e,i,a,u){return jn(e,i,a(wi(e,i)),u)}function eo(e,i,a,u){for(var l=e.length,y=u?l:-1;(u?y--:++y<l)&&i(e[y],y,e););return a?Ft(e,u?0:y,u?y+1:l):Ft(e,u?y+1:0,u?l:y)}function yh(e,i){var a=e;return a instanceof ge&&(a=a.value()),wa(i,function(u,l){return l.func.apply(l.thisArg,Kr([u],l.args))},a)}function Ka(e,i,a){var u=e.length;if(u<2)return u?Jr(e[0]):[];for(var l=-1,y=$(u);++l<u;)for(var w=e[l],_=-1;++_<u;)_!=l&&(y[l]=qn(y[l]||w,e[_],i,a));return Jr(tt(y,1),i,a)}function vh(e,i,a){for(var u=-1,l=e.length,y=i.length,w={};++u<l;){var _=u<y?i[u]:r;a(w,e[u],_)}return w}function Fa(e){return Me(e)?e:[]}function Ga(e){return typeof e=="function"?e:mt}function Qr(e,i){return ne(e)?e:rc(e,i)?[e]:Fh(_e(e))}var Kg=he;function Yr(e,i,a){var u=e.length;return a=a===r?u:a,!i&&a>=u?e:Ft(e,i,a)}var mh=Td||function(e){return ye.clearTimeout(e)};function wh(e,i){if(i)return e.slice();var a=e.length,u=Mu?Mu(a):new e.constructor(a);return e.copy(u),u}function Wa(e){var i=new e.constructor(e.byteLength);return new Ms(i).set(new Ms(e)),i}function Fg(e,i){var a=i?Wa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function Gg(e){var i=new e.constructor(e.source,Mt.exec(e));return i.lastIndex=e.lastIndex,i}function Wg(e){return Tn?Oe(Tn.call(e)):{}}function bh(e,i){var a=i?Wa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function _h(e,i){if(e!==i){var a=e!==r,u=e===null,l=e===e,y=Nt(e),w=i!==r,_=i===null,x=i===i,R=Nt(i);if(!_&&!R&&!y&&e>i||y&&w&&x&&!_&&!R||u&&w&&x||!a&&x||!l)return 1;if(!u&&!y&&!R&&e<i||R&&a&&l&&!u&&!y||_&&a&&l||!w&&l||!x)return-1}return 0}function Jg(e,i,a){for(var u=-1,l=e.criteria,y=i.criteria,w=l.length,_=a.length;++u<w;){var x=_h(l[u],y[u]);if(x){if(u>=_)return x;var R=a[u];return x*(R=="desc"?-1:1)}}return e.index-i.index}function Eh(e,i,a,u){for(var l=-1,y=e.length,w=a.length,_=-1,x=i.length,R=Ge(y-w,0),C=$(x+R),q=!u;++_<x;)C[_]=i[_];for(;++l<w;)(q||l<y)&&(C[a[l]]=e[l]);for(;R--;)C[_++]=e[l++];return C}function Ih(e,i,a,u){for(var l=-1,y=e.length,w=-1,_=a.length,x=-1,R=i.length,C=Ge(y-_,0),q=$(C+R),j=!u;++l<C;)q[l]=e[l];for(var V=l;++x<R;)q[V+x]=i[x];for(;++w<_;)(j||l<y)&&(q[V+a[w]]=e[l++]);return q}function gt(e,i){var a=-1,u=e.length;for(i||(i=$(u));++a<u;)i[a]=e[a];return i}function pr(e,i,a,u){var l=!a;a||(a={});for(var y=-1,w=i.length;++y<w;){var _=i[y],x=u?u(a[_],e[_],_,a,e):r;x===r&&(x=e[_]),l?Or(a,_,x):Nn(a,_,x)}return a}function Qg(e,i){return pr(e,tc(e),i)}function Yg(e,i){return pr(e,zh(e),i)}function to(e,i){return function(a,u){var l=ne(a)?rd:wg,y=i?i():{};return l(a,e,J(u,2),y)}}function en(e){return he(function(i,a){var u=-1,l=a.length,y=l>1?a[l-1]:r,w=l>2?a[2]:r;for(y=e.length>3&&typeof y=="function"?(l--,y):r,w&&ft(a[0],a[1],w)&&(y=l<3?r:y,l=1),i=Oe(i);++u<l;){var _=a[u];_&&e(i,_,u,y)}return i})}function Ph(e,i){return function(a,u){if(a==null)return a;if(!yt(a))return e(a,u);for(var l=a.length,y=i?l:-1,w=Oe(a);(i?y--:++y<l)&&u(w[y],y,w)!==!1;);return a}}function xh(e){return function(i,a,u){for(var l=-1,y=Oe(i),w=u(i),_=w.length;_--;){var x=w[e?_:++l];if(a(y[x],x,y)===!1)break}return i}}function Zg(e,i,a){var u=i&k,l=Ln(e);function y(){var w=this&&this!==ye&&this instanceof y?l:e;return w.apply(u?a:this,arguments)}return y}function Sh(e){return function(i){i=_e(i);var a=Gi(i)?Xt(i):r,u=a?a[0]:i.charAt(0),l=a?Yr(a,1).join(""):i.slice(1);return u[e]()+l}}function tn(e){return function(i){return wa(Pl(Il(i).replace(xn,"")),e,"")}}function Ln(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=Xi(e.prototype),u=e.apply(a,i);return De(u)?u:a}}function Xg(e,i,a){var u=Ln(e);function l(){for(var y=arguments.length,w=$(y),_=y,x=rn(l);_--;)w[_]=arguments[_];var R=y<3&&w[0]!==x&&w[y-1]!==x?[]:Fr(w,x);if(y-=R.length,y<a)return Ch(e,i,ro,l.placeholder,r,w,R,r,r,a-y);var C=this&&this!==ye&&this instanceof l?u:e;return Je(C,this,w)}return l}function Oh(e){return function(i,a,u){var l=Oe(i);if(!yt(i)){var y=J(a,3);i=Qe(i),a=function(_){return y(l[_],_,l)}}var w=e(i,a,u);return w>-1?l[y?i[w]:w]:r}}function $h(e){return Ar(function(i){var a=i.length,u=a,l=Vt.prototype.thru;for(e&&i.reverse();u--;){var y=i[u];if(typeof y!="function")throw new kt(h);if(l&&!w&&oo(y)=="wrapper")var w=new Vt([],!0)}for(u=w?u:a;++u<a;){y=i[u];var _=oo(y),x=_=="wrapper"?Xa(y):r;x&&ic(x[0])&&x[1]==(re|N|W|oe)&&!x[4].length&&x[9]==1?w=w[oo(x[0])].apply(w,x[3]):w=y.length==1&&ic(y)?w[_]():w.thru(y)}return function(){var R=arguments,C=R[0];if(w&&R.length==1&&ne(C))return w.plant(C).value();for(var q=0,j=a?i[q].apply(this,R):C;++q<a;)j=i[q].call(this,j);return j}})}function ro(e,i,a,u,l,y,w,_,x,R){var C=i&re,q=i&k,j=i&H,V=i&(N|L),Z=i&we,ce=j?r:Ln(e);function X(){for(var pe=arguments.length,ve=$(pe),qt=pe;qt--;)ve[qt]=arguments[qt];if(V)var pt=rn(X),Dt=ld(ve,pt);if(u&&(ve=Eh(ve,u,l,V)),y&&(ve=Ih(ve,y,w,V)),pe-=Dt,V&&pe<R){var Be=Fr(ve,pt);return Ch(e,i,ro,X.placeholder,a,ve,Be,_,x,R-pe)}var rr=q?a:this,Nr=j?rr[e]:e;return pe=ve.length,_?ve=wy(ve,_):Z&&pe>1&&ve.reverse(),C&&x<pe&&(ve.length=x),this&&this!==ye&&this instanceof X&&(Nr=ce||Ln(Nr)),Nr.apply(rr,ve)}return X}function Ah(e,i){return function(a,u){return Og(a,e,i(u),{})}}function io(e,i){return function(a,u){var l;if(a===r&&u===r)return i;if(a!==r&&(l=a),u!==r){if(l===r)return u;typeof a=="string"||typeof u=="string"?(a=Tt(a),u=Tt(u)):(a=dh(a),u=dh(u)),l=e(a,u)}return l}}function Ja(e){return Ar(function(i){return i=Ne(i,Ct(J())),he(function(a){var u=this;return e(i,function(l){return Je(l,u,a)})})})}function no(e,i){i=i===r?" ":Tt(i);var a=i.length;if(a<2)return a?Ha(i,e):i;var u=Ha(i,Vs(e/Wi(i)));return Gi(i)?Yr(Xt(u),0,e).join(""):u.slice(0,e)}function ey(e,i,a,u){var l=i&k,y=Ln(e);function w(){for(var _=-1,x=arguments.length,R=-1,C=u.length,q=$(C+x),j=this&&this!==ye&&this instanceof w?y:e;++R<C;)q[R]=u[R];for(;x--;)q[R++]=arguments[++_];return Je(j,l?a:this,q)}return w}function Rh(e){return function(i,a,u){return u&&typeof u!="number"&&ft(i,a,u)&&(a=u=r),i=Tr(i),a===r?(a=i,i=0):a=Tr(a),u=u===r?i<a?1:-1:Tr(u),Ug(i,a,u,e)}}function so(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Wt(i),a=Wt(a)),e(i,a)}}function Ch(e,i,a,u,l,y,w,_,x,R){var C=i&N,q=C?w:r,j=C?r:w,V=C?y:r,Z=C?r:y;i|=C?W:le,i&=~(C?le:W),i&Q||(i&=~(k|H));var ce=[e,i,l,V,q,Z,j,_,x,R],X=a.apply(r,ce);return ic(e)&&kh(X,ce),X.placeholder=u,Vh(X,e,i)}function Qa(e){var i=Fe[e];return function(a,u){if(a=Wt(a),u=u==null?0:st(se(u),292),u&&Vu(a)){var l=(_e(a)+"e").split("e"),y=i(l[0]+"e"+(+l[1]+u));return l=(_e(y)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return i(a)}}var ty=Yi&&1/qs(new Yi([,-0]))[1]==K?function(e){return new Yi(e)}:mc;function Th(e){return function(i){var a=ot(i);return a==Xe?Sa(i):a==et?md(i):hd(i,e(i))}}function $r(e,i,a,u,l,y,w,_){var x=i&H;if(!x&&typeof e!="function")throw new kt(h);var R=u?u.length:0;if(R||(i&=~(W|le),u=l=r),w=w===r?w:Ge(se(w),0),_=_===r?_:se(_),R-=l?l.length:0,i&le){var C=u,q=l;u=l=r}var j=x?r:Xa(e),V=[e,i,a,u,l,C,q,y,w,_];if(j&&yy(V,j),e=V[0],i=V[1],a=V[2],u=V[3],l=V[4],_=V[9]=V[9]===r?x?0:e.length:Ge(V[9]-R,0),!_&&i&(N|L)&&(i&=~(N|L)),!i||i==k)var Z=Zg(e,i,a);else i==N||i==L?Z=Xg(e,i,_):(i==W||i==(k|W))&&!l.length?Z=ey(e,i,a,u):Z=ro.apply(r,V);var ce=j?fh:kh;return Vh(ce(Z,V),e,i)}function Nh(e,i,a,u){return e===r||tr(e,Qi[a])&&!Ee.call(u,a)?i:e}function qh(e,i,a,u,l,y){return De(e)&&De(i)&&(y.set(i,e),Zs(e,i,r,qh,y),y.delete(i)),e}function ry(e){return Bn(e)?r:e}function Dh(e,i,a,u,l,y){var w=a&S,_=e.length,x=i.length;if(_!=x&&!(w&&x>_))return!1;var R=y.get(e),C=y.get(i);if(R&&C)return R==i&&C==e;var q=-1,j=!0,V=a&D?new vi:r;for(y.set(e,i),y.set(i,e);++q<_;){var Z=e[q],ce=i[q];if(u)var X=w?u(ce,Z,q,i,e,y):u(Z,ce,q,e,i,y);if(X!==r){if(X)continue;j=!1;break}if(V){if(!ba(i,function(pe,ve){if(!On(V,ve)&&(Z===pe||l(Z,pe,a,u,y)))return V.push(ve)})){j=!1;break}}else if(!(Z===ce||l(Z,ce,a,u,y))){j=!1;break}}return y.delete(e),y.delete(i),j}function iy(e,i,a,u,l,y,w){switch(a){case Ut:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Lt:return!(e.byteLength!=i.byteLength||!y(new Ms(e),new Ms(i)));case Re:case Le:case wr:return tr(+e,+i);case ut:return e.name==i.name&&e.message==i.message;case ar:case cr:return e==i+"";case Xe:var _=Sa;case et:var x=u&S;if(_||(_=qs),e.size!=i.size&&!x)return!1;var R=w.get(e);if(R)return R==i;u|=D,w.set(e,i);var C=Dh(_(e),_(i),u,l,y,w);return w.delete(e),C;case br:if(Tn)return Tn.call(e)==Tn.call(i)}return!1}function ny(e,i,a,u,l,y){var w=a&S,_=Ya(e),x=_.length,R=Ya(i),C=R.length;if(x!=C&&!w)return!1;for(var q=x;q--;){var j=_[q];if(!(w?j in i:Ee.call(i,j)))return!1}var V=y.get(e),Z=y.get(i);if(V&&Z)return V==i&&Z==e;var ce=!0;y.set(e,i),y.set(i,e);for(var X=w;++q<x;){j=_[q];var pe=e[j],ve=i[j];if(u)var qt=w?u(ve,pe,j,i,e,y):u(pe,ve,j,e,i,y);if(!(qt===r?pe===ve||l(pe,ve,a,u,y):qt)){ce=!1;break}X||(X=j=="constructor")}if(ce&&!X){var pt=e.constructor,Dt=i.constructor;pt!=Dt&&"constructor"in e&&"constructor"in i&&!(typeof pt=="function"&&pt instanceof pt&&typeof Dt=="function"&&Dt instanceof Dt)&&(ce=!1)}return y.delete(e),y.delete(i),ce}function Ar(e){return sc(Bh(e,r,Qh),e+"")}function Ya(e){return th(e,Qe,tc)}function Za(e){return th(e,vt,zh)}var Xa=Fs?function(e){return Fs.get(e)}:mc;function oo(e){for(var i=e.name+"",a=Zi[i],u=Ee.call(Zi,i)?a.length:0;u--;){var l=a[u],y=l.func;if(y==null||y==e)return l.name}return i}function rn(e){var i=Ee.call(d,"placeholder")?d:e;return i.placeholder}function J(){var e=d.iteratee||yc;return e=e===yc?nh:e,arguments.length?e(arguments[0],arguments[1]):e}function ao(e,i){var a=e.__data__;return fy(i)?a[typeof i=="string"?"string":"hash"]:a.map}function ec(e){for(var i=Qe(e),a=i.length;a--;){var u=i[a],l=e[u];i[a]=[u,l,Uh(l)]}return i}function bi(e,i){var a=gd(e,i);return ih(a)?a:r}function sy(e){var i=Ee.call(e,gi),a=e[gi];try{e[gi]=r;var u=!0}catch{}var l=Ls.call(e);return u&&(i?e[gi]=a:delete e[gi]),l}var tc=$a?function(e){return e==null?[]:(e=Oe(e),Vr($a(e),function(i){return Hu.call(e,i)}))}:wc,zh=$a?function(e){for(var i=[];e;)Kr(i,tc(e)),e=Bs(e);return i}:wc,ot=lt;(Aa&&ot(new Aa(new ArrayBuffer(1)))!=Ut||An&&ot(new An)!=Xe||Ra&&ot(Ra.resolve())!=Ai||Yi&&ot(new Yi)!=et||Rn&&ot(new Rn)!=ur)&&(ot=function(e){var i=lt(e),a=i==At?e.constructor:r,u=a?_i(a):"";if(u)switch(u){case Bd:return Ut;case Hd:return Xe;case kd:return Ai;case Vd:return et;case Kd:return ur}return i});function oy(e,i,a){for(var u=-1,l=a.length;++u<l;){var y=a[u],w=y.size;switch(y.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=st(i,e+w);break;case"takeRight":e=Ge(e,i-w);break}}return{start:e,end:i}}function ay(e){var i=e.match(Er);return i?i[1].split(Jo):[]}function jh(e,i,a){i=Qr(i,e);for(var u=-1,l=i.length,y=!1;++u<l;){var w=dr(i[u]);if(!(y=e!=null&&a(e,w)))break;e=e[w]}return y||++u!=l?y:(l=e==null?0:e.length,!!l&&go(l)&&Rr(w,l)&&(ne(e)||Ei(e)))}function cy(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&Ee.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function Lh(e){return typeof e.constructor=="function"&&!Un(e)?Xi(Bs(e)):{}}function uy(e,i,a){var u=e.constructor;switch(i){case Lt:return Wa(e);case Re:case Le:return new u(+e);case Ut:return Fg(e,a);case Br:case nt:case Ni:case qi:case yn:case Di:case Hr:case zi:case ji:return bh(e,a);case Xe:return new u;case wr:case cr:return new u(e);case ar:return Gg(e);case et:return new u;case br:return Wg(e)}}function hy(e,i){var a=i.length;if(!a)return e;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),e.replace(En,`{
/* [wrapped with `+i+`] */
`)}function ly(e){return ne(e)||Ei(e)||!!(ku&&e&&e[ku])}function Rr(e,i){var a=typeof e;return i=i??F,!!i&&(a=="number"||a!="symbol"&&na.test(e))&&e>-1&&e%1==0&&e<i}function ft(e,i,a){if(!De(a))return!1;var u=typeof i;return(u=="number"?yt(a)&&Rr(i,a.length):u=="string"&&i in a)?tr(a[i],e):!1}function rc(e,i){if(ne(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||Nt(e)?!0:Fo.test(e)||!ui.test(e)||i!=null&&e in Oe(i)}function fy(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function ic(e){var i=oo(e),a=d[i];if(typeof a!="function"||!(i in ge.prototype))return!1;if(e===a)return!0;var u=Xa(a);return!!u&&e===u[0]}function py(e){return!!Uu&&Uu in e}var dy=zs?Cr:bc;function Un(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||Qi;return e===a}function Uh(e){return e===e&&!De(e)}function Mh(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in Oe(a))}}function gy(e){var i=fo(e,function(u){return a.size===g&&a.clear(),u}),a=i.cache;return i}function yy(e,i){var a=e[1],u=i[1],l=a|u,y=l<(k|H|re),w=u==re&&a==N||u==re&&a==oe&&e[7].length<=i[8]||u==(re|oe)&&i[7].length<=i[8]&&a==N;if(!(y||w))return e;u&k&&(e[2]=i[2],l|=a&k?0:Q);var _=i[3];if(_){var x=e[3];e[3]=x?Eh(x,_,i[4]):_,e[4]=x?Fr(e[3],v):i[4]}return _=i[5],_&&(x=e[5],e[5]=x?Ih(x,_,i[6]):_,e[6]=x?Fr(e[5],v):i[6]),_=i[7],_&&(e[7]=_),u&re&&(e[8]=e[8]==null?i[8]:st(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function vy(e){var i=[];if(e!=null)for(var a in Oe(e))i.push(a);return i}function my(e){return Ls.call(e)}function Bh(e,i,a){return i=Ge(i===r?e.length-1:i,0),function(){for(var u=arguments,l=-1,y=Ge(u.length-i,0),w=$(y);++l<y;)w[l]=u[i+l];l=-1;for(var _=$(i+1);++l<i;)_[l]=u[l];return _[i]=a(w),Je(e,this,_)}}function Hh(e,i){return i.length<2?e:wi(e,Ft(i,0,-1))}function wy(e,i){for(var a=e.length,u=st(i.length,a),l=gt(e);u--;){var y=i[u];e[u]=Rr(y,a)?l[y]:r}return e}function nc(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var kh=Kh(fh),Mn=qd||function(e,i){return ye.setTimeout(e,i)},sc=Kh(Hg);function Vh(e,i,a){var u=i+"";return sc(e,hy(u,by(ay(u),a)))}function Kh(e){var i=0,a=0;return function(){var u=Ld(),l=mr-(u-a);if(a=u,l>0){if(++i>=xt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function co(e,i){var a=-1,u=e.length,l=u-1;for(i=i===r?u:i;++a<i;){var y=Ba(a,l),w=e[y];e[y]=e[a],e[a]=w}return e.length=i,e}var Fh=gy(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Go,function(a,u,l,y){i.push(l?y.replace(Zo,"$1"):u||a)}),i});function dr(e){if(typeof e=="string"||Nt(e))return e;var i=e+"";return i=="0"&&1/e==-K?"-0":i}function _i(e){if(e!=null){try{return js.call(e)}catch{}try{return e+""}catch{}}return""}function by(e,i){return Ht(Ae,function(a){var u="_."+a[0];i&a[1]&&!Ts(e,u)&&e.push(u)}),e.sort()}function Gh(e){if(e instanceof ge)return e.clone();var i=new Vt(e.__wrapped__,e.__chain__);return i.__actions__=gt(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function _y(e,i,a){(a?ft(e,i,a):i===r)?i=1:i=Ge(se(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var l=0,y=0,w=$(Vs(u/i));l<u;)w[y++]=Ft(e,l,l+=i);return w}function Ey(e){for(var i=-1,a=e==null?0:e.length,u=0,l=[];++i<a;){var y=e[i];y&&(l[u++]=y)}return l}function Iy(){var e=arguments.length;if(!e)return[];for(var i=$(e-1),a=arguments[0],u=e;u--;)i[u-1]=arguments[u];return Kr(ne(a)?gt(a):[a],tt(i,1))}var Py=he(function(e,i){return Me(e)?qn(e,tt(i,1,Me,!0)):[]}),xy=he(function(e,i){var a=Gt(i);return Me(a)&&(a=r),Me(e)?qn(e,tt(i,1,Me,!0),J(a,2)):[]}),Sy=he(function(e,i){var a=Gt(i);return Me(a)&&(a=r),Me(e)?qn(e,tt(i,1,Me,!0),r,a):[]});function Oy(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),Ft(e,i<0?0:i,u)):[]}function $y(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),i=u-i,Ft(e,0,i<0?0:i)):[]}function Ay(e,i){return e&&e.length?eo(e,J(i,3),!0,!0):[]}function Ry(e,i){return e&&e.length?eo(e,J(i,3),!0):[]}function Cy(e,i,a,u){var l=e==null?0:e.length;return l?(a&&typeof a!="number"&&ft(e,i,a)&&(a=0,u=l),Ig(e,i,a,u)):[]}function Wh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=a==null?0:se(a);return l<0&&(l=Ge(u+l,0)),Ns(e,J(i,3),l)}function Jh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=u-1;return a!==r&&(l=se(a),l=a<0?Ge(u+l,0):st(l,u-1)),Ns(e,J(i,3),l,!0)}function Qh(e){var i=e==null?0:e.length;return i?tt(e,1):[]}function Ty(e){var i=e==null?0:e.length;return i?tt(e,K):[]}function Ny(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:se(i),tt(e,i)):[]}function qy(e){for(var i=-1,a=e==null?0:e.length,u={};++i<a;){var l=e[i];u[l[0]]=l[1]}return u}function Yh(e){return e&&e.length?e[0]:r}function Dy(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=a==null?0:se(a);return l<0&&(l=Ge(u+l,0)),Fi(e,i,l)}function zy(e){var i=e==null?0:e.length;return i?Ft(e,0,-1):[]}var jy=he(function(e){var i=Ne(e,Fa);return i.length&&i[0]===e[0]?za(i):[]}),Ly=he(function(e){var i=Gt(e),a=Ne(e,Fa);return i===Gt(a)?i=r:a.pop(),a.length&&a[0]===e[0]?za(a,J(i,2)):[]}),Uy=he(function(e){var i=Gt(e),a=Ne(e,Fa);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?za(a,r,i):[]});function My(e,i){return e==null?"":zd.call(e,i)}function Gt(e){var i=e==null?0:e.length;return i?e[i-1]:r}function By(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=u;return a!==r&&(l=se(a),l=l<0?Ge(u+l,0):st(l,u-1)),i===i?bd(e,i,l):Ns(e,Cu,l,!0)}function Hy(e,i){return e&&e.length?ch(e,se(i)):r}var ky=he(Zh);function Zh(e,i){return e&&e.length&&i&&i.length?Ma(e,i):e}function Vy(e,i,a){return e&&e.length&&i&&i.length?Ma(e,i,J(a,2)):e}function Ky(e,i,a){return e&&e.length&&i&&i.length?Ma(e,i,r,a):e}var Fy=Ar(function(e,i){var a=e==null?0:e.length,u=Ta(e,i);return lh(e,Ne(i,function(l){return Rr(l,a)?+l:l}).sort(_h)),u});function Gy(e,i){var a=[];if(!(e&&e.length))return a;var u=-1,l=[],y=e.length;for(i=J(i,3);++u<y;){var w=e[u];i(w,u,e)&&(a.push(w),l.push(u))}return lh(e,l),a}function oc(e){return e==null?e:Md.call(e)}function Wy(e,i,a){var u=e==null?0:e.length;return u?(a&&typeof a!="number"&&ft(e,i,a)?(i=0,a=u):(i=i==null?0:se(i),a=a===r?u:se(a)),Ft(e,i,a)):[]}function Jy(e,i){return Xs(e,i)}function Qy(e,i,a){return ka(e,i,J(a,2))}function Yy(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i);if(u<a&&tr(e[u],i))return u}return-1}function Zy(e,i){return Xs(e,i,!0)}function Xy(e,i,a){return ka(e,i,J(a,2),!0)}function ev(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i,!0)-1;if(tr(e[u],i))return u}return-1}function tv(e){return e&&e.length?ph(e):[]}function rv(e,i){return e&&e.length?ph(e,J(i,2)):[]}function iv(e){var i=e==null?0:e.length;return i?Ft(e,1,i):[]}function nv(e,i,a){return e&&e.length?(i=a||i===r?1:se(i),Ft(e,0,i<0?0:i)):[]}function sv(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),i=u-i,Ft(e,i<0?0:i,u)):[]}function ov(e,i){return e&&e.length?eo(e,J(i,3),!1,!0):[]}function av(e,i){return e&&e.length?eo(e,J(i,3)):[]}var cv=he(function(e){return Jr(tt(e,1,Me,!0))}),uv=he(function(e){var i=Gt(e);return Me(i)&&(i=r),Jr(tt(e,1,Me,!0),J(i,2))}),hv=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Jr(tt(e,1,Me,!0),r,i)});function lv(e){return e&&e.length?Jr(e):[]}function fv(e,i){return e&&e.length?Jr(e,J(i,2)):[]}function pv(e,i){return i=typeof i=="function"?i:r,e&&e.length?Jr(e,r,i):[]}function ac(e){if(!(e&&e.length))return[];var i=0;return e=Vr(e,function(a){if(Me(a))return i=Ge(a.length,i),!0}),Pa(i,function(a){return Ne(e,_a(a))})}function Xh(e,i){if(!(e&&e.length))return[];var a=ac(e);return i==null?a:Ne(a,function(u){return Je(i,r,u)})}var dv=he(function(e,i){return Me(e)?qn(e,i):[]}),gv=he(function(e){return Ka(Vr(e,Me))}),yv=he(function(e){var i=Gt(e);return Me(i)&&(i=r),Ka(Vr(e,Me),J(i,2))}),vv=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Ka(Vr(e,Me),r,i)}),mv=he(ac);function wv(e,i){return vh(e||[],i||[],Nn)}function bv(e,i){return vh(e||[],i||[],jn)}var _v=he(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,Xh(e,a)});function el(e){var i=d(e);return i.__chain__=!0,i}function Ev(e,i){return i(e),e}function uo(e,i){return i(e)}var Iv=Ar(function(e){var i=e.length,a=i?e[0]:0,u=this.__wrapped__,l=function(y){return Ta(y,e)};return i>1||this.__actions__.length||!(u instanceof ge)||!Rr(a)?this.thru(l):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:uo,args:[l],thisArg:r}),new Vt(u,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function Pv(){return el(this)}function xv(){return new Vt(this.value(),this.__chain__)}function Sv(){this.__values__===r&&(this.__values__=dl(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Ov(){return this}function $v(e){for(var i,a=this;a instanceof Ws;){var u=Gh(a);u.__index__=0,u.__values__=r,i?l.__wrapped__=u:i=u;var l=u;a=a.__wrapped__}return l.__wrapped__=e,i}function Av(){var e=this.__wrapped__;if(e instanceof ge){var i=e;return this.__actions__.length&&(i=new ge(this)),i=i.reverse(),i.__actions__.push({func:uo,args:[oc],thisArg:r}),new Vt(i,this.__chain__)}return this.thru(oc)}function Rv(){return yh(this.__wrapped__,this.__actions__)}var Cv=to(function(e,i,a){Ee.call(e,a)?++e[a]:Or(e,a,1)});function Tv(e,i,a){var u=ne(e)?Au:Eg;return a&&ft(e,i,a)&&(i=r),u(e,J(i,3))}function Nv(e,i){var a=ne(e)?Vr:Xu;return a(e,J(i,3))}var qv=Oh(Wh),Dv=Oh(Jh);function zv(e,i){return tt(ho(e,i),1)}function jv(e,i){return tt(ho(e,i),K)}function Lv(e,i,a){return a=a===r?1:se(a),tt(ho(e,i),a)}function tl(e,i){var a=ne(e)?Ht:Wr;return a(e,J(i,3))}function rl(e,i){var a=ne(e)?id:Zu;return a(e,J(i,3))}var Uv=to(function(e,i,a){Ee.call(e,a)?e[a].push(i):Or(e,a,[i])});function Mv(e,i,a,u){e=yt(e)?e:sn(e),a=a&&!u?se(a):0;var l=e.length;return a<0&&(a=Ge(l+a,0)),yo(e)?a<=l&&e.indexOf(i,a)>-1:!!l&&Fi(e,i,a)>-1}var Bv=he(function(e,i,a){var u=-1,l=typeof i=="function",y=yt(e)?$(e.length):[];return Wr(e,function(w){y[++u]=l?Je(i,w,a):Dn(w,i,a)}),y}),Hv=to(function(e,i,a){Or(e,a,i)});function ho(e,i){var a=ne(e)?Ne:sh;return a(e,J(i,3))}function kv(e,i,a,u){return e==null?[]:(ne(i)||(i=i==null?[]:[i]),a=u?r:a,ne(a)||(a=a==null?[]:[a]),uh(e,i,a))}var Vv=to(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function Kv(e,i,a){var u=ne(e)?wa:Nu,l=arguments.length<3;return u(e,J(i,4),a,l,Wr)}function Fv(e,i,a){var u=ne(e)?nd:Nu,l=arguments.length<3;return u(e,J(i,4),a,l,Zu)}function Gv(e,i){var a=ne(e)?Vr:Xu;return a(e,po(J(i,3)))}function Wv(e){var i=ne(e)?Wu:Mg;return i(e)}function Jv(e,i,a){(a?ft(e,i,a):i===r)?i=1:i=se(i);var u=ne(e)?vg:Bg;return u(e,i)}function Qv(e){var i=ne(e)?mg:kg;return i(e)}function Yv(e){if(e==null)return 0;if(yt(e))return yo(e)?Wi(e):e.length;var i=ot(e);return i==Xe||i==et?e.size:La(e).length}function Zv(e,i,a){var u=ne(e)?ba:Vg;return a&&ft(e,i,a)&&(i=r),u(e,J(i,3))}var Xv=he(function(e,i){if(e==null)return[];var a=i.length;return a>1&&ft(e,i[0],i[1])?i=[]:a>2&&ft(i[0],i[1],i[2])&&(i=[i[0]]),uh(e,tt(i,1),[])}),lo=Nd||function(){return ye.Date.now()};function em(e,i){if(typeof i!="function")throw new kt(h);return e=se(e),function(){if(--e<1)return i.apply(this,arguments)}}function il(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,$r(e,re,r,r,r,r,i)}function nl(e,i){var a;if(typeof i!="function")throw new kt(h);return e=se(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var cc=he(function(e,i,a){var u=k;if(a.length){var l=Fr(a,rn(cc));u|=W}return $r(e,u,i,a,l)}),sl=he(function(e,i,a){var u=k|H;if(a.length){var l=Fr(a,rn(sl));u|=W}return $r(i,u,e,a,l)});function ol(e,i,a){i=a?r:i;var u=$r(e,N,r,r,r,r,r,i);return u.placeholder=ol.placeholder,u}function al(e,i,a){i=a?r:i;var u=$r(e,L,r,r,r,r,r,i);return u.placeholder=al.placeholder,u}function cl(e,i,a){var u,l,y,w,_,x,R=0,C=!1,q=!1,j=!0;if(typeof e!="function")throw new kt(h);i=Wt(i)||0,De(a)&&(C=!!a.leading,q="maxWait"in a,y=q?Ge(Wt(a.maxWait)||0,i):y,j="trailing"in a?!!a.trailing:j);function V(Be){var rr=u,Nr=l;return u=l=r,R=Be,w=e.apply(Nr,rr),w}function Z(Be){return R=Be,_=Mn(pe,i),C?V(Be):w}function ce(Be){var rr=Be-x,Nr=Be-R,Ol=i-rr;return q?st(Ol,y-Nr):Ol}function X(Be){var rr=Be-x,Nr=Be-R;return x===r||rr>=i||rr<0||q&&Nr>=y}function pe(){var Be=lo();if(X(Be))return ve(Be);_=Mn(pe,ce(Be))}function ve(Be){return _=r,j&&u?V(Be):(u=l=r,w)}function qt(){_!==r&&mh(_),R=0,u=x=l=_=r}function pt(){return _===r?w:ve(lo())}function Dt(){var Be=lo(),rr=X(Be);if(u=arguments,l=this,x=Be,rr){if(_===r)return Z(x);if(q)return mh(_),_=Mn(pe,i),V(x)}return _===r&&(_=Mn(pe,i)),w}return Dt.cancel=qt,Dt.flush=pt,Dt}var tm=he(function(e,i){return Yu(e,1,i)}),rm=he(function(e,i,a){return Yu(e,Wt(i)||0,a)});function im(e){return $r(e,we)}function fo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new kt(h);var a=function(){var u=arguments,l=i?i.apply(this,u):u[0],y=a.cache;if(y.has(l))return y.get(l);var w=e.apply(this,u);return a.cache=y.set(l,w)||y,w};return a.cache=new(fo.Cache||Sr),a}fo.Cache=Sr;function po(e){if(typeof e!="function")throw new kt(h);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function nm(e){return nl(2,e)}var sm=Kg(function(e,i){i=i.length==1&&ne(i[0])?Ne(i[0],Ct(J())):Ne(tt(i,1),Ct(J()));var a=i.length;return he(function(u){for(var l=-1,y=st(u.length,a);++l<y;)u[l]=i[l].call(this,u[l]);return Je(e,this,u)})}),uc=he(function(e,i){var a=Fr(i,rn(uc));return $r(e,W,r,i,a)}),ul=he(function(e,i){var a=Fr(i,rn(ul));return $r(e,le,r,i,a)}),om=Ar(function(e,i){return $r(e,oe,r,r,r,i)});function am(e,i){if(typeof e!="function")throw new kt(h);return i=i===r?i:se(i),he(e,i)}function cm(e,i){if(typeof e!="function")throw new kt(h);return i=i==null?0:Ge(se(i),0),he(function(a){var u=a[i],l=Yr(a,0,i);return u&&Kr(l,u),Je(e,this,l)})}function um(e,i,a){var u=!0,l=!0;if(typeof e!="function")throw new kt(h);return De(a)&&(u="leading"in a?!!a.leading:u,l="trailing"in a?!!a.trailing:l),cl(e,i,{leading:u,maxWait:i,trailing:l})}function hm(e){return il(e,1)}function lm(e,i){return uc(Ga(i),e)}function fm(){if(!arguments.length)return[];var e=arguments[0];return ne(e)?e:[e]}function pm(e){return Kt(e,O)}function dm(e,i){return i=typeof i=="function"?i:r,Kt(e,O,i)}function gm(e){return Kt(e,b|O)}function ym(e,i){return i=typeof i=="function"?i:r,Kt(e,b|O,i)}function vm(e,i){return i==null||Qu(e,i,Qe(i))}function tr(e,i){return e===i||e!==e&&i!==i}var mm=so(Da),wm=so(function(e,i){return e>=i}),Ei=rh(function(){return arguments}())?rh:function(e){return je(e)&&Ee.call(e,"callee")&&!Hu.call(e,"callee")},ne=$.isArray,bm=ht?Ct(ht):$g;function yt(e){return e!=null&&go(e.length)&&!Cr(e)}function Me(e){return je(e)&&yt(e)}function _m(e){return e===!0||e===!1||je(e)&&lt(e)==Re}var Zr=Dd||bc,Em=Zt?Ct(Zt):Ag;function Im(e){return je(e)&&e.nodeType===1&&!Bn(e)}function Pm(e){if(e==null)return!0;if(yt(e)&&(ne(e)||typeof e=="string"||typeof e.splice=="function"||Zr(e)||nn(e)||Ei(e)))return!e.length;var i=ot(e);if(i==Xe||i==et)return!e.size;if(Un(e))return!La(e).length;for(var a in e)if(Ee.call(e,a))return!1;return!0}function xm(e,i){return zn(e,i)}function Sm(e,i,a){a=typeof a=="function"?a:r;var u=a?a(e,i):r;return u===r?zn(e,i,r,a):!!u}function hc(e){if(!je(e))return!1;var i=lt(e);return i==ut||i==Ot||typeof e.message=="string"&&typeof e.name=="string"&&!Bn(e)}function Om(e){return typeof e=="number"&&Vu(e)}function Cr(e){if(!De(e))return!1;var i=lt(e);return i==$t||i==Mr||i==St||i==Ri}function hl(e){return typeof e=="number"&&e==se(e)}function go(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=F}function De(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function je(e){return e!=null&&typeof e=="object"}var ll=Bt?Ct(Bt):Cg;function $m(e,i){return e===i||ja(e,i,ec(i))}function Am(e,i,a){return a=typeof a=="function"?a:r,ja(e,i,ec(i),a)}function Rm(e){return fl(e)&&e!=+e}function Cm(e){if(dy(e))throw new te(c);return ih(e)}function Tm(e){return e===null}function Nm(e){return e==null}function fl(e){return typeof e=="number"||je(e)&&lt(e)==wr}function Bn(e){if(!je(e)||lt(e)!=At)return!1;var i=Bs(e);if(i===null)return!0;var a=Ee.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&js.call(a)==Ad}var lc=lr?Ct(lr):Tg;function qm(e){return hl(e)&&e>=-F&&e<=F}var pl=Sn?Ct(Sn):Ng;function yo(e){return typeof e=="string"||!ne(e)&&je(e)&&lt(e)==cr}function Nt(e){return typeof e=="symbol"||je(e)&&lt(e)==br}var nn=di?Ct(di):qg;function Dm(e){return e===r}function zm(e){return je(e)&&ot(e)==ur}function jm(e){return je(e)&&lt(e)==Ti}var Lm=so(Ua),Um=so(function(e,i){return e<=i});function dl(e){if(!e)return[];if(yt(e))return yo(e)?Xt(e):gt(e);if($n&&e[$n])return vd(e[$n]());var i=ot(e),a=i==Xe?Sa:i==et?qs:sn;return a(e)}function Tr(e){if(!e)return e===0?e:0;if(e=Wt(e),e===K||e===-K){var i=e<0?-1:1;return i*de}return e===e?e:0}function se(e){var i=Tr(e),a=i%1;return i===i?a?i-a:i:0}function gl(e){return e?mi(se(e),0,ae):0}function Wt(e){if(typeof e=="number")return e;if(Nt(e))return fe;if(De(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=De(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=qu(e);var a=ta.test(e);return a||ia.test(e)?ie(e.slice(2),a?2:8):ea.test(e)?fe:+e}function yl(e){return pr(e,vt(e))}function Mm(e){return e?mi(se(e),-F,F):e===0?e:0}function _e(e){return e==null?"":Tt(e)}var Bm=en(function(e,i){if(Un(i)||yt(i)){pr(i,Qe(i),e);return}for(var a in i)Ee.call(i,a)&&Nn(e,a,i[a])}),vl=en(function(e,i){pr(i,vt(i),e)}),vo=en(function(e,i,a,u){pr(i,vt(i),e,u)}),Hm=en(function(e,i,a,u){pr(i,Qe(i),e,u)}),km=Ar(Ta);function Vm(e,i){var a=Xi(e);return i==null?a:Ju(a,i)}var Km=he(function(e,i){e=Oe(e);var a=-1,u=i.length,l=u>2?i[2]:r;for(l&&ft(i[0],i[1],l)&&(u=1);++a<u;)for(var y=i[a],w=vt(y),_=-1,x=w.length;++_<x;){var R=w[_],C=e[R];(C===r||tr(C,Qi[R])&&!Ee.call(e,R))&&(e[R]=y[R])}return e}),Fm=he(function(e){return e.push(r,qh),Je(ml,r,e)});function Gm(e,i){return Ru(e,J(i,3),fr)}function Wm(e,i){return Ru(e,J(i,3),qa)}function Jm(e,i){return e==null?e:Na(e,J(i,3),vt)}function Qm(e,i){return e==null?e:eh(e,J(i,3),vt)}function Ym(e,i){return e&&fr(e,J(i,3))}function Zm(e,i){return e&&qa(e,J(i,3))}function Xm(e){return e==null?[]:Ys(e,Qe(e))}function ew(e){return e==null?[]:Ys(e,vt(e))}function fc(e,i,a){var u=e==null?r:wi(e,i);return u===r?a:u}function tw(e,i){return e!=null&&jh(e,i,Pg)}function pc(e,i){return e!=null&&jh(e,i,xg)}var rw=Ah(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Ls.call(i)),e[i]=a},gc(mt)),iw=Ah(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Ls.call(i)),Ee.call(e,i)?e[i].push(a):e[i]=[a]},J),nw=he(Dn);function Qe(e){return yt(e)?Gu(e):La(e)}function vt(e){return yt(e)?Gu(e,!0):Dg(e)}function sw(e,i){var a={};return i=J(i,3),fr(e,function(u,l,y){Or(a,i(u,l,y),u)}),a}function ow(e,i){var a={};return i=J(i,3),fr(e,function(u,l,y){Or(a,l,i(u,l,y))}),a}var aw=en(function(e,i,a){Zs(e,i,a)}),ml=en(function(e,i,a,u){Zs(e,i,a,u)}),cw=Ar(function(e,i){var a={};if(e==null)return a;var u=!1;i=Ne(i,function(y){return y=Qr(y,e),u||(u=y.length>1),y}),pr(e,Za(e),a),u&&(a=Kt(a,b|E|O,ry));for(var l=i.length;l--;)Va(a,i[l]);return a});function uw(e,i){return wl(e,po(J(i)))}var hw=Ar(function(e,i){return e==null?{}:jg(e,i)});function wl(e,i){if(e==null)return{};var a=Ne(Za(e),function(u){return[u]});return i=J(i),hh(e,a,function(u,l){return i(u,l[0])})}function lw(e,i,a){i=Qr(i,e);var u=-1,l=i.length;for(l||(l=1,e=r);++u<l;){var y=e==null?r:e[dr(i[u])];y===r&&(u=l,y=a),e=Cr(y)?y.call(e):y}return e}function fw(e,i,a){return e==null?e:jn(e,i,a)}function pw(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:jn(e,i,a,u)}var bl=Th(Qe),_l=Th(vt);function dw(e,i,a){var u=ne(e),l=u||Zr(e)||nn(e);if(i=J(i,4),a==null){var y=e&&e.constructor;l?a=u?new y:[]:De(e)?a=Cr(y)?Xi(Bs(e)):{}:a={}}return(l?Ht:fr)(e,function(w,_,x){return i(a,w,_,x)}),a}function gw(e,i){return e==null?!0:Va(e,i)}function yw(e,i,a){return e==null?e:gh(e,i,Ga(a))}function vw(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:gh(e,i,Ga(a),u)}function sn(e){return e==null?[]:xa(e,Qe(e))}function mw(e){return e==null?[]:xa(e,vt(e))}function ww(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Wt(a),a=a===a?a:0),i!==r&&(i=Wt(i),i=i===i?i:0),mi(Wt(e),i,a)}function bw(e,i,a){return i=Tr(i),a===r?(a=i,i=0):a=Tr(a),e=Wt(e),Sg(e,i,a)}function _w(e,i,a){if(a&&typeof a!="boolean"&&ft(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=Tr(e),i===r?(i=e,e=0):i=Tr(i)),e>i){var u=e;e=i,i=u}if(a||e%1||i%1){var l=Ku();return st(e+l*(i-e+xe("1e-"+((l+"").length-1))),i)}return Ba(e,i)}var Ew=tn(function(e,i,a){return i=i.toLowerCase(),e+(a?El(i):i)});function El(e){return dc(_e(e).toLowerCase())}function Il(e){return e=_e(e),e&&e.replace(Ir,fd).replace(ya,"")}function Iw(e,i,a){e=_e(e),i=Tt(i);var u=e.length;a=a===r?u:mi(se(a),0,u);var l=a;return a-=i.length,a>=0&&e.slice(a,l)==i}function Pw(e){return e=_e(e),e&&ci.test(e)?e.replace(ls,pd):e}function xw(e){return e=_e(e),e&&Wo.test(e)?e.replace(bn,"\\$&"):e}var Sw=tn(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),Ow=tn(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),$w=Sh("toLowerCase");function Aw(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;if(!i||u>=i)return e;var l=(i-u)/2;return no(Ks(l),a)+e+no(Vs(l),a)}function Rw(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;return i&&u<i?e+no(i-u,a):e}function Cw(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;return i&&u<i?no(i-u,a)+e:e}function Tw(e,i,a){return a||i==null?i=0:i&&(i=+i),Ud(_e(e).replace(_n,""),i||0)}function Nw(e,i,a){return(a?ft(e,i,a):i===r)?i=1:i=se(i),Ha(_e(e),i)}function qw(){var e=arguments,i=_e(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Dw=tn(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function zw(e,i,a){return a&&typeof a!="number"&&ft(e,i,a)&&(i=a=r),a=a===r?ae:a>>>0,a?(e=_e(e),e&&(typeof i=="string"||i!=null&&!lc(i))&&(i=Tt(i),!i&&Gi(e))?Yr(Xt(e),0,a):e.split(i,a)):[]}var jw=tn(function(e,i,a){return e+(a?" ":"")+dc(i)});function Lw(e,i,a){return e=_e(e),a=a==null?0:mi(se(a),0,e.length),i=Tt(i),e.slice(a,a+i.length)==i}function Uw(e,i,a){var u=d.templateSettings;a&&ft(e,i,a)&&(i=r),e=_e(e),i=vo({},i,u,Nh);var l=vo({},i.imports,u.imports,Nh),y=Qe(l),w=xa(l,y),_,x,R=0,C=i.interpolate||Ui,q="__p += '",j=Oa((i.escape||Ui).source+"|"+C.source+"|"+(C===Li?Xo:Ui).source+"|"+(i.evaluate||Ui).source+"|$","g"),V="//# sourceURL="+(Ee.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++va+"]")+`
`;e.replace(j,function(X,pe,ve,qt,pt,Dt){return ve||(ve=qt),q+=e.slice(R,Dt).replace(sa,dd),pe&&(_=!0,q+=`' +
__e(`+pe+`) +
'`),pt&&(x=!0,q+=`';
`+pt+`;
__p += '`),ve&&(q+=`' +
((__t = (`+ve+`)) == null ? '' : __t) +
'`),R=Dt+X.length,X}),q+=`';
`;var Z=Ee.call(i,"variable")&&i.variable;if(!Z)q=`with (obj) {
`+q+`
}
`;else if(Yo.test(Z))throw new te(p);q=(x?q.replace(Ko,""):q).replace(_r,"$1").replace(us,"$1;"),q="function("+(Z||"obj")+`) {
`+(Z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+q+`return __p
}`;var ce=xl(function(){return me(y,V+"return "+q).apply(r,w)});if(ce.source=q,hc(ce))throw ce;return ce}function Mw(e){return _e(e).toLowerCase()}function Bw(e){return _e(e).toUpperCase()}function Hw(e,i,a){if(e=_e(e),e&&(a||i===r))return qu(e);if(!e||!(i=Tt(i)))return e;var u=Xt(e),l=Xt(i),y=Du(u,l),w=zu(u,l)+1;return Yr(u,y,w).join("")}function kw(e,i,a){if(e=_e(e),e&&(a||i===r))return e.slice(0,Lu(e)+1);if(!e||!(i=Tt(i)))return e;var u=Xt(e),l=zu(u,Xt(i))+1;return Yr(u,0,l).join("")}function Vw(e,i,a){if(e=_e(e),e&&(a||i===r))return e.replace(_n,"");if(!e||!(i=Tt(i)))return e;var u=Xt(e),l=Du(u,Xt(i));return Yr(u,l).join("")}function Kw(e,i){var a=zt,u=jt;if(De(i)){var l="separator"in i?i.separator:l;a="length"in i?se(i.length):a,u="omission"in i?Tt(i.omission):u}e=_e(e);var y=e.length;if(Gi(e)){var w=Xt(e);y=w.length}if(a>=y)return e;var _=a-Wi(u);if(_<1)return u;var x=w?Yr(w,0,_).join(""):e.slice(0,_);if(l===r)return x+u;if(w&&(_+=x.length-_),lc(l)){if(e.slice(_).search(l)){var R,C=x;for(l.global||(l=Oa(l.source,_e(Mt.exec(l))+"g")),l.lastIndex=0;R=l.exec(C);)var q=R.index;x=x.slice(0,q===r?_:q)}}else if(e.indexOf(Tt(l),_)!=_){var j=x.lastIndexOf(l);j>-1&&(x=x.slice(0,j))}return x+u}function Fw(e){return e=_e(e),e&&vn.test(e)?e.replace(hs,_d):e}var Gw=tn(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),dc=Sh("toUpperCase");function Pl(e,i,a){return e=_e(e),i=a?r:i,i===r?yd(e)?Pd(e):ad(e):e.match(i)||[]}var xl=he(function(e,i){try{return Je(e,r,i)}catch(a){return hc(a)?a:new te(a)}}),Ww=Ar(function(e,i){return Ht(i,function(a){a=dr(a),Or(e,a,cc(e[a],e))}),e});function Jw(e){var i=e==null?0:e.length,a=J();return e=i?Ne(e,function(u){if(typeof u[1]!="function")throw new kt(h);return[a(u[0]),u[1]]}):[],he(function(u){for(var l=-1;++l<i;){var y=e[l];if(Je(y[0],this,u))return Je(y[1],this,u)}})}function Qw(e){return _g(Kt(e,b))}function gc(e){return function(){return e}}function Yw(e,i){return e==null||e!==e?i:e}var Zw=$h(),Xw=$h(!0);function mt(e){return e}function yc(e){return nh(typeof e=="function"?e:Kt(e,b))}function eb(e){return oh(Kt(e,b))}function tb(e,i){return ah(e,Kt(i,b))}var rb=he(function(e,i){return function(a){return Dn(a,e,i)}}),ib=he(function(e,i){return function(a){return Dn(e,a,i)}});function vc(e,i,a){var u=Qe(i),l=Ys(i,u);a==null&&!(De(i)&&(l.length||!u.length))&&(a=i,i=e,e=this,l=Ys(i,Qe(i)));var y=!(De(a)&&"chain"in a)||!!a.chain,w=Cr(e);return Ht(l,function(_){var x=i[_];e[_]=x,w&&(e.prototype[_]=function(){var R=this.__chain__;if(y||R){var C=e(this.__wrapped__),q=C.__actions__=gt(this.__actions__);return q.push({func:x,args:arguments,thisArg:e}),C.__chain__=R,C}return x.apply(e,Kr([this.value()],arguments))})}),e}function nb(){return ye._===this&&(ye._=Rd),this}function mc(){}function sb(e){return e=se(e),he(function(i){return ch(i,e)})}var ob=Ja(Ne),ab=Ja(Au),cb=Ja(ba);function Sl(e){return rc(e)?_a(dr(e)):Lg(e)}function ub(e){return function(i){return e==null?r:wi(e,i)}}var hb=Rh(),lb=Rh(!0);function wc(){return[]}function bc(){return!1}function fb(){return{}}function pb(){return""}function db(){return!0}function gb(e,i){if(e=se(e),e<1||e>F)return[];var a=ae,u=st(e,ae);i=J(i),e-=ae;for(var l=Pa(u,i);++a<e;)i(a);return l}function yb(e){return ne(e)?Ne(e,dr):Nt(e)?[e]:gt(Fh(_e(e)))}function vb(e){var i=++$d;return _e(e)+i}var mb=io(function(e,i){return e+i},0),wb=Qa("ceil"),bb=io(function(e,i){return e/i},1),_b=Qa("floor");function Eb(e){return e&&e.length?Qs(e,mt,Da):r}function Ib(e,i){return e&&e.length?Qs(e,J(i,2),Da):r}function Pb(e){return Tu(e,mt)}function xb(e,i){return Tu(e,J(i,2))}function Sb(e){return e&&e.length?Qs(e,mt,Ua):r}function Ob(e,i){return e&&e.length?Qs(e,J(i,2),Ua):r}var $b=io(function(e,i){return e*i},1),Ab=Qa("round"),Rb=io(function(e,i){return e-i},0);function Cb(e){return e&&e.length?Ia(e,mt):0}function Tb(e,i){return e&&e.length?Ia(e,J(i,2)):0}return d.after=em,d.ary=il,d.assign=Bm,d.assignIn=vl,d.assignInWith=vo,d.assignWith=Hm,d.at=km,d.before=nl,d.bind=cc,d.bindAll=Ww,d.bindKey=sl,d.castArray=fm,d.chain=el,d.chunk=_y,d.compact=Ey,d.concat=Iy,d.cond=Jw,d.conforms=Qw,d.constant=gc,d.countBy=Cv,d.create=Vm,d.curry=ol,d.curryRight=al,d.debounce=cl,d.defaults=Km,d.defaultsDeep=Fm,d.defer=tm,d.delay=rm,d.difference=Py,d.differenceBy=xy,d.differenceWith=Sy,d.drop=Oy,d.dropRight=$y,d.dropRightWhile=Ay,d.dropWhile=Ry,d.fill=Cy,d.filter=Nv,d.flatMap=zv,d.flatMapDeep=jv,d.flatMapDepth=Lv,d.flatten=Qh,d.flattenDeep=Ty,d.flattenDepth=Ny,d.flip=im,d.flow=Zw,d.flowRight=Xw,d.fromPairs=qy,d.functions=Xm,d.functionsIn=ew,d.groupBy=Uv,d.initial=zy,d.intersection=jy,d.intersectionBy=Ly,d.intersectionWith=Uy,d.invert=rw,d.invertBy=iw,d.invokeMap=Bv,d.iteratee=yc,d.keyBy=Hv,d.keys=Qe,d.keysIn=vt,d.map=ho,d.mapKeys=sw,d.mapValues=ow,d.matches=eb,d.matchesProperty=tb,d.memoize=fo,d.merge=aw,d.mergeWith=ml,d.method=rb,d.methodOf=ib,d.mixin=vc,d.negate=po,d.nthArg=sb,d.omit=cw,d.omitBy=uw,d.once=nm,d.orderBy=kv,d.over=ob,d.overArgs=sm,d.overEvery=ab,d.overSome=cb,d.partial=uc,d.partialRight=ul,d.partition=Vv,d.pick=hw,d.pickBy=wl,d.property=Sl,d.propertyOf=ub,d.pull=ky,d.pullAll=Zh,d.pullAllBy=Vy,d.pullAllWith=Ky,d.pullAt=Fy,d.range=hb,d.rangeRight=lb,d.rearg=om,d.reject=Gv,d.remove=Gy,d.rest=am,d.reverse=oc,d.sampleSize=Jv,d.set=fw,d.setWith=pw,d.shuffle=Qv,d.slice=Wy,d.sortBy=Xv,d.sortedUniq=tv,d.sortedUniqBy=rv,d.split=zw,d.spread=cm,d.tail=iv,d.take=nv,d.takeRight=sv,d.takeRightWhile=ov,d.takeWhile=av,d.tap=Ev,d.throttle=um,d.thru=uo,d.toArray=dl,d.toPairs=bl,d.toPairsIn=_l,d.toPath=yb,d.toPlainObject=yl,d.transform=dw,d.unary=hm,d.union=cv,d.unionBy=uv,d.unionWith=hv,d.uniq=lv,d.uniqBy=fv,d.uniqWith=pv,d.unset=gw,d.unzip=ac,d.unzipWith=Xh,d.update=yw,d.updateWith=vw,d.values=sn,d.valuesIn=mw,d.without=dv,d.words=Pl,d.wrap=lm,d.xor=gv,d.xorBy=yv,d.xorWith=vv,d.zip=mv,d.zipObject=wv,d.zipObjectDeep=bv,d.zipWith=_v,d.entries=bl,d.entriesIn=_l,d.extend=vl,d.extendWith=vo,vc(d,d),d.add=mb,d.attempt=xl,d.camelCase=Ew,d.capitalize=El,d.ceil=wb,d.clamp=ww,d.clone=pm,d.cloneDeep=gm,d.cloneDeepWith=ym,d.cloneWith=dm,d.conformsTo=vm,d.deburr=Il,d.defaultTo=Yw,d.divide=bb,d.endsWith=Iw,d.eq=tr,d.escape=Pw,d.escapeRegExp=xw,d.every=Tv,d.find=qv,d.findIndex=Wh,d.findKey=Gm,d.findLast=Dv,d.findLastIndex=Jh,d.findLastKey=Wm,d.floor=_b,d.forEach=tl,d.forEachRight=rl,d.forIn=Jm,d.forInRight=Qm,d.forOwn=Ym,d.forOwnRight=Zm,d.get=fc,d.gt=mm,d.gte=wm,d.has=tw,d.hasIn=pc,d.head=Yh,d.identity=mt,d.includes=Mv,d.indexOf=Dy,d.inRange=bw,d.invoke=nw,d.isArguments=Ei,d.isArray=ne,d.isArrayBuffer=bm,d.isArrayLike=yt,d.isArrayLikeObject=Me,d.isBoolean=_m,d.isBuffer=Zr,d.isDate=Em,d.isElement=Im,d.isEmpty=Pm,d.isEqual=xm,d.isEqualWith=Sm,d.isError=hc,d.isFinite=Om,d.isFunction=Cr,d.isInteger=hl,d.isLength=go,d.isMap=ll,d.isMatch=$m,d.isMatchWith=Am,d.isNaN=Rm,d.isNative=Cm,d.isNil=Nm,d.isNull=Tm,d.isNumber=fl,d.isObject=De,d.isObjectLike=je,d.isPlainObject=Bn,d.isRegExp=lc,d.isSafeInteger=qm,d.isSet=pl,d.isString=yo,d.isSymbol=Nt,d.isTypedArray=nn,d.isUndefined=Dm,d.isWeakMap=zm,d.isWeakSet=jm,d.join=My,d.kebabCase=Sw,d.last=Gt,d.lastIndexOf=By,d.lowerCase=Ow,d.lowerFirst=$w,d.lt=Lm,d.lte=Um,d.max=Eb,d.maxBy=Ib,d.mean=Pb,d.meanBy=xb,d.min=Sb,d.minBy=Ob,d.stubArray=wc,d.stubFalse=bc,d.stubObject=fb,d.stubString=pb,d.stubTrue=db,d.multiply=$b,d.nth=Hy,d.noConflict=nb,d.noop=mc,d.now=lo,d.pad=Aw,d.padEnd=Rw,d.padStart=Cw,d.parseInt=Tw,d.random=_w,d.reduce=Kv,d.reduceRight=Fv,d.repeat=Nw,d.replace=qw,d.result=lw,d.round=Ab,d.runInContext=P,d.sample=Wv,d.size=Yv,d.snakeCase=Dw,d.some=Zv,d.sortedIndex=Jy,d.sortedIndexBy=Qy,d.sortedIndexOf=Yy,d.sortedLastIndex=Zy,d.sortedLastIndexBy=Xy,d.sortedLastIndexOf=ev,d.startCase=jw,d.startsWith=Lw,d.subtract=Rb,d.sum=Cb,d.sumBy=Tb,d.template=Uw,d.times=gb,d.toFinite=Tr,d.toInteger=se,d.toLength=gl,d.toLower=Mw,d.toNumber=Wt,d.toSafeInteger=Mm,d.toString=_e,d.toUpper=Bw,d.trim=Hw,d.trimEnd=kw,d.trimStart=Vw,d.truncate=Kw,d.unescape=Fw,d.uniqueId=vb,d.upperCase=Gw,d.upperFirst=dc,d.each=tl,d.eachRight=rl,d.first=Yh,vc(d,function(){var e={};return fr(d,function(i,a){Ee.call(d.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),d.VERSION=n,Ht(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),Ht(["drop","take"],function(e,i){ge.prototype[e]=function(a){a=a===r?1:Ge(se(a),0);var u=this.__filtered__&&!i?new ge(this):this.clone();return u.__filtered__?u.__takeCount__=st(a,u.__takeCount__):u.__views__.push({size:st(a,ae),type:e+(u.__dir__<0?"Right":"")}),u},ge.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),Ht(["filter","map","takeWhile"],function(e,i){var a=i+1,u=a==Ur||a==z;ge.prototype[e]=function(l){var y=this.clone();return y.__iteratees__.push({iteratee:J(l,3),type:a}),y.__filtered__=y.__filtered__||u,y}}),Ht(["head","last"],function(e,i){var a="take"+(i?"Right":"");ge.prototype[e]=function(){return this[a](1).value()[0]}}),Ht(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");ge.prototype[e]=function(){return this.__filtered__?new ge(this):this[a](1)}}),ge.prototype.compact=function(){return this.filter(mt)},ge.prototype.find=function(e){return this.filter(e).head()},ge.prototype.findLast=function(e){return this.reverse().find(e)},ge.prototype.invokeMap=he(function(e,i){return typeof e=="function"?new ge(this):this.map(function(a){return Dn(a,e,i)})}),ge.prototype.reject=function(e){return this.filter(po(J(e)))},ge.prototype.slice=function(e,i){e=se(e);var a=this;return a.__filtered__&&(e>0||i<0)?new ge(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=se(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},ge.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ge.prototype.toArray=function(){return this.take(ae)},fr(ge.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),l=d[u?"take"+(i=="last"?"Right":""):i],y=u||/^find/.test(i);l&&(d.prototype[i]=function(){var w=this.__wrapped__,_=u?[1]:arguments,x=w instanceof ge,R=_[0],C=x||ne(w),q=function(pe){var ve=l.apply(d,Kr([pe],_));return u&&j?ve[0]:ve};C&&a&&typeof R=="function"&&R.length!=1&&(x=C=!1);var j=this.__chain__,V=!!this.__actions__.length,Z=y&&!j,ce=x&&!V;if(!y&&C){w=ce?w:new ge(this);var X=e.apply(w,_);return X.__actions__.push({func:uo,args:[q],thisArg:r}),new Vt(X,j)}return Z&&ce?e.apply(this,_):(X=this.thru(q),Z?u?X.value()[0]:X.value():X)})}),Ht(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ds[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(u&&!this.__chain__){var y=this.value();return i.apply(ne(y)?y:[],l)}return this[a](function(w){return i.apply(ne(w)?w:[],l)})}}),fr(ge.prototype,function(e,i){var a=d[i];if(a){var u=a.name+"";Ee.call(Zi,u)||(Zi[u]=[]),Zi[u].push({name:i,func:a})}}),Zi[ro(r,H).name]=[{name:"wrapper",func:r}],ge.prototype.clone=Fd,ge.prototype.reverse=Gd,ge.prototype.value=Wd,d.prototype.at=Iv,d.prototype.chain=Pv,d.prototype.commit=xv,d.prototype.next=Sv,d.prototype.plant=$v,d.prototype.reverse=Av,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Rv,d.prototype.first=d.prototype.head,$n&&(d.prototype[$n]=Ov),d},Ji=xd();Ue?((Ue.exports=Ji)._=Ji,Se._=Ji):ye._=Ji}).call(Jn)})(ou,ou.exports);var h2=Object.defineProperty,l2=Object.defineProperties,f2=Object.getOwnPropertyDescriptors,Lf=Object.getOwnPropertySymbols,p2=Object.prototype.hasOwnProperty,d2=Object.prototype.propertyIsEnumerable,Uf=(s,t,r)=>t in s?h2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,So=(s,t)=>{for(var r in t||(t={}))p2.call(t,r)&&Uf(s,r,t[r]);if(Lf)for(var r of Lf(t))d2.call(t,r)&&Uf(s,r,t[r]);return s},g2=(s,t)=>l2(s,f2(t));function si(s,t,r){var n;const o=v_(s);return((n=t.rpcMap)==null?void 0:n[o.reference])||`${u2}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function $i(s){return s.includes(":")?s.split(":")[1]:s}function ed(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function y2(s,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(s));if(!r.length)return[];const n=[];return r.forEach(o=>{const c=t.namespaces[o].accounts;n.push(...c)}),n}function v2(s={},t={}){const r=Mf(s),n=Mf(t);return ou.exports.merge(r,n)}function Mf(s){var t,r,n,o;const c={};if(!Ao(s))return c;for(const[h,p]of Object.entries(s)){const f=Zf(h)?[h]:p.chains,g=p.methods||[],v=p.events||[],b=p.rpcMap||{},E=Qn(h);c[E]=g2(So(So({},c[E]),p),{chains:Ec(f,(t=c[E])==null?void 0:t.chains),methods:Ec(g,(r=c[E])==null?void 0:r.methods),events:Ec(v,(n=c[E])==null?void 0:n.events),rpcMap:So(So({},b),(o=c[E])==null?void 0:o.rpcMap)})}return c}function m2(s){return s.includes(":")?s.split(":")[2]:s}function w2(s){const t={};for(const[r,n]of Object.entries(s)){const o=n.methods||[],c=n.events||[],h=n.accounts||[],p=Zf(r)?[r]:n.chains?n.chains:ed(n.accounts);t[r]={chains:p,methods:o,events:c,accounts:h}}return t}function Bc(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const td={},qe=s=>td[s],Hc=(s,t)=>{td[s]=t};class b2{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=$i(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,qe("disableProviderPing")))}}class _2{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||si(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,qe("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=parseInt($i(r));t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class E2{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=$i(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,qe("disableProviderPing")))}}class I2{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=$i(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,qe("disableProviderPing")))}}class P2{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),o=$i(r);t[o]=this.createHttpProvider(o,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,qe("disableProviderPing")))}}class x2{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=$i(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,qe("disableProviderPing")))}}class S2{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=$i(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,qe("disableProviderPing")))}}class O2{constructor(t){this.name="near",this.namespace=t.namespace,this.events=qe("events"),this.client=qe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||si(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace);return typeof n>"u"?void 0:new ai(new oi(n,qe("disableProviderPing")))}}var $2=Object.defineProperty,A2=Object.defineProperties,R2=Object.getOwnPropertyDescriptors,Bf=Object.getOwnPropertySymbols,C2=Object.prototype.hasOwnProperty,T2=Object.prototype.propertyIsEnumerable,Hf=(s,t,r)=>t in s?$2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Oo=(s,t)=>{for(var r in t||(t={}))C2.call(t,r)&&Hf(s,r,t[r]);if(Bf)for(var r of Bf(t))T2.call(t,r)&&Hf(s,r,t[r]);return s},kc=(s,t)=>A2(s,R2(t));class Ou{constructor(t){this.events=new lu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Mo(Bo({level:(t==null?void 0:t.logger)||zf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Ou(t);return await r.initialize(),r}async request(t,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Oo({},t),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(t,r,n){const o=new Date().getTime();this.request(t,n).then(c=>r(null,jo(o,c))).catch(c=>r(c,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:at("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(c=>{this.session=c,this.namespaces||(this.namespaces=w2(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==Zp)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,o]=this.validateChain(t);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(pn(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await s2.init({logger:this.providerOpts.logger||zf,relayUrl:this.providerOpts.relayUrl||o2,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Qn(r)))];Hc("client",this.client),Hc("events",this.events),Hc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=y2(r,this.session),o=ed(n),c=v2(this.namespaces,this.optionalNamespaces),h=kc(Oo({},c[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new _2({namespace:h});break;case"solana":this.rpcProviders[r]=new E2({namespace:h});break;case"cosmos":this.rpcProviders[r]=new I2({namespace:h});break;case"polkadot":this.rpcProviders[r]=new b2({namespace:h});break;case"cip34":this.rpcProviders[r]=new P2({namespace:h});break;case"elrond":this.rpcProviders[r]=new x2({namespace:h});break;case"multiversx":this.rpcProviders[r]=new S2({namespace:h});break;case"near":this.rpcProviders[r]=new O2({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&pn(o)&&this.events.emit("accountsChanged",o.map(m2))}else if(n.name==="chainChanged"){const o=r.chainId,c=r.event.data,h=Qn(o),p=Bc(o)!==Bc(c)?`${h}:${Bc(c)}`:o;this.onChainChanged(p)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:o}=r,c=(n=this.client)==null?void 0:n.session.get(t);this.session=kc(Oo({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",kc(Oo({},at("USER_DISCONNECTED")),{data:t.topic}))}),this.on(Lr.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(h=>Qn(h)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=Qn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[o,c]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(c),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${jf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${jf}/${t}`)}}const N2=Ou,q2="wc",D2="ethereum_provider",z2=`${q2}@2:${D2}:`,j2="https://rpc.walletconnect.com/v1/",au=["eth_sendTransaction","personal_sign"],L2=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],cu=["chainChanged","accountsChanged"],U2=["chainChanged","accountsChanged","message","disconnect","connect"];var M2=Object.defineProperty,B2=Object.defineProperties,H2=Object.getOwnPropertyDescriptors,kf=Object.getOwnPropertySymbols,k2=Object.prototype.hasOwnProperty,V2=Object.prototype.propertyIsEnumerable,Vf=(s,t,r)=>t in s?M2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Zn=(s,t)=>{for(var r in t||(t={}))k2.call(t,r)&&Vf(s,r,t[r]);if(kf)for(var r of kf(t))V2.call(t,r)&&Vf(s,r,t[r]);return s},Kf=(s,t)=>B2(s,H2(t));function Do(s){return Number(s[0].split(":")[1])}function Vc(s){return`0x${s.toString(16)}`}function K2(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:o,events:c,optionalEvents:h,rpcMap:p}=s;if(!pn(t))throw new Error("Invalid chains");const f={chains:t,methods:n||au,events:c||cu,rpcMap:Zn({},t.length?{[Do(t)]:p[Do(t)]}:{})},g=c==null?void 0:c.filter(O=>!cu.includes(O)),v=n==null?void 0:n.filter(O=>!au.includes(O));if(!r&&!h&&!o&&!(g!=null&&g.length)&&!(v!=null&&v.length))return{required:t.length?f:void 0};const b=(g==null?void 0:g.length)&&(v==null?void 0:v.length)||!r,E={chains:[...new Set(b?f.chains.concat(r||[]):r)],methods:[...new Set(f.methods.concat(o!=null&&o.length?o:L2))],events:[...new Set(f.events.concat(h!=null&&h.length?h:U2))],rpcMap:p};return{required:t.length?f:void 0,optional:r.length?E:void 0}}class $u{constructor(){this.events=new Qt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=z2,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new $u;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=K2(this.rpc);try{const o=await new Promise(async(h,p)=>{var f;this.rpc.showQrModal&&((f=this.modal)==null||f.subscribeModal(g=>{!g.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),p(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Kf(Zn({namespaces:Zn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(g=>{h(g)}).catch(g=>{p(new Error(g.message))})});if(!o)return;const c=m_(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:Vc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Vc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Kf(Zn({},at("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Vc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,o]=t.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const o=(r=t==null?void 0:t.chains)!=null?r:[],c=(n=t==null?void 0:t.optionalChains)!=null?n:[],h=o.concat(c);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const p=o.length?(t==null?void 0:t.methods)||au:[],f=o.length?(t==null?void 0:t.events)||cu:[],g=(t==null?void 0:t.optionalMethods)||[],v=(t==null?void 0:t.optionalEvents)||[],b=(t==null?void 0:t.rpcMap)||this.buildRpcMap(h,t.projectId),E=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(O=>this.formatChainId(O)),optionalChains:c.map(O=>this.formatChainId(O)),methods:p,events:f,optionalMethods:g,optionalEvents:v,rpcMap:b,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:E,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Do(this.rpc.chains):Do(this.rpc.optionalChains),this.signer=await N2.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await w_(()=>import("./index-ShfHlhEp.js").then(o=>o.i),__vite__mapDeps([0,1,2]));r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Zn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:o}=t;r&&pn(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),n&&pn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${j2}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const fO=$u;export{fO as EthereumProvider,U2 as OPTIONAL_EVENTS,L2 as OPTIONAL_METHODS,cu as REQUIRED_EVENTS,au as REQUIRED_METHODS,$u as default};
